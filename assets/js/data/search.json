[ { "title": "How to make Swift Macro available using CocoaPods", "url": "/posts/How-to-make-macro-available-from-CocoaPods/", "categories": "Tech, Swift", "tags": "Tech, Swift, Rust", "date": "2024-03-06 21:00:00 +0800", "snippet": "By the release of Swift 5.9, it provides the feature Swift Macro, which is really useful for the developer to reduce boilerplate code and helping to improve the readability of the code.However, as we know, currently most long running projects are using CocoaPods as their dependency manager, while the Swift Macro support officially relies on SwiftPM. This prevents macros from being directly used in the project code and development pods.So this article is about to introduce how to make Swift Macro available using CocoaPods, for host project and other pods.Key Point - using an executable macro pluginInspired by the information in this discussion and this post, it shows that we can provide an executable binary to the Swift Compiler in Xcode settings: add -load-plugin-executable &amp;lt;path-to-plugin-executable&amp;gt;#&amp;lt;executable-module-name&amp;gt; to OTHER_SWIFT_FLAGS.For example:&#39;OTHER_SWIFT_FLAGS&#39; =&amp;gt; &#39;-load-plugin-executable Resources/Macros/MyMacroPlugin#MyMacroPlugin&#39;,That means we can build a plugin executable and provide it through CocoaPods, update the settings in Pods project and host project before or after the pod install command.Okay, letâ€™s do it.(All the example code can be found in this repo)Create a macro plugin executableWe can easily create a demo macro project using Xcode 15 or command line swift package init --type macro. And then update the Package.swift like this:// swift-tools-version: 5.9// The swift-tools-version declares the minimum version of Swift required to build this package.import PackageDescriptionimport CompilerPluginSupportlet package = Package( name: &quot;SwiftyArchitectureMacros&quot;, platforms: [.macOS(.v10_15), .iOS(.v13), .tvOS(.v13), .watchOS(.v6), .macCatalyst(.v13)], products: [ // Product which is a executable plugin for other project&#39;s compiler to integrate. .executable( name: &quot;SwiftyArchitectureMacros&quot;, targets: [&quot;SwiftyArchitectureMacros&quot;]), ], dependencies: [ // Depend on the Swift 5.9 release of SwiftSyntax .package(url: &quot;https://github.com/apple/swift-syntax.git&quot;, from: &quot;509.0.0&quot;), ], targets: [ .executableTarget( name: &quot;SwiftyArchitectureMacros&quot;, dependencies: [ .product(name: &quot;SwiftSyntaxMacros&quot;, package: &quot;swift-syntax&quot;), .product(name: &quot;SwiftCompilerPlugin&quot;, package: &quot;swift-syntax&quot;) ] ), // A test target used to develop the macro implementation. .testTarget( name: &quot;MacrosTests&quot;, dependencies: [ &quot;SwiftyArchitectureMacros&quot;, .product(name: &quot;SwiftSyntaxMacrosTestSupport&quot;, package: &quot;swift-syntax&quot;), ] ), ])There are some important informations: The target SwiftyArchitectureMacros must be a executable target, normally itâ€™s a .macro target. And the product of the executable should target on the executable SwiftyArchitectureMacros. Second, by several tests, the executable target should contain original macro files, not macro definition files. So it means that the definition of the macro should be contained in the pod we build. By using this swift build -c release command, we can get a SwiftyArchitectureMacros executable file in .build/release/.Create a pod to host the macro plugin executableUsing a prepared macro executableNext, we will create a podspec file to host the executable file and add some configurations.We can create a .podspec now, and in my case it is SwiftyArchitectureMacrosPackage.podspec. The key content is below.s.source_files = &#39;Sources/MacrosDefine/*&#39;s.preserve_paths = &#39;Products/**/*&#39;xcode_config = { &#39;OTHER_SWIFT_FLAGS&#39; =&amp;gt; &amp;lt;&amp;lt;-FLAGS.squish -Xfrontend -load-plugin-executable -Xfrontend $(PODS_ROOT)/SwiftyArchitectureMacrosPackage/Products/SwiftyArchitectureMacros#SwiftyArchitectureMacros FLAGS}s.user_target_xcconfig = xcode_config # &amp;lt;-- add to the `Host project`.s.pod_target_xcconfig = xcode_configKey points: The source_files should contain the macro definition files, which are the files that contains the macro definitions like: @freestanding(expression)public macro stringify&amp;lt;T&amp;gt;(_ value: T) -&amp;gt; (T, String) = #externalMacro(module: &quot;SwiftyArchitectureMacros&quot;, type: &quot;StringifyMacro&quot;) The preserve_paths should contain the executable file, which we build before and move it to a folder, like Products/. The user_target_xcconfig and pod_target_xcconfig should contain the same configurations, which integrate the executable to compiler plugin. The s.user_target_xcconfig is used to modify settings of the host project, while the s.pod_target_xcconfig is used to modify settings of the current pod target.Using a script to build a executableInspired by this post, we can also use a script to build the executable.We can create another .podspec file, which is SwiftyArchitectureMacros.podspec in my case, and the key content is below.s.source_files = &#39;Sources/MacrosDefine/*&#39;s.preserve_paths = &#39;Package.swift&#39;, &#39;Sources/**/*&#39;, &#39;Tests/**/*&#39;product_folder = &quot;${PODS_BUILD_DIR}/Products/SwiftyArchitectureMacros&quot;script = &amp;lt;&amp;lt;-SCRIPT.squishenv -i PATH=&quot;$PATH&quot; &quot;$SHELL&quot; -l -c&quot;swift build -c release --product SwiftyArchitectureMacros--package-path \\\\&quot;$PODS_TARGET_SRCROOT\\\\&quot;--scratch-path \\\\&quot;#{product_folder}\\\\&quot;&quot;SCRIPTs.script_phase = { :name =&amp;gt; &#39;Build SwiftyArchitectureMacros macro plugin&#39;, :script =&amp;gt; script, :input_files =&amp;gt; Dir.glob(&quot;{Package.swift, Sources/**/*}&quot;).map { |path| &quot;$(PODS_TARGET_SRCROOT)/#{path}&quot; }, :output_files =&amp;gt; [&quot;#{product_folder}/release/SwiftyArchitectureMacros&quot;], :execution_position =&amp;gt; :before_compile}Besides the key points introduced above, this section also needs attention to several other key points: The preserve_paths should contain the Package.swift and files that are used to build the executable. And donâ€™t forget to update the build config path to #{product_folder}/release/SwiftyArchitectureMacros#SwiftyArchitectureMacros.The benefit is that we donâ€™t need to prepare the executable file, it will be built by the script when the main project starts building, and it wonâ€™t have any compatible issue. However you should know that the script will be executed every time when the project builds, and it may takes a long time when thereâ€™s no build cache. So I suggest as a SDK provider, you should provide both options.Integrate to other targetsHost projectIf your main codes are in the host project, you can integrate the macro plugin to the host project by adding the following code to the Podfile.pod &#39;SwiftyArchitectureMacrosPackage&#39;#orpod &#39;SwiftyArchitectureMacros&#39;Because of the OTHER_SWIFT_FLAG setting are already inserted by the podspec file into the host project settings, you donâ€™t need to do anything else.import SwiftyArchitectureMacrosPackagefunc test() { let a = 1 let b = 2 let desc = #stringify(a + b) print(desc)}It works fine~Used by other pods or development podsFirst, add the dependency in the otherâ€™s podspec:s.dependency &#39;SwiftyArchitectureMacrosPackage&#39;And then it will be a little tricky, because we canâ€™t directly insert the OTHER_SWIFT_FLAG into other pod target settings because: In anotherâ€™s podspec, hard code the executable path is not a good idea, because the path may changes when you switching the macro pod between local and remote. If a lot of pods are depending on the macro pod, when macro pod setting changes you must update all the podsâ€™ podspec file which is a big trouble.So we need to do some tricks. We can use pod installâ€™s post_install hook to do this. Add these code to your Podfile, it aims to add the OTHER_SWIFT_FLAG setting to the Pods.xcodeproj, and all the pod targets will inherit from it.post_install do |installer_representation| macro_product_folder = &quot;${PODS_BUILD_DIR}/Products/SwiftyArchitectureMacros&quot; installer_representation.pods_project.build_configurations.each do |config| config.build_settings[&#39;OTHER_SWIFT_FLAGS&#39;] = &quot;$(inherited) -load-plugin-executable #{macro_product_folder}/release/SwiftyArchitectureMacros#SwiftyArchitectureMacros&quot; endendNow try pod install and see if all the pod targets are inheriting correctly from the Pods.xcodeproj. If so, you can use the macros in your codes now." }, { "title": "When we talk about politics", "url": "/posts/Talk-abould-the-politics/", "categories": "View Points", "tags": "View Points", "date": "2021-12-29 20:51:00 +0800", "snippet": "å¦‚ä»Šå›½å†…å·²ç»è¶Šæ¥è¶Šéš¾äº’ç›¸è°ˆè®ºç¤¾ä¼šã€æ”¿è§è¯é¢˜äº†ï¼ŒåŸå› ä¸ä¹å°±æ˜¯æ”¿æ²»æ•™è‚²ç¼ºä¹ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰è®¨è®ºç¯å¢ƒã€‚æœ¬æ¥æœ‰å¾ˆå¤šæƒ³è¯´çš„ï¼Œä½†æ˜¯ç»å†è¿‡ä¸€æ¬¡æ¬¡å†²çªä¹‹åæ˜ç™½äº†ä¸€ä¸ªé“ç†ï¼Œè¦è®¨è®ºè¿™äº›ï¼Œé¦–å…ˆéœ€è¦åˆ¤æ–­å¯¹æ–¹çš„æ€ç»´ä½“ç³»æ˜¯è¶‹åŒçš„è¿˜æ˜¯è¶‹å¼‚çš„ã€‚äººç±»æ–‡æ˜è¿›æ­¥åˆ°ä»Šå¤©ï¼Œä¸€å®šè¶‹åŒæ˜¯æ–‡æ˜è¿›æ­¥çš„è¶‹åŠ¿ã€‚æ‰€ä»¥è·Ÿä¸€ä¸ªè¶‹å¼‚çš„äººå»è®¨è®ºé—®é¢˜ï¼Œä»–ä¸€å®šä¼šç”¨ä¸€äº›ä½ ä»¬æ ¹æœ¬ä¸Šçš„å·®å¼‚ç‚¹å»åé©³ä½ ï¼Œå¯¼è‡´ä¸å¯è°ƒå’Œçš„çŸ›ç›¾ã€‚æ‰€ä»¥ï¼Œä¸€å®šè¦é¦–å…ˆä»ç¼“å’Œçš„è¯é¢˜å»åˆ†æä»–æ˜¯å±äºå“ªç§äººã€‚å†²çªå¤šäº†ï¼Œäººå°±ä¼šå˜å¾—ä¸æƒ³å‘è¡¨æ„è§ï¼Œä½†å¸Œæœ›ä»¥åæˆ‘ä¾ç„¶èƒ½ç›´è¨€ä¸ªäººæ„Ÿå—ï¼Œæ‰¹åˆ¤ä¸åˆç†çš„äº‹æƒ…ã€‚å¦å¤–ï¼Œå¯¹äºé‚£äº›è§‰å¾—æ‰¹åˆ¤éƒ½æ˜¯ä¸å¥½çš„äº‹æƒ…çš„äººæ¥è¯´ï¼ŒçœŸçš„éœ€è¦è®¤çœŸæ€è€ƒä¸‹è‡ªå·±çš„è§‚å¿µæ˜¯ä¸æ˜¯å·²ç»å¤ªåŸå§‹äº†ã€‚" }, { "title": "Why we struggled using native code to build apps", "url": "/posts/Why-we-struggled-using-navite-code-to-build-apps/", "categories": "View Points", "tags": "View Points", "date": "2021-11-19 20:02:00 +0800", "snippet": " ä»¥ä¸‹æƒ³æ³•ä¸ºä¸ªäººæ€è€ƒï¼Œæ²¡æœ‰è®¨è®ºå¯¹é”™ï¼Œæ²¡æœ‰æƒ³å»ä»å…¨å±€orä»»æ„è§’åº¦ä¸ºåˆ†æï¼Œä»…ä¸ºè®°å½•ã€‚å†™è¿™ç¯‡æ€è€ƒå¯¹çš„æ€æºæ˜¯ï¼Œè¿‘ä¸¤å¤©çœ‹åˆ°æœ‹å‹åœˆåœ¨å‘å…³äºè…¾è®¯äº‘æ­å»ºä½ä»£ç å¹³å°çš„æ–°é—»ã€‚æ–‡ä¸­å¯¹ä½ä»£ç çš„ä¼˜åŠ¿æ€»ç»“å‡ ä¸ªå­—åœ¨äºå¿«é€Ÿã€simpleã€éš¾åº¦ä½ï¼ˆäººäººéƒ½æ˜¯å·¥ç¨‹å¸ˆğŸ˜‚ï¼‰ã€‚æˆ‘ä¸ªäººå¯¹å¹³å°çº§æŠ€æœ¯çš„å‘å±•æ²¡ä»€ä¹ˆæ„è§ï¼Œä½†æ˜¯æˆ‘å¶å°”æƒ³åˆ°äº†æœ€è¿‘åˆšåœ¨ç‚’çš„æ¦‚å¿µ Metaverse (å…ƒå®‡å®™)ã€‚æˆ‘æ„Ÿåˆ°æœ‰ç‚¹æœ‰è¶£ğŸ¤”ï¼Œå› ä¸ºä¸è®ºä»¥å Metaverse æƒ³æ€ä¹ˆå‘å±•ï¼ˆè™½ç„¶9æˆç›®å‰æ˜¯æ¥ç‚’ä½œçš„ï¼Œä½†æ˜¯ï¼‰å¦‚æœçœŸçš„æ˜¯å®ç°æŠ€æœ¯ï¼Œé¦–è¦çš„æ ‡å‡†æ˜¯äº§å“ä½“éªŒã€‚æ›´è¿‘ä¸€æ­¥æ¥æ€è€ƒå›½å†…å¤–æŠ€æœ¯çš„å·®å¼‚ç‚¹ï¼Œå›½å†…ä¸ç®¡æ˜¯å°ç¨‹åºã€äº‘å¹³å°ã€ä½ä»£ç ç­‰ç­‰ï¼Œä»–ä»¬çš„ç”¨æˆ·éƒ½æ˜¯ toB å¸‚åœºæ›´å¤šï¼ŒB å¸‚åœºå†å®ç°äº§å“ toCã€‚è€Œå›½å¤–çš„ä¼˜ç§€äº§å“å…¬å¸ï¼Œæ›´æ³¨é‡çš„æ˜¯å®é™…å¯¹ C ç«¯ç”¨æˆ·æœ¬èº«çš„ç”¨æˆ·ä½“éªŒã€‚è¿™ä¸ç¦å¼•äººæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæ˜¯ç”¨æˆ·é€ å°±äº†å¸‚åœºï¼Œè¿˜æ˜¯å¸‚åœºåŸ¹å…»äº†ç”¨æˆ·ã€‚å›½å†…ç”¨æˆ·ï¼ˆå¤§éƒ¨åˆ†ï¼‰å‘æ¥ä»¥èƒ½å¿è‘—ç§°ï¼ŒåŸºæœ¬ä¸Šä¸€ä¸ªåŠŸèƒ½é‡è¯•ä¸ªå‡ å›èƒ½æˆåŠŸï¼Œé‚£ä¹ˆè¿™ä¸ªäº§å“å°±å¯ä»¥ç”¨ï¼Œä½•å†µç°åœ¨å¹³å°çº§çš„æŠ€æœ¯ä½“éªŒç¼ºé™·ä¹Ÿåªåœ¨äºæŸäº›è®¾è®¡å¸ˆã€å¼ºè¿«ç—‡æ‰èƒ½çœ‹å‡ºæ¥çš„ç¨‹åº¦ï¼ˆæ•´æ®µæ˜¯å¤¸å¼ æ‰‹æ³•ï¼‰ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å¯ä»¥è¯´åœ¨å›½å†…è·¨å¹³å°ã€é«˜å†…èšçš„ toB äº§å“çš„ç”Ÿå­˜ç©ºé—´æ›´å¥½å‘¢ã€‚é€è¿‡è¿™ä¸ªç°è±¡æˆ‘ä»¬å»çœ‹å®é™…çš„æŠ€æœ¯æœ¬è´¨ï¼Œå…¶å®ä¹Ÿå¾ˆå®¹æ˜“å‘ç°ï¼Œå›½å†…å¤–çš„æŠ€æœ¯è¶‹åŠ¿ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œç§»åŠ¨ç«¯æŠ€æœ¯å…´èµ·çš„æ—¶å€™ï¼Œä¼˜ç§€çš„å·¥ç¨‹å¸ˆéƒ½æ˜¯è¿½æ±‚å°è€Œç²¾çš„æŠ€æœ¯ï¼Œå†å‘å±•è·¨å¹³å°ç­‰ï¼Œè€Œå›½å†…åˆ™æ˜¯ç›´æ¥è¿½æ±‚å¤§ç»Ÿï¼Œå…¶ä»–å†…å®¹ç±»çš„åˆ™èƒ½æ¬å°±æ¬ã€‚è¿™ä¸¤ç§æ€è·¯ï¼Œæˆ‘ä¸ªäººå€¾å‘äºå‰è€…ï¼Œå› ä¸ºæˆ‘çš„æ€ç»´æ¡†æ¶è¿˜æ˜¯ä»¥ç”¨æˆ·æœ¬èº«ä¼šæŒ‘é€‰äº§å“ä¸ºå‰æè¿›è¡Œçš„ï¼Œå¦‚æœä¸€ä¸ªäº§å“å…ˆå¼€å§‹ä¸ä»ä½“éªŒä¸Šç²¾è¿›ï¼Œåˆ™æ²¡æœ‰æ„ä¹‰ï¼›å›½å†…çš„æ€è·¯ï¼Œçœ‹èµ·æ¥å°±å¾ˆé£˜ï¼Œé£˜åˆ°åƒæ˜¯è¢« KPI å¹èµ·æ¥çš„ä¸€æ ·ã€‚ç„¶è€Œå›½å†…å¸‚åœºçš„äº‹å®å´æ˜¯å¦å¤–ä¸€ç§æ€è·¯ï¼Œå› ä¸ºç”¨æˆ·æœ¬èº«å¯¹äºäº§å“çš„æŒ‘å‰”å¹¶ä¸é«˜ï¼Œè¿™æ ·å‚å•†çš„æ€è·¯å°±å˜æˆäº†ä¼˜å…ˆæŠ¢å ç”¨æˆ·ï¼Œä½¿ç”¨å…¶ä»–ä¸€äº›æ‰‹æ®µç•™ä½ç”¨æˆ·ï¼Œæé«˜å£å’å‡å°‘æµå¤±ã€‚ä»å•†ä¸šç«äº‰ä¸Šæ¥è®²ï¼Œè¿™ç§ç®—æ˜¯æ­£å¸¸æ‰‹æ®µå§ï¼Œä½†æ˜¯ä½œä¸ºä¸ªäººç”¨æˆ·ï¼Œè¿™ç§ç«äº‰æˆ‘è¿˜æ˜¯æƒ³å½’äºéè‰¯æ€§ç«äº‰ã€‚å½“ç„¶ä½œä¸ºæˆ‘ä¸ªäººï¼Œæˆ‘å°±æ˜¯å±äºå¼ºè¿«ç—‡ä¸­çš„ä¸€å‘˜ã€‚ä»å°å­¦ç¾æœ¯å‡ºèº«ï¼Œä¸­å­¦çœ‹è¿‡å¹³é¢è®¾è®¡ï¼Œè½¬èŒ Engineer ä¹‹åç”¨è¿‡å¤§éƒ¨åˆ†ä¼˜ç§€çš„å›½å¤– Appï¼Œåˆè¢« Apple å’Œå„å¤§åŸç”Ÿ App çš„ä¼˜ç§€åŠ¨æ•ˆç§€äº†ä¸€è„¸ï¼Œè‡ªæ­¤æ²¡äº‹çœ‹çœ‹ dirbbble ä»€ä¹ˆçš„ï¼ŒåŸºæœ¬å£å‘³å·²ç»è¢«å…»åˆäº†ã€‚æ‰€ä»¥ä½œä¸ºæˆ‘çš„è§†è§’ï¼Œæˆ‘çš„ç”¨æˆ·è¡Œä¸ºåº”è¯¥æ˜¯è¢«å¤šå…ƒåŸ¹å…»çš„ï¼Œè€Œå›½å†…ç›®å‰çš„å®¡ç¾æ•™è‚²è¿˜è¶‹äºå½¢å¼åŒ–ï¼Œæ„Ÿè§‰ç›¸æ¯”äºåå‡ å¹´å‰éƒ½æœ‰é€€æ­¥ã€‚æˆ‘å¾ˆå¥½å¥‡ï¼Œä»¥åè¿™ç§ç¯å¢ƒä¸‹åŸ¹å…»çš„ç”¨æˆ·ä¼šä¸ä¼šè§‰å¾—äº§å“è®¾è®¡å…¶å®å°±æ˜¯è¿™æ ·ï¼Œä¼˜ä¸ä¼˜ç§€ä¹Ÿæ²¡å¤šå¤§å·®åˆ«ï¼Ÿå½“ç„¶è¿™ä¸ªè®®é¢˜è¿‡äºå¤§äº†ï¼Œå®¡ç¾è¿›æ­¥é€€æ­¥ä¹Ÿä¸æ˜¯æˆ‘èº«è¾¹çš„å®ä¾‹èƒ½å¤Ÿå»ä¸¾è¯çš„ã€‚è¯´åˆ°è¿™æˆ‘ä»¬å°±å¯ä»¥è¯´å›åˆ°ä¸»é¢˜äº†ï¼Œè¿™ç§å¤§èƒŒæ™¯å¤§ç¯å¢ƒä¸‹ï¼Œå¯¹äºæŠ€æœ¯æœ¬èº«çš„å½±å“åŠæœªæ¥æŠ€æœ¯å‘å±•çš„è¶‹åŠ¿ï¼Œéƒ½ä¼šæ˜¯ä¸ä¸€æ ·çš„ã€‚ç›´åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œè·¨å¹³å°æŠ€æœ¯è¿˜æ˜¯å¤‡å—å¸‚åœºæ¬¢è¿çš„ï¼Œä¸è®ºæ˜¯å°ç¨‹åºã€ReactNativeã€Flutterç­‰ç­‰ï¼Œéƒ½æ˜¯è¿™äº›è¶‹åŠ¿çš„äº§ç‰©ã€‚åè¯´å›æ¥ï¼Œnative coder çš„æˆæœ¬è¿‡é«˜ä¸”ç»™å…¬å¸å¸¦æ¥çš„å¯¹æ¯”æ”¶ç›Šå¹¶ä¸å¤§ï¼Œå¿…ç„¶åœ¨æ€»ä½“è¶‹åŠ¿ä¸‹ä¼šè½äºä¸‹é£ã€‚ä½†æ˜¯æ¢ä¸ªç¯å¢ƒï¼Œæ¯”å¦‚å·²ç»è¢«å…»åˆçš„æŸäº›æµ·å¤–ç¾¤ä½“ç”¨æˆ·åœ°åŒºï¼Œé‚£ä¹ˆä½“éªŒå¯¹äºä»–ä»¬æ¥è¯´å¯èƒ½å°±æ˜¯åŠæ ¼åˆ†æ•°çº¿ã€‚æ‰€ä»¥å…¬å¸çš„æŠ€æœ¯è§„åˆ’ä¹Ÿéœ€è¦æ ¹æ®ç›®æ ‡ç”¨æˆ·æˆ–åœ°åŒºæ¥ç¡®å®šï¼Œè¿™ç§æ–¹å‘ä¸Šçš„å†³å®šï¼ŒåŸºæœ¬åœ¨ä¹‹åè°ƒæ•´çš„æˆæœ¬æ˜¯å¾ˆé«˜çš„ï¼ˆä½ çœ‹åªæœ‰ Facebook æ²¡äº‹åœ¨æŠ€æœ¯æ ˆä¸Šåˆ‡æ¥åˆ‡å»ï¼‰ã€‚è¿™ä¸ªè¶‹åŠ¿æ˜¯åœ¨ä»¥æˆ‘ä»¬ä»¥æ‰‹æœºä¸ºç»ˆç«¯çš„å‰æä¸‹ï¼Œä½†æ˜¯å¦‚æœ Metaverse çœŸçš„å‘å±•èµ·æ¥äº†å‘¢ï¼Ÿæˆ‘ä»¬çš„ç»ˆç«¯å¯èƒ½å°±ä¸æ˜¯æ‰‹æœºäº†ï¼Œåˆ°æ—¶å€™åŸºäºæ‰‹æœºç•Œé¢ç³»ç»Ÿå»ºç«‹çš„ä½“ç³»ï¼Œå°±éœ€è¦æ´—ç‰Œé‡æ¥ã€‚è¿™å—çš„è¯æˆ‘å°±ååˆ†çœ‹å¥½å„å¤§ 3D å¼•æ“å¼€å‘å•†ï¼ˆèµ¶ç´§ä¹°å‡ è‚¡ï¼‰ï¼ŒåŸºäºä¸‰ç»´æ¡†æ¶çš„æ­å»ºä¼šæ˜¯å…¨æ–°çš„å¼€å‘æ–¹å¼ï¼Œåˆ°é‚£æ—¶å¯èƒ½å¹³å°åŒ–å’Œå¿«é€Ÿæ­å»ºå¹³å°ï¼Œå°±ä¸æ˜¯ç°åœ¨è¿™ä¹ˆå®¹æ˜“çš„äº‹äº†ã€‚ä¸è¿‡è¿™ä¸ªå‡è®¾è¿˜å¤ªæ—©ï¼Œç§‘æŠ€å‘å±•è¿‘å¹´æ¥å¹¶æ²¡æœ‰è¿™ä¹ˆå¿«ï¼Œç”¨æˆ·ä½“ç³»çš„è·ƒè¿ä¹Ÿæ˜¯æ—¥ç§¯æœˆç´¯çš„è¿‡ç¨‹ï¼Œä¼°è®¡è¿™è¾ˆå­èƒ½çœ‹åˆ°éƒ½ä¸ä¸€å®šå‘¢ï½å†è¯´å›æˆ‘ä¸ªäººï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯æ›´å–œæ¬¢ä½¿ç”¨ native code to build appsï¼Œå¹¶ä¸”ç‰¹åˆ«å¸Œæœ›æ·»åŠ ä¼˜ç§€çš„åŠ¨æ•ˆäº¤äº’ï¼ˆduangï½ï¼‰ï¼Œè¿™äº›å¸Œæœ›å½“ç„¶éƒ½åªæºäºæˆ‘ä¸ªäººæ„æ„¿ï¼Œæˆ‘å¿ƒä¸­è§‰å¾—ä¼˜ç§€çš„ App åº”è¯¥æ˜¯ä»€ä¹ˆæ ·ï¼Œç„¶åå¶å°”åšæŒç€å»å®ç°ä¸€å·±ç§æ„¿ç½¢äº†ã€‚" }, { "title": "The some in Swift", "url": "/posts/The-some-in-Swift/", "categories": "Tech, Swift", "tags": "Swift", "date": "2021-11-12 15:20:00 +0800", "snippet": " Swift 5 introduced the â€œOpaque Typeâ€ and see how wrong did I think about it.æˆ‘çš„æ€è·¯é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜æœ€å…ˆå¼€å§‹æˆ‘ä»¥ä¸º some æ˜¯ä¸€ä¸ªç±»ä¼¼äº ObjC ä¸­ __kindof çš„æ ‡è¯†ï¼Œæ„è¯†åˆ°æˆ‘çš„é”™è¯¯æ˜¯åœ¨ä¸€æ®µæ—¶é—´ä¹‹åäº†ã€‚è¯´æ˜è¿™ä¸ªè¿‡ç¨‹å’Œ some çš„ç”¨æ³•æˆ‘ä»¬éœ€è¦ä»æˆ‘å…ˆå…¥ä¸ºä¸»çš„ä¹±ç”¨å¼€å§‹è¯´èµ·ï¼ˆå¼€å§‹åºŸè¯äº†ï¼‰ã€‚æˆ‘å…ˆå®šä¹‰ä¸ª Flyable çš„åè®®ï¼Œç„¶åæœ‰ Bird Dragonfly å®ç°å®ƒã€‚protocol Flyable {}class Bird: Flyable {}class Dragonfly: Flyable {}è¿™æ—¶å€™æˆ‘ä»¬æœ‰ä¸ªæ–¹æ³•å¯ä»¥éšæœºè¿”å›ä¸€ä¸ªå¯é£è¡Œç”Ÿç‰©ï¼šfunc getSomeFlyableCreatures() -&amp;gt; Flyable { let someRandomCondition = arc4random() % 2 == 1 return someRandomCondition ? Bird() : Dragonfly()}ç›´åˆ°ç°åœ¨ï¼Œæ‰€æœ‰åŠŸèƒ½å®Œç¾è¿è¡Œã€‚ç„¶åæˆ‘ä»¬ç°åœ¨å°è¯•åœ¨ getSomeFlyableCreatures è¿”å›å€¼ç±»å‹å‰åŠ ä¸ª some:func getSomeFlyableCreatures() -&amp;gt; some Flyable { let someRandomCondition = arc4random() % 2 == 1 return someRandomCondition ? Bird() : Dragonfly()}ç„¶åæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼š Result values in â€˜? :â€™ expression have mismatching types â€˜Birdâ€™ and â€˜Dragonflyâ€™æ„æ€æ˜¯è¿”å›å€¼è¡¨è¾¾å¼ä¸­ Bird å’Œ Dragonfly ç±»å‹ä¸åŒ¹é…ã€‚æˆ‘ä»¬åªèƒ½è¿”å› Bird æˆ– Dragonfly å…¶ä¸­ç±»å‹ä¹‹ä¸€ã€‚åˆ†æsoï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦åˆ†æä¸ºä»€ä¹ˆä¼šåˆè¿™ä¸ªé”™è¯¯ï¼Œä»¥åŠä»æ­¤åˆ†æç¼–è¯‘å™¨çš„é€»è¾‘ã€‚å½“è¿”å›å€¼ä¸åŠ  some æ—¶ï¼Œæˆ‘ä»¬çš„è¿”å›å€¼ç±»å‹æ—¶ç¡®å®šçš„ Protocol ç±»å‹ Flyableï¼Œæ‰€ä»¥æ­¤æ—¶ä¸è®ºæ˜¯è¿”å› Bird è¿˜æ˜¯ Dragonfly ç¼–è¯‘å™¨é€šè¿‡åè®®æ¨æ–­éƒ½æ˜¯ç¬¦åˆçš„ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥é€šè¿‡ç¼–è¯‘çš„ã€‚å½“æˆ‘ä»¬æ·»åŠ  some ä¹‹åä¸ºä»€ä¹ˆä¸è¡Œäº†å‘¢ï¼Ÿé€šè¿‡åˆšæ‰çš„ç»“æœï¼Œæˆ‘ä»¬åªèƒ½è¿”å›å…¶ä¸­ä¹‹ä¸€çš„ç¡®å®šç±»å‹ï¼Œè¯´æ˜ç¼–è¯‘å™¨åœ¨å¤„ç† some æ—¶ï¼Œä¼šè‡ªåŠ¨æ¨æ–­æ–¹æ³•å†…è¿”å›çš„ç±»å‹ï¼Œå¹¶æŠŠå®ƒæ›¿æ¢åˆ°è¿”å›ç±»å‹ä¸Šã€‚æœ‰ç‚¹ç‚¹ç±»ä¼¼èŒƒå‹æ–¹æ³•ï¼ˆå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œä½†æ˜¯å®é™…ä¸ä¸€æ ·ï¼‰func getSomeFlyableCreatures&amp;lt;T: Flyable&amp;gt;() -&amp;gt; Tæ‰€ä»¥åœ¨æ·»åŠ  some ä¹‹åæ–¹æ³•ä½“é‡Œè¿”å›çš„å¿…é¡»æ˜¯å›ºå®šçš„ä¸€ç§ç±»å‹ã€‚é—®é¢˜æ›´è¿›ä¸€æ­¥ç°åœ¨æˆ‘ä»¬ç»™ Flyable åŠ ä¸€ä¸ªå®šä¹‰ï¼Œå®šä¹‰ç¿…è†€æè´¨ã€‚class Muscle { }class Cutin { }protocol Flyable { associatedtype wingsMaterial}class Bird: Flyable { typealias wingsMaterial = Muscle}class Dragonfly: Flyable { typealias wingsMaterial = Cutin}ç„¶åå‘¢ï¼Œæˆ‘ä»¬çš„ getSomeFlyableCreatures æ–¹æ³•å°±æŠ¥é”™äº†ã€‚ Protocol â€˜Flyableâ€™ can only be used as a generic constraint because it has Self or associated type requirementsè¿™ä¸ªæŠ¥é”™åŸå› å¤§å®¶åº”è¯¥éƒ½ä¸é™Œç”Ÿï¼Œå› ä¸ºæ–¹æ³•å‚æ•°ã€è¿”å›å€¼ä¸­çš„ç±»å‹å¿…é¡»æ˜¯ç¡®å®šçš„ç±»å‹ï¼Œåœ¨ä¸€ä¸ª protocol ä¸­åŒ…å« associated type æ—¶ï¼Œå…¶å®ç¼–è¯‘å™¨æ—¶æ— æ³•ç¡®å®šå…·ä½“ç±»å‹çš„ã€‚ä»¥å‰æˆ‘ä»¬å”¯ä¸€èƒ½åšçš„å°±æ˜¯æŠŠè¿™ä¸ªæ–¹æ³•æ”¹æˆèŒƒå‹æ–¹æ³•ï¼Œå¹¶ä¸”æ”¾å¼ƒä½¿ç”¨ Flyable è¿™ä¸ªåè®®ç±»å‹ã€‚ä½†æ˜¯æˆ‘ä»¬ç°åœ¨å¯ä»¥è¯•ç€åœ¨è¿”å›å€¼å‰é¢æ·»åŠ  some æ¥çœ‹è¿™ä¸ªæ–¹æ³•è¡Œä¸ºå˜æˆäº†ä»€ä¹ˆã€‚func getSomeFlyableCreatures() -&amp;gt; some Flyable { return Bird()}åœ¨ä¿®æ”¹æ–¹æ³•ä½“è¿”å›å€¼ä¸ºç»Ÿä¸€çš„ç±»å‹åï¼Œå¯ä»¥ç¼–è¯‘é€šè¿‡äº†ï½ä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªæ–¹æ³•è¡¨ç°ç­‰åŒäºfunc getSomeFlyableCreatures() -&amp;gt; Bird {}ä¸ä¹‹å‰æˆ‘ä»¬åˆ†æçš„ç¼–è¯‘å™¨é€»è¾‘ç›¸ç¬¦ã€‚Thenåˆ†æäº†è¿™ä¹ˆå¤šï¼Œå…¶å®ä¸ºä¹‹å‰é‡åˆ°çš„ protocol ä¸­çš„ associated type é—®é¢˜å¹¶æ²¡æœ‰æä¾›ä»€ä¹ˆå¸®åŠ©ã€‚some æ›´å¤šçš„è¿˜æ˜¯ç±»ä¼¼äº SwiftUI ä¸­çš„ some Viewï¼Œæä¾›äº† Opaque Type çš„ç±»å‹æ¨æ–­ï¼Œæ–¹ä¾¿ä»£ç ä¹¦å†™å’Œéšè—ä¸å…³é”®çš„ç±»ä¿¡æ¯ï¼Œè¯¦ç»†å¯å‚è€ƒè¿™ç¯‡ææ¡ˆã€‚[Update Notice] åˆè¢«å°ä¼™ä¼´æé†’äº†ä¸€ç¯‡ä»‹ç»ï¼Œå¥½åƒè¿™ç¯‡æ›´æ˜ç¡®çš„è¯´æ˜äº†å½“åˆè®¾è®¡çš„æ€è·¯ã€‚Forum postsFinalå…³äºç±»å‹æ¨æ–­ï¼Œæˆ‘ä¸ªäººè§‰å¾—ç›®å‰ Swift æœ‰ä¸ª bugã€‚ã€‚protocol Flyable {}class Bird: Flyable {}protocol Builder { associatedtype Result: Flyable func build() -&amp;gt; Result}class NatureBuilder: Builder { func build() -&amp;gt; some Flyable { return Bird() } func bar() -&amp;gt; Result { return Bird() // Error: Cannot convert return expression of type &#39;Bird&#39; to return type &#39;some Flyable&#39; }}æŒ‰æ­£å¸¸è¯­è¨€é€»è¾‘æ¥æ¨æ–­çš„è¯ï¼Œåœ¨ build() æ–¹æ³•è¿”å› Bird() çš„æ—¶å€™å°±ç›¸å½“äºç¼–è¯‘å™¨å·²çŸ¥é“ Builder.Ressult = Birdã€‚ä½†æ˜¯åœ¨å…¶ä»–æ–¹æ³•è¿”å›å€¼ç±»å‹ä¸º Result çš„æ–¹æ³•ä¸­ï¼Œä¸è®ºè¿”å›ä»€ä¹ˆéƒ½ä¼šæŠ¥é”™ã€‚å½“ç„¶åœ¨ä¸Šé¢çš„ä¾‹å­ä¸Šæˆ‘ä»¬å¯ä»¥æŠŠ bar() çš„è¿”å›å€¼æ”¹æˆ Bird ä»¥è§„é¿é—®é¢˜ã€‚åœ¨èŒƒå‹ç±»ä¸­åŒæ ·ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ã€‚class NatureBuilder&amp;lt;T: Flyable&amp;gt;: Builder { func build() -&amp;gt; some Flyable { return T() } func bar() -&amp;gt; Result { return T() // Error:... }}æˆ‘ä»¬åŒæ ·éœ€è¦æŠŠ bar() çš„è¿”å›å€¼æ”¹æˆ T æ‰å¯ä»¥ï¼Œæ¢å¥è¯è¯´è¿™ç§æƒ…å†µä¸‹ Builder.Result åªèƒ½äºå†…éƒ¨æˆ–ç›¸å…³æ–¹æ³•äº†ï¼Œä¸èƒ½æ‰©å±•å…¶ä»–æ–¹æ³•ã€‚è¿™åº”è¯¥ç®—ä¸ª bug å§lolï¼Ÿ" }, { "title": "Compare between RxSwift and ReactiveSwift", "url": "/posts/Compare-between-RxSwift-and-ReactiveSwift/", "categories": "Tech, FRP", "tags": "FRP, Swift, ReactiveSwift, RxSwift", "date": "2021-11-10 18:32:00 +0800", "snippet": "If you asking me which framework should we prefer to use now, my answer is RxSwiftğŸ™ˆ. RxSwift ç¤¾åŒºæ›´ä¸ºæ´»è·ƒï¼Œå¹¶ä¸” RxSwift å®ç°çš„æ˜¯ Rx é€šç”¨æ¥å£ï¼ˆåŠ ä¸Šä¸€ç‚¹ç‚¹ğŸ¤è¯­è¨€ç‰¹æ€§åŠŸèƒ½ï¼‰ï¼Œæ‰€ä»¥æ›´å®¹æ˜“æ‰¾åˆ°æ–‡æ¡£æˆ–æŸ¥æ‰¾åˆ°ç›¸å…³è®¨è®ºï¼ˆåŒ…æ‹¬ç›®å‰ RxSwift å·²ç»å¼€å§‹å¼€å‘ concurrency ç›¸å…³çš„ feature äº†ï¼Œ ReactiveSwift ä¸€ç‚¹åŠ¨é™éƒ½æ²¡æœ‰ã€‚ã€‚ï¼‰ã€‚ ReactiveSwift å†·çƒ­ä¿¡å·åœ¨ä¸€äº›ç»†èŠ‚ä¸Šæ¯”è¾ƒéš¾ä»¥ç†è§£ï¼Œæ¯”å¦‚ signal.producer äº§ç”Ÿçš„ producer å’Œ signal ä¼¼ä¹æ²¡ä»€ä¹ˆå·®åˆ«ã€‚ RxSwift çš„è®¢é˜…æ–¹æ³•è¿”å›å€¼ disposable æ˜¯ä¸èƒ½é»˜è®¤å¿½ç•¥çš„ï¼Œæ‰€ä»¥æ›´å¼ºè°ƒäº†ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ ReactiveSwift æ²¡æœ‰ shareã€replay æ–¹æ³•ï¼Œæƒ³åœ¨è®¢é˜…çš„æ—¶å€™æ‹¿åˆ°ä¹‹å‰çš„å€¼ç›®å‰æˆ‘ä¸ªäººä¼šæŠŠå®ƒä» Signal æ¢æˆç”¨ Propertyï¼Œå†ç”¨ Property.producer æ¥è·å–åˆ°æœ€è¿‘çš„ä¸€ä¸ªå€¼ã€‚ä¸€ç‚¹ç‚¹å¥‡æ€ªğŸ¤ï¼Œå¯èƒ½æ˜¯æˆ‘æ²¡æŒæ¡çœŸæ­£çš„æ–¹å¼ğŸ˜‚ã€‚ RxSwift ä¸­ flatMap å’Œ flatMapLatest å®šä¹‰è·Ÿ ReactiveSwift ä¸­çš„ flatMap(strategy:) è®¾è®¡è§’åº¦ä¼¼ä¹å®Œå…¨ä¸ä¸€æ ·ï¼Œç›®å‰æˆ‘ä¹Ÿæ²¡æ³•è¯´å“ªä¸ªè®¾è®¡çš„æ›´å¥½ï¼Œä¸è¿‡ ReactiveSwift ä¸­çš„ä¼¼ä¹æ›´å¥½ç†è§£å’Œç®€å•ã€‚ RxSwift demo ä¸­çš„ flatMap &amp;amp; flatMapLaest çš„ä¾‹å­è®¾è®¡éƒ½å¾ˆå¤æ‚ï¼Œä¸è¿‡çœ‹èµ·æ¥æ›´åŠ â€œå“åº”å¼â€ã€‚// ReactSwift re-write RxSwift flatMap demoscopedExample(&quot;signal map signal&quot;) { struct People { let age: MutableProperty&amp;lt;Int&amp;gt; init(age: Int) { self.age = MutableProperty(wrappedValue: age) } } let (people, pInput) = Signal&amp;lt;People, Never&amp;gt;.pipe() let some = People(age: 10) pInput.send(value: some) people.flatMap(.latest) { p in return p.age.producer }.observeValues { age in print(age) } some.age.value = 11 // here won&#39;t print, different from RxSwift. let some2 = People(age: 20) pInput.send(value: some2) some2.age.value = 22}" }, { "title": "Chirpy - Installations and Functions", "url": "/posts/Chirpy-Installations-and-Functions/", "categories": "Blogging, Tutorial", "tags": "typography", "date": "2019-08-08 11:33:00 +0800", "snippet": "Customize the faviconThe favicons of Chirpy are placed in the directory assets/img/favicons/. You may want to replace them with your own. The following sections will guide you to create and replace the default favicons.Generate the faviconPrepare a square image (PNG, JPG, or SVG) with a size of 512x512 or more, and then go to the online tool Real Favicon Generator and click the button Select your Favicon image to upload your image file.In the next step, the webpage will show all usage scenarios. You can keep the default options, scroll to the bottom of the page, and click the button Generate your Favicons and HTML code to generate the favicon.Download &amp;amp; ReplaceDownload the generated package, unzip and delete the following two from the extracted files: browserconfig.xml site.webmanifestNow, copy the remaining image files (PNG and ICO) to cover the original files in the folder assets/img/favicons/ of your Jekyll site. If your Jekyll site doesnâ€™t have this directory yet, just create one.The following table will help you understand the changes to the favicon files: File(s) From Online Tool From Chirpy *.PNG âœ“ âœ— *.ICO âœ“ âœ— browserconfig.xml âœ— âœ“ site.webmanifest âœ— âœ“ Note: âœ“ means keep, âœ— means delete.The next time you build the site, the favicon will be replaced with a customized edition.This post is to show Markdown syntax rendering on Chirpy, you can also use it as an example of writing. Now, letâ€™s start looking at text and typography.Text and TypographyTitlesH1 - headingH2 - headingH3 - headingH4 - headingParagraphI wandered lonely as a cloudThat floats on high oâ€™er vales and hills,When all at once I saw a crowd,A host, of golden daffodils;Beside the lake, beneath the trees,Fluttering and dancing in the breeze.ListsOrdered list Firstly Secondly ThirdlyUnordered list Chapter Section Paragraph Task list TODO Completed Defeat COVID-19 Vaccine production Economic recovery People smile again Description list Sun the star around which the earth orbits Moon the natural satellite of the earth, visible by reflected light from the sunBlock Quote This line to shows the Block Quote.Tables Company Contact Country Alfreds Futterkiste Maria Anders Germany Island Trading Helen Bennett UK Magazzini Alimentari Riuniti Giovanni Rovelli Italy Linkshttp://127.0.0.1:4000FootnoteClick the hook will locate the footnote1, and here is another footnote2.Images Default (with caption)Full screen width and center alignment Shadowshadow effect (visible in light mode) Left aligned Float to left â€œA repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space.â€ Float to right â€œA repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space. A repetitive and meaningless text is used to fill the space.â€ Mermaid SVG gantt title Adding GANTT diagram functionality to mermaid apple :a, 2017-07-20, 1w banana :crit, b, 2017-07-23, 1d cherry :active, c, after b a, 1dMathematicsThe mathematics powered by MathJax:\\[\\sum_{n=1}^\\infty 1/n^2 = \\frac{\\pi^2}{6}\\]When $a \\ne 0$, there are two solutions to $ax^2 + bx + c = 0$ and they are\\[x = {-b \\pm \\sqrt{b^2-4ac} \\over 2a}\\]Inline codeThis is an example of Inline Code.Code blockCommonThis is a common code snippet, without syntax highlight and line number.Specific LanguagesConsole$ env |grep SHELLSHELL=/usr/local/bin/bashPYENV_SHELL=bashShellif [ $? -ne 0 ]; then echo &quot;The command was not successful.&quot;; #do the needful / exitfi;Specific filename@import &quot;colors/light-typography&quot;, &quot;colors/dark-typography&quot;Reverse FootnoteEnable Google PVThis post is to enable Page Views on the Chirpy theme based blog that you just built. This requires technical knowledge and itâ€™s recommended to keep the google_analytics.pv.* empty unless you have a good reason. If your website has low traffic, the page views count would discourage you to write more blogs. With that said, letâ€™s start with the setup.Set up Google AnalyticsCreate GA account and propertyFirst, you need to set up your account on Google analytics. While you create your account, you must create your first Property as well. Head to https://analytics.google.com/ and click on Start Measuring Enter your desired Account Name and choose the desired checkboxes Enter your desired Property Name. This is the name of the tracker project that appears on your Google Analytics dashboard Enter the required information About your business Hit Create and accept any license popup to set up your Google Analytics account and create your propertyCreate Data StreamWith your property created, you now need to set up Data Stream to track your blog traffic. After you signup, the prompt should automatically take you to create your first Data Stream. If not, follow these steps: Go to Admin on the left column Select the desired property from the drop-down on the second column Click on Data Streams Add a stream and click on Web Enter your blogâ€™s URLIt should look like this:Now, click on the new data stream and grab the Measurement ID. It should look something like G-V6XXXXXXXX. Copy this to your _config.yml filegoogle_analytics: id: &#39;G-V6XXXXXXX&#39; # fill in your Google Analytics ID # Google Analytics pageviews report settings pv: proxy_endpoint: # fill in the Google Analytics superProxy endpoint of Google App Engine cache_path: # the local PV cache data, friendly to visitors from GFW regionWhen you push these changes to your blog, you should start seeing the traffic on your Google Analytics. Play around with the Google Analytics dashboard to get familiar with the options available as it takes like 5 mins to pick up your changes. You should now be able to monitor your traffic in real time.Setup Page ViewsThere is a detailed tutorial available to set up Google Analytics superProxy. But, if you are interested to just quickly get your Chirpy-based blog display page views, follow along. These steps were tested on a Linux machine. If you are running Windows, you can use the Git bash terminal to run Unix-like commands.Setup Google App Engine Visit https://console.cloud.google.com/appengine Click on Create Application Click on Create Project Enter the name and choose the data center close to you Select Python language and Standard environment Enable billing account. Yeah, you have to link your credit card. But, you wonâ€™t be billed unless you exceed your free quota. For a simple blog, the free quota is more than sufficient. Go to your App Engine dashboard on your browser and select API &amp;amp; Services from the left navigation menu Click on Enable APIs and Services button on the top Enable the following APIs: Google Analytics API On the left, Click on OAuth Consent Screen and accept Configure Consent Screen. Select External since your blog is probably hosted for the public. Click on Publish under Publishing Status Click on Credentials on the left and create a new OAuth Client IDs credential. Make sure to add an entry under Authorized redirect URIs that matches: https://&amp;lt;project-id&amp;gt;.&amp;lt;region&amp;gt;.r.appspot.com/admin/auth Note down the Your Client ID and Your Client Secret. Youâ€™ll need this in the next section. Download and install the cloud SDK for your platform: https://cloud.google.com/sdk/docs/quickstart Run the following commands: [root@bc96abf71ef8 /]# gcloud init~snip~Go to the following link in your browser: https://accounts.google.com/o/oauth2/auth?response_type=code&amp;amp;client_id=XYZ.apps.googleusercontent.com&amp;amp;redirect_uri=ABCDEFGEnter verification code: &amp;lt;VERIFICATION CODE THAT YOU GET AFTER YOU VISIT AND AUTHENTICATE FROM THE ABOVE LINK&amp;gt;You are logged in as: [blah_blah@gmail.com].Pick cloud project to use:[1] chirpy-test-300716[2] Create a new projectPlease enter numeric choice or text value (must exactly match listitem): 1[root@bc96abf71ef8 /]# gcloud info# Your selected project info should be displayed here Setup Google Analytics superProxy Clone the Google Analytics superProxy project on Github: https://github.com/googleanalytics/google-analytics-super-proxy to your local. Remove the first 2 lines in the src/app.yaml file: - application: your-project-id- version: 1 In src/config.py, add the OAUTH_CLIENT_ID and OAUTH_CLIENT_SECRET that you gathered from your App Engine Dashboard. Enter any random key for XSRF_KEY, your config.py should look similar to this #!/usr/bin/python2.7 __author__ = &#39;pete.frisella@gmail.com (Pete Frisella)&#39; # OAuth 2.0 Client Settings AUTH_CONFIG = { &#39;OAUTH_CLIENT_ID&#39;: &#39;YOUR_CLIENT_ID&#39;, &#39;OAUTH_CLIENT_SECRET&#39;: &#39;YOUR_CLIENT_SECRET&#39;, &#39;OAUTH_REDIRECT_URI&#39;: &#39;%s%s&#39; % ( &#39;https://chirpy-test-XXXXXX.ue.r.appspot.com&#39;, &#39;/admin/auth&#39; ) } # XSRF Settings XSRF_KEY = &#39;OnceUponATimeThereLivedALegend&#39; Tip: You can configure a custom domain instead of https://PROJECT_ID.REGION_ID.r.appspot.com. But, for the sake of keeping it simple, we will be using the Google provided default URL. From inside the src/ directory, deploy the app [root@bc96abf71ef8 src]# gcloud app deploy Services to deploy: descriptor: [/tmp/google-analytics-super-proxy/src/app.yaml] source: [/tmp/google-analytics-super-proxy/src] target project: [chirpy-test-XXXX] target service: [default] target version: [VESRION_NUM] target url: [https://chirpy-test-XXXX.ue.r.appspot.com] Do you want to continue (Y/n)? Y Beginning deployment of service [default]... â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â• â• Uploading 1 file to Google Cloud Storage â•â•£ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• File upload done. Updating service [default]...done. Setting traffic split for service [default]...done. Deployed service [default] to [https://chirpy-test-XXXX.ue.r.appspot.com] You can stream logs from the command line by running: $ gcloud app logs tail -s default To view your application in the web browser run: $ gcloud app browse Visit the deployed service. Add a /admin to the end of the URL. Click on Authorize Users and make sure to add yourself as a managed user. If you get any errors, please Google it. The errors are self-explanatory and should be easy to fix.If everything went good, youâ€™ll get this screen:Create Google Analytics QueryHead to https://PROJECT_ID.REGION_ID.r.appspot.com/admin and create a query after verifying the account. GA Core Reporting API query request can be created in Query Explorer.The query parameters are as follows: start-date: fill in the first day of blog posting end-date: fill in today (this is a parameter supported by GA Report, which means that it will always end according to the current query date) metrics: select ga:pageviews dimensions: select ga:pagePathIn order to reduce the returned results and reduce the network bandwidth, we add custom filtering rules 3: filters: fill in ga:pagePath=~^/posts/.*/$;ga:pagePath!@=. Among them, ; means using logical AND to concatenate two rules. If the site.baseurl is specified, change the first filtering rule to ga:pagePath=~^/BASE_URL/posts/.*/$, where BASE_URL is the value of site.baseurl. After Run Query, copy the generated contents of API Query URI at the bottom of the page and fill in the Encoded URI for the query of SuperProxy on GAE.After the query is saved on GAE, a Public Endpoint (public access address) will be generated, and we will get the query result in JSON format when accessing it. Finally, click Enable Endpoint in Public Request Endpoint to make the query effective, and click Start Scheduling in Scheduling to start the scheduled task.Configure Chirpy to Display Page ViewOnce all the hard part is done, it is very easy to enable the Page View on Chirpy theme. Your superProxy dashboard should look something like below and you can grab the required values.Update the _config.yml file of Chirpy project with the values from your dashboard, to look similar to the following:google_analytics: id: &#39;G-V6XXXXXXX&#39; # fill in your Google Analytics ID pv: proxy_endpoint: &#39;https://PROJECT_ID.REGION_ID.r.appspot.com/query?id=&amp;lt;ID FROM SUPER PROXY&amp;gt;&#39; cache_path: # the local PV cache data, friendly to visitors from GFW regionNow, you should see the Page View enabled on your blog.Reference The footnote sourceÂ &amp;#8617; The 2nd footnote sourceÂ &amp;#8617; Google Analytics Core Reporting API: FiltersÂ &amp;#8617; " }, { "title": "Codable introduced in Swift 4.0", "url": "/posts/Swift-Codable/", "categories": "Tech, Swift", "tags": "Swift, Codable", "date": "2018-06-13 10:55:00 +0800", "snippet": "Swift CodableCodable å…¶å®æ˜¯ç»„åˆåè®®ï¼štypealiase Codable = Encodable &amp;amp; DecodableSwift åŸºç¡€åº“ä¸­çš„ Codableã€JSONEncoderã€PropertiesListEncoder ç»™æˆ‘ä»¬æä¾›äº†æ—¥å¸¸æ‰€ç”¨çš„åŸºç¡€åŠŸèƒ½ã€‚ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œä»¥ JSONEncoder ä¸ºä¾‹ã€‚struct Cat: Codable { let name: String var age: Int}let sahra = Cat(with: &quot;Sahra&quot;, age: 1)if let result = try? JSONEncoder.encode(aCat) { let stringValue = String.init(data: result, encoding: .utf8) print(stringValue)}// Output:&quot;{&quot;name&quot;:&quot;Sahra&quot;,&quot;age&quot;:1}&quot;ä¸“ç”¨å®¹å™¨Codable çš„é»˜è®¤å®ç°æ˜¯æŠŠå½“å‰ç±»å‹ä¸­çš„å˜é‡éƒ½é»˜è®¤è½¬æ¢ï¼Œå¦‚æœä½ å®šä¹‰çš„ç±»å‹ä¸­ï¼Œè¦å«æœ‰ä¸€äº›å…¶ä»–å±æ€§ï¼Œè€Œä¸å¸Œæœ›è¿™äº›å±æ€§è‡ªåŠ¨è½¬æ¢ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå®¹å™¨æ¥ä½¿ç”¨ã€‚struct CatContainer { let cat: Cat init(with cat: Cat) { self.cat = cat } // Other properties var storedID: String = &quot;&quot;}ä¾å®é™…ä½¿ç”¨çš„æƒ…å†µè€Œå®šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ³›å‹çš„å®¹å™¨ã€‚struct Container&amp;lt;T: Codable&amp;gt; { let element: T init(with element: T) { self.element = element }}é‡å®šä¹‰ CodingKeysæˆ‘ä»¬å¯ä»¥ç”¨å¦å¤–ä¸€ç§æ–¹æ³•å¿½ç•¥éƒ¨åˆ†å±æ€§æˆ–è€…æ”¹å˜ç¼–ç æˆ–è§£ç å¯¹åº”çš„ key å€¼ã€‚åœ¨ç»“æ„ä½“æˆ–ç±»ä¸­å®šä¹‰æšä¸¾ç±»å‹ CodingKeysï¼Œå°†éœ€è¦ç¼–ç çš„å±æ€§åŒ…å«å…¶ä¸­ã€‚å¦‚æœéœ€è¦æ”¹å˜ç¼–ç åçš„å‘½åï¼Œåˆ™ç”¨æšä¸¾ String raw value æ¥è¡¨ç¤ºç›¸åº”å±æ€§ã€‚æ™®é€šæƒ…å†µä¸‹ï¼Œç”¨ Int ç±»å‹ä¼šèŠ‚çœå¼€é”€ã€‚struct Cat: Codable { let name: String var age: Int = 0 // å¦‚æœæ²¡æœ‰åˆå§‹å€¼ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ enum CodingKeys: String, CodingKey { case name = &quot;pet_name&quot; }}// Output:&quot;{&quot;pet_name&quot;:&quot;Sahra&quot;}&quot;CodingKeys ä¸­çš„å…ƒç´ åå¿…é¡»ä¸å±æ€§åä¸€ä¸€å¯¹åº”ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ›´è¿›ä¸€æ­¥è‡ªå®šä¹‰ç¼–è§£ç åŠ¨ä½œï¼Œæ¯”å¦‚ nested å‹ç»“æ„çš„ç¼–è§£ç ï¼Œå¯ä»¥åœ¨è¿™ç¯‡å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°æ›´å¤šä¿¡æ¯ã€‚Tips Optional ç±»å‹ç³»ç»Ÿé»˜è®¤å¯¹äº Optional çš„å®ç°æ˜¯ï¼Œå¦‚æœä¸º nil çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå°†è¯¥å±æ€§ç¼–ç ã€‚å¦‚æœä½ çš„ä¸šåŠ¡æ–¹éœ€è¦åœ¨å±æ€§ä¸ºç©ºæ—¶ï¼ŒJSON å¯¹è±¡ä¸­è¡¨ç¤º nullçš„è¯ï¼Œéœ€è¦å®šä¹‰ CodingKeys å¹¶æŒ‡å®šå«æœ‰è¿™ä¸ªå±æ€§å³å¯ã€‚ å…³äº [Hashable: Any] ç±»å‹çš„ç¼–è§£ç å¯¹äºä»£ç è¿ç§»çš„å·¥ç¨‹æ¥è¯´ï¼Œæœ‰å¾ˆå¤šéƒ¨åˆ†ä»£ç è¿˜ä½¿ç”¨ä¾‹å¦‚ [String: Any] çš„å­—å…¸ç±»å‹æ¥ä¼ é€’æ•°æ®ã€‚Any å¹¶ä¸ç¬¦åˆ Codable åè®®ï¼Œæ‰€ä»¥æ˜¯æ—¶å€™ä½¿ç”¨ [Hashable: Codable] é‡æ„è¿™éƒ¨åˆ†ä»£ç äº†:)é—®é¢˜ æ²¡æœ‰æ‰¾åˆ° Codable çš„åè®®é»˜è®¤å®ç°ï¼Œå´å¯ä»¥ä¸ç”¨å®ç°åè®®æ–¹æ³•ã€‚ CodingKeys çš„å®ç°åŸç†ï¼Œç»“åˆç¼–è¯‘ä¿¡æ¯ï¼ŒçŒœæµ‹æ˜¯ç¼–è¯‘æ—¶æœŸå·¥ä½œã€‚é€šè¿‡ä»£ç åŠæ³¨é‡Šä¿¡æ¯ï¼Œå…¶å®æ˜¯åˆ†è¾¨ä¸å‡ºæ¥ CodingKeys çš„ç”¨æ³•çš„ï¼Œéœ€è¦å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ä¸ªäººè§‰å¾—è¿™æ˜¯ç¼ºç‚¹ä¹‹ä¸€ï¼Œä¸€æ˜¯è§‰å¾—å®ç°åŸç†ä¸é€æ˜ï¼Œä¸å¤ªå®¹æ˜“ç†è§£ï¼›äºŒæ˜¯æ²¡æœ‰æ˜¾å¼è¯´æ˜ Codable å’Œ CodingKeys çš„å…³ç³»ã€‚æ¯”å¦‚ç±»å‹ä¸­éœ€è¦ç¼–è§£ç çš„å±æ€§å…¶å®ç¼–è¯‘æ—¶æœŸéƒ½ä¼šæ ¡éªŒæ˜¯å¦éƒ½æ˜¯ Codable çš„ï¼Œè¿™ç‚¹åœ¨ç¼–ç çš„æ—¶å€™æ˜¯ä½“ç°ä¸å‡ºæ¥çš„ã€‚" }, { "title": "Swift Tips (3) - Protocol", "url": "/posts/Swift-Tips-(3)/", "categories": "Tech, Swift", "tags": "Swift", "date": "2018-06-07 15:55:00 +0800", "snippet": "protocol ç»„åˆå…¶å® Any æ˜¯ protocol&amp;lt;&amp;gt; çš„åŒåå†™æ³•ï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºä»»æ„ç±»å‹ã€‚protocol&amp;lt;&amp;gt; çš„æ ‡å‡†è¯­æ³•å½¢å¼æ˜¯ï¼šprotocol&amp;lt;ProtocolA, ProtocalB&amp;gt;ã€‚protocol ç»„åˆæ˜¯å¯ä»¥ä½¿ç”¨ typealias æ¥å‘½åçš„ï¼Œè¿™æ ·å¯ä»¥æé«˜æˆ‘ä»¬çš„ä»£ç å¯è¯»æ€§ï¼štypealise ServerType = protocol&amp;lt;URLDestination, DataResolver&amp;gt;å¯é€‰æ¥å£ (optional protocol)ä¸€ç§æ–¹æ³•æ˜¯æ ‡è®° protocol ä¸º@objc, åˆ™å¯ä»¥ä½¿ç”¨ Objective-C ä¸­çš„å…³é”®å­—optional:@objc protocol OptionalProtocol { optional func optionalMethod()}ä½†æ˜¯ç¼ºç‚¹æ˜¯,@objcä¿®é¥°çš„ protocol åªèƒ½æä¾›ç»™ç±»ä½¿ç”¨,struct å’Œ enum ä¸èƒ½ç»§æ‰¿ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å¦ä¸€ç§åŠæ³• extension protocol,ç»™ protocol çš„æ–¹æ³•æä¾›é»˜è®¤å®ç°ã€‚protocol OptionalProtocol { func optionalMethod()}extension OptionalProtocol { func optionalMethod() { ... }}Class A: OptionalProtocol { }let a = A()a.optionalMethod()æ¥å£æ‰©å±•ä¹‹å,ç±»å®ç°æ¥å£çš„é»˜è®¤æ–¹æ³•å®ç°,å³æ˜¯æ‰©å±•é‡Œçš„å®ç°æ–¹æ³•ã€‚è¿™ä¸ªå†™æ³•ä¹Ÿæœ‰ä¸ªåå¤„,å…¶ä»–çš„ä½¿ç”¨è€…å¯èƒ½ä¼šä¸äº†è§£æ¥å£å·²ç»åšè¿‡æ‰©å±•,æ‰€ä»¥åè®®å’Œæ‰©å±•å°½é‡å†™åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­,å¹¶æ³¨é‡Šæ¸…æ¥šã€‚protocol æ‰©å±•å’Œæ–¹æ³•è¦†ç›–protocol æ‰©å±•å¯ä»¥ä¸º protocol ç±»å‹æä¾›é¢å¤–çš„æ–¹æ³•å®ç°ï¼Œå°±å¦‚ optional å®ç°åŸç†ä¸€æ ·ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å…·ä½“ç±»çš„å®ç°ä¸­è¦†ç›–è¿™äº›æ–¹æ³•ï¼šprotocol Progress { func start()}extension Progress { func start() { print(&quot;nothing&quot;) }}class Request: Progress { func start() { print(&quot;request&quot;) }}let req = Request()req.start() // Print:// requesté‚£ç°åœ¨å†ç»™ Progress æ‰©å±•ä¸€ä¸ªå®šä¹‰ä¸­ä¸å«æœ‰çš„æ–¹æ³•ï¼šextension Progress { func cancel() { print(&quot;nothing&quot;) }}class Request: Progress { func start() { print(&quot;request&quot;) } func cancel() { print(&quot;cancel&quot;) }}let req = Request()req.cancel() ==&amp;gt; cancel(req as Progress).cancel() ==&amp;gt; nothingå¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºç±»å’Œæ¥å£é‡Œéƒ½å®ç°äº†æ–¹æ³•ï¼Œä¸”æ–¹æ³•ä¸åœ¨æ¥å£å®šä¹‰ä¸­æ—¶ï¼Œå®é™…è°ƒç”¨æ—¶æ ¹æ®å½“å‰ç±»å‹åˆ¤æ–­çš„ï¼Œå¦‚æœæ˜¯ Request åˆ™è°ƒç”¨ç±»ä¸­çš„æ–¹æ³•ï¼Œå¦‚æœæ˜¯ Protocol åˆ™è°ƒç”¨åè®®æ‰©å±•ä¸­çš„æ–¹æ³•ã€‚Protocol Assosiated Typeæˆ‘ä»¬å¯ä»¥åœ¨ protocol ä¸­æ·»åŠ ä¸€ä¸ª associatedtype ç±»å‹å…³è”ï¼Œå®ç°åè®®çš„ç±»å‹éœ€è¦å®Œæˆåè®®ä¸­çš„ç±»å‹æŒ‡å®šã€‚protocol StorableInfo { associatedtype InfoKey}class Request: StorableInfo { typealias InfoKey: String var storedInfo: [InfoKey: Any]}åœ¨ Swift 4.0 ä¸­å¼•å…¥äº† where æ¡ä»¶è¯­å¥, è¿™æ ·å°±å¯ä»¥æ›´åŠ çµæ´»çš„è¿ç”¨ä¸€äº›æ³›å‹ç±»å‹ã€‚protocol StorableInfo { associatedtype InfoKey where InfoKey: Hashable}// åœ¨ä»¥å‰æ˜¯ç¼–è¯‘ä¸é€šè¿‡çš„ï¼Œå› ä¸º M.InfoKey ä¸ä¸€å®šç¬¦åˆ Hashableclass Request&amp;lt;M: StorableInfo&amp;gt; { var stroedInfo: [M.InfoKey: Any]}Selfã€.self å’Œ .Type .self å®é™…ä¸Šæ˜¯è¿”å›å½“å‰å¯¹è±¡ï¼Œå¦‚æœæ˜¯ç±»å‹å°±è¿”å›å½“å‰ç±»çš„å…ƒç±»å‹ï¼šlet user = User()user.self == user // ==&amp;gt; truelet userType = User.self // User.Type Self ä¸€èˆ¬ä½¿ç”¨åœ¨æ¥å£ä¸­ï¼Œç”¨æ¥è¡¨æ˜å®ç°æ¥å£æœ¬èº«çš„å¯¹è±¡ï¼šprotocol Producer { static func instance() -&amp;gt; Self}extension User: Producer { static func instance() -&amp;gt; Self { return self.init() }} è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œä½¿ç”¨ self.init() è¿”å›æ‰èƒ½ç¬¦åˆ Selfï¼Œè€Œä¸èƒ½ä½¿ç”¨ User() ï¼Œè™½ç„¶è¿™é‡Œ User å’Œ Self ç­‰ä»·ã€‚åŸå› æ˜¯åœ¨ non-final class ä¸­å®ç°æ–¹æ³•ï¼Œè¿™ä¸ªç±»æ˜¯æœ‰å¯èƒ½è¢«ç»§æ‰¿çš„ï¼Œè€Œå¦‚æœä½¿ç”¨ User() è¿™ç§å†™æ³•ï¼Œæ˜¾ç„¶å­ç±»è°ƒç”¨ä¹‹åå°±ä¸ä¼šè¿”å›å­ç±»çš„å¯¹è±¡äº†ã€‚ .Type æ˜¯è¡¨æ˜ä¸€ä¸ªç±»çš„å…ƒç±»å‹ï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨type(of:)æ–¹æ³•æ¥è·å¾—æŒ‡å®šå®ä¾‹çš„å…ƒç±»å‹ï¼šlet type: User.Type = User.selflet metaType = type(of: user) ===&amp;gt; User.Type" }, { "title": "Swift Tips (2) - Standards", "url": "/posts/Swift-Tips-(2)/", "categories": "Tech, Swift", "tags": "Swift", "date": "2018-06-07 15:35:00 +0800", "snippet": "æ–¹æ³•å‚æ•°å‘½åè§„èŒƒç”±äºObjective-C APIçš„å‘½åè½¬æ¢ï¼Œåˆ°Swift APIçš„æ›´æ–°ï¼Œç°åœ¨ï¼ˆSwift 4.0ï¼‰æˆ‘ä»¬æ›´åº”è¯¥ä½¿ç”¨é è¿‘Swiftç³»ç»Ÿçš„å‘½åæ–¹å¼ï¼šfunc convert(_ point: CGPoint, from view: UIView?) -&amp;gt; CGPoint ä¸ç¬¦åˆè§„èŒƒçš„ï¼šfunc convertPoint(_ point: CGPoint, fromView view: UIView?) -&amp;gt; CGPointç±»çš„åˆå§‹åŒ–ç±»çš„åˆå§‹åŒ–æ–¹æ³•åˆ†ä¸ºä¸‰ç§ï¼ŒDESIGNATEDï¼ŒCONVENIENCE å’Œ REQUIREDã€‚å¯¹äºåˆå§‹åŒ–æ–¹æ³•ï¼Œå¿…é¡»éµå¾ªï¼š åˆå§‹åŒ–è·¯å¾„å¿…é¡»ä¿è¯å¯¹è±¡å®Œå…¨åˆå§‹åŒ–ï¼Œè¿™å¯ä»¥é€šè¿‡è°ƒç”¨æœ¬ç±»å‹çš„ designated åˆå§‹åŒ–æ–¹æ³•æ¥å¾—åˆ°ä¿è¯ï¼› å­ç±»çš„ designated åˆå§‹åŒ–æ–¹æ³•å¿…é¡»è°ƒç”¨çˆ¶ç±»çš„ designated æ–¹æ³•ï¼Œä»¥ä¿è¯çˆ¶ç±»ä¹Ÿå®Œæˆåˆå§‹åŒ–ã€‚convenience æ–¹æ³•æ˜¯ Swift åˆå§‹åŒ–æ–¹æ³•ä¸­çš„ â€œäºŒç­‰å…¬æ°‘â€ï¼Œåªä½œä¸ºè¡¥å……å’Œæä¾›ä½¿ç”¨ä¸Šçš„æ–¹ä¾¿ã€‚æ‰€æœ‰çš„ convenience åˆå§‹åŒ–æ–¹æ³•éƒ½å¿…é¡»è°ƒç”¨åŒä¸€ä¸ªç±»ä¸­çš„ designated åˆå§‹åŒ–å®Œæˆè®¾ç½®ï¼Œå¦å¤– convenience çš„åˆå§‹åŒ–æ–¹æ³•æ˜¯ä¸èƒ½è¢«å­ç±»é‡å†™æˆ–è€…æ˜¯ä»å­ç±»ä¸­ä»¥ super çš„æ–¹å¼è¢«è°ƒç”¨çš„ã€‚å¯¹äºæŸäº›æˆ‘ä»¬å¸Œæœ›å­ç±»ä¸­ä¸€å®šå®ç°çš„ designated åˆå§‹åŒ–æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ  required å…³é”®å­—è¿›è¡Œé™åˆ¶ï¼Œå¼ºåˆ¶å­ç±»å¯¹è¿™ä¸ªæ–¹æ³•é‡å†™å®ç°ã€‚è¿™æ ·åšçš„æœ€å¤§çš„å¥½å¤„æ˜¯å¯ä»¥ä¿è¯ä¾èµ–äºæŸä¸ª designated åˆå§‹åŒ–æ–¹æ³•çš„ convenience ä¸€ç›´å¯ä»¥è¢«ä½¿ç”¨ã€‚å±æ€§è®¿é—®æ§åˆ¶ç°åœ¨çš„ Swift ç‰ˆæœ¬ï¼ˆ4.1ï¼‰ï¼Œprivateå…³é”®å­—çš„è®¿é—®æƒé™å·²ç»æ”¹ä¸ºï¼šå½“å‰æ¨¡ç»„ä¸‹çš„ç§æœ‰å±æ€§ã€‚Swift 5.x, private å·²ç»ä¿®æ”¹ä¸ºå½“å‰ class or struct/enumâ€¦ ä¸”åœ¨å½“å‰æ–‡ä»¶ä¸‹æ‰èƒ½è®¿é—®åˆ°çš„ç§æœ‰å±æ€§ã€‚// Module: libSomeclass User { private var id: String}extension User { func foo() { print(id) // accessible }}// Other app or lib:@import libSomeextension User { func bar() { print(id) // value of type &#39;User&#39; has no member &#39;id&#39; }}å…¶ä»–å…³é”®å­—è¿˜æœ‰publicã€internalã€fileprivateï¼Œå«ä¹‰ä¸ºå…¬å¼€ã€å†…éƒ¨ã€æ–‡ä»¶ç§æœ‰ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯internalï¼Œä¸¥æ ¼çš„ä½¿ç”¨è®¿é—®æ§åˆ¶ï¼Œå¯ä»¥ä¼˜åŒ–ä»£ç å’Œæ¨¡ç»„çš„ä½¿ç”¨ï¼Œä¹Ÿä¼šå‡å°‘è®¸å¤šä¸å¿…è¦çš„éº»çƒ¦ã€‚å¦å¤–å¯¹äº Swift ä¸­çš„åªè¯»å±æ€§ä¹Ÿæ˜¯é€šè¿‡è®¿é—®æ§åˆ¶å®Œæˆçš„ï¼šclass User { private(set) var id: String fileprivate(set) var local: String}åµŒå¥— enumåœ¨ enum é‡Œç¼–è¯‘å™¨æ˜¯ä¸å…è®¸ç›´æ¥åµŒå¥—ä½¿ç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ  indirect ä½¿ç¼–è¯‘å™¨é€šè¿‡ç¼–è¯‘ã€‚indirect enum Node&amp;lt;Value&amp;gt; { case empty case value(value: Value, left: Node&amp;lt;Value&amp;gt;, right: Node&amp;lt;Value&amp;gt;)}let leaf = Node.value(value: 1, left: .empty, right: .empty)LockObjective-C ä¸­çš„@synchronizedå…¶å®æ˜¯ä½¿ç”¨äº†äº’æ–¥é”objc_syncä¸­çš„objc_sync_enterå’Œobcj_sync_exitæ–¹æ³•ã€‚åœ¨ Swift ä¸­æˆ‘ä»¬å¯ä»¥ä»¿å†™ä¸€ä¸‹ï¼šfunc synchronized(_ obj: AnyObject, closure: () -&amp;gt; Void) { objc_sync_enter(obj) closure() objc_sync_exit(obj)}func foo() { ... synchronized(anObj) { ... }}è¿™æ ·å°±å¯ä»¥ç®€å•çš„ç»™ä¸€ä¸ªå¯¹è±¡åŠ é”äº†ã€‚è‡ªæ—‹é” OSSpinLock ä½œä¸ºä¸€ä¸ªé«˜æ€§èƒ½çš„è‡ªæ—‹é”ï¼Œä»¥å‰è¢«åŸºç¡€æ¡†æ¶å¹¿æ³›ä½¿ç”¨ï¼Œä½†æ˜¯åæ¥è‹¹æœå·¥ç¨‹å¸ˆè¯å®ä¸€äº›çº¿ç¨‹ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ï¼Œä¼šé€ æˆä¼˜å…ˆçº§ç¿»è½¬é—®é¢˜ï¼Œé€ æˆè‡ªæ—‹é”è¢«ç ´åã€‚ä½œä¸ºé«˜æ€§èƒ½é”çš„æ›¿æ¢ï¼Œä¸€äº›å¤§å…¬å¸çš„æ¡†æ¶ä¼šä½¿ç”¨ dispatch_semaphore ã€ pthread_mutex ã€ NSLockã€‚ dispatch_semaphore GCD ä¸­çš„ä¿¡å·é‡ï¼Œç”¨æ³•ç®€å•ï¼Œåœ¨è°ƒç”¨wait()æ—¶å¦‚æœä¿¡å·é‡ä¸ºè´Ÿåˆ™ä¼šé˜»æ–­å½“å‰çº¿ç¨‹ï¼Œå®ç°ä¸åŒçº¿ç¨‹çš„äº’æ–¥ã€‚ let semaphore = DispatchSemaphore(value: 0)func foo() { dispatch_global_async(.default) { sleep(10) semaphore.signal() } semaphore.wait() ...}// orfunc bar() { semaphore.wait(); defer { semaphore.signal() } ... // æ–¹æ³•å†…æ˜¯å•çº¿ç¨‹åŠ é”è®¿é—®çš„} pthread_mutex äº’æ–¥é” pthread_mutex æ˜¯ Linux å’Œ Mac ç³»ç»Ÿå¸¸ç”¨çš„äº’æ–¥é”ï¼Œä½¿ç”¨æ–¹æ³•ä¸æ™®é€šäº’æ–¥é”ä¸€æ ·ï¼Œè€Œå·²å®ç°çº¿ç¨‹åŒæ­¥ã€‚å…·ä½“çš„ä½¿ç”¨æ•™ç¨‹å¯å‚è€ƒ Googleã€‚ NSLock NSLock å…¶å®æ˜¯å¯¹ pthread_mutex çš„ä¸€å±‚å°è£…ã€‚ " }, { "title": "Swift Tips (1) - Function", "url": "/posts/Swift-Tips-(1)/", "categories": "Tech", "tags": "Swift", "date": "2018-06-07 15:27:00 +0800", "snippet": "å‡½æ•°çš„æŸ¯é‡ŒåŒ–Swift é‡Œå¯ä»¥å°†æ–¹æ³•è¿›è¡ŒæŸ¯é‡ŒåŒ– (Currying)ï¼Œè¿™æ˜¯ä¹Ÿå°±æ˜¯æŠŠæ¥å—å¤šä¸ªå‚æ•°çš„æ–¹æ³•è¿›è¡Œä¸€äº›å˜å½¢ï¼Œä½¿å…¶æ›´åŠ çµæ´»çš„æ–¹æ³•ã€‚åœ¨éå‡½æ•°å¼çš„ä»£ç æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·å†™ä¸€ä¸ªæ–¹æ³•ï¼šfunc isNumber(_ base: Int, greaterThan target: Int) -&amp;gt; Bool { return base &amp;gt; target}åŒæ ·çš„åŠŸèƒ½å¦‚æœä½¿ç”¨æŸ¯é‡ŒåŒ–çš„å‡½æ•°ï¼šfunc greaterThan(comparer: Int) -&amp;gt; Int -&amp;gt; Bool { return { $0 &amp;gt; comparer }}let greaterThan10 = greaterThan(10);greaterThan10(13) // =&amp;gt; truegreaterThan10(9) // =&amp;gt; falseæŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§é‡äº§ç›¸ä¼¼æ–¹æ³•çš„å¥½åŠæ³•ã€‚ä½¿ç”¨å‡½æ•°å½“åšå¯¹è±¡æˆ‘ä»¬å¯ä»¥ç»“åˆå‡½æ•°å®ç°è¯¸å¤šç®€ä¾¿çš„åŠŸèƒ½ï¼Œåœ¨ Swift ä¸­ï¼Œå‡½æ•°ä¹Ÿæ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œåˆ©ç”¨å‡½æ•°æœ¬èº«çš„ç‰¹ç‚¹ï¼Œå¯ä»¥æ›´é«˜æ•ˆçš„ç»„åˆå‡ºæƒ³è¦çš„åŠŸèƒ½ã€‚ä¸¾ä¾‹ï¼šæˆ‘ä»¬å¯ä»¥ç»™Array&amp;lt;Element&amp;gt;æ·»åŠ æ–¹æ³•ï¼Œè·å–ä¸€ä¸ªcontainsçš„(Element) -&amp;gt; Boolçš„ç±»å‹çš„å‡½æ•°è¾“å‡ºã€‚extension Array where Element: Equatable { public static func contains&amp;lt;T: Equatable&amp;gt;(in array: [T]) -&amp;gt; (T) -&amp;gt; Bool { return { obj in return (array.filter { $0 == obj }).count &amp;gt; 0 } } public static func notContains&amp;lt;T: Equatable&amp;gt;(in array: [T]) -&amp;gt; (T) -&amp;gt; Bool { return { obj in return !contains(in: array)(obj) } } public func intersection(with other: [Element]) -&amp;gt; [Element] { return self.filter(Array.contains(in: other)) } public func union(with other: [Element]) -&amp;gt; [Element] { return self + other.minus(with: self) } public func minus(with other: [Element]) -&amp;gt; [Element] { return self.filter(Array.notContains(in: other)) }}let contains = Array.contains(in: [1, 2, 3])contains(1) ==&amp;gt; truecontains(4) ==&amp;gt; false[1, 2, 3].intersection(with: [2, 3]) ==&amp;gt; [2, 3][1, 2, 3].minus(with: [2, 3]) ==&amp;gt; [1][1, 2, 3].union(with: [3, 4]) ==&amp;gt; [1, 2, 3, 4]å¯¹äºä»»ä½•å®ç°äº†Equatableçš„å¯¹è±¡é›†åˆï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•åšè¿ç®—ã€‚Tuple å…ƒç»„Tuple æ˜¯ Swift å¸¦ç»™æˆ‘ä»¬çš„æ–°åŠŸèƒ½ï¼Œåœ¨æ™®é€šåœºæ™¯ä¸‹ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸»è¦æœ‰ä¸¤ç‚¹åŠŸèƒ½ï¼š æ ‡æ˜å«ä¹‰ï¼šè‡ªå·±æˆ–å…¶ä»–å°ä¼™ä¼´åœ¨æ¥æ”¶åˆ°è¿™ä¸ªå‚æ•°æ—¶ï¼Œå¾ˆå®¹æ˜“æ ¹æ®å‚æ•°æ ‡è¯†æ¥åˆ†è¾¨å…ƒç»„å†…çš„å±æ€§å«ä¹‰ã€‚switch some { case let x: x.up = ... x.down = ...} å‡½æ•°çš„å¤šç»“æœè¾“å‡ºï¼šå½“ä¸€ä¸ªå‡½æ•°æƒ³è¾“å‡ºå¤šä¸ªæ•°æ®ï¼Œè€Œæ•°æ®ä¹‹é—´æ¯«æ— å…³è”ï¼Œä¸èƒ½ç»“åˆæˆä¸€ä¸ªå¯¹è±¡ï¼›æˆ–ä¿¡æ¯å¤ªå°‘ä¸è‡³äºç”¨å¯¹è±¡ä»£æ›¿æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šå…ƒç»„å½“åšå‡½æ•°çš„è¾“å‡ºã€‚è¿™ç‚¹è·ŸGoè¯­è¨€çš„å‡½æ•°å¤šè¿”å›å€¼æ€æƒ³å¾ˆåƒã€‚func requestCargoInfo(from url: URL) -&amp;gt; (name: String, destination: String) { ... }@autoclosure@autoclosure å¯ä»¥è¯´æ˜¯ Apple çš„ä¸€ä¸ªéå¸¸ç¥å¥‡çš„åˆ›é€ ï¼Œå› ä¸ºè¿™æ›´å¤šåœ°æ˜¯åƒåœ¨ â€œhackâ€ è¿™é—¨è¯­è¨€ã€‚ç®€å•è¯´ï¼Œ@autoclosure åšçš„äº‹æƒ…å°±æ˜¯æŠŠä¸€å¥è¡¨è¾¾å¼è‡ªåŠ¨åœ°å°è£…æˆä¸€ä¸ªé—­åŒ… (closure)ã€‚è¿™æ ·æœ‰æ—¶å€™åœ¨è¯­æ³•ä¸Šçœ‹èµ·æ¥å°±ä¼šéå¸¸æ¼‚äº®ã€‚æ¯”å¦‚ç³»ç»Ÿçš„ precondition å‡½æ•°ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ªç›¸ä¼¼åŠŸèƒ½çš„ï¼šfunc precondition(_ condition: () -&amp;gt; Bool, _ message: String ...) {...}precondition({ return 2 &amp;gt; 1 }, &quot;true&quot;)ä½†æ˜¯ä½¿ç”¨@autoclosureä¹‹åï¼Œå¦‚ç³»ç»Ÿçš„ï¼špublic func precondition(_ condition: @autoclosure () -&amp;gt; Bool, _ message: @autoclosure () -&amp;gt; String = default, file: StaticString = #file, line: UInt = #line)// æˆ‘ä»¬å°±å¯ä»¥æ›´ç®€æ´çš„ä½¿ç”¨ï¼šprecondition(2 &amp;gt; 1, &quot;true&quot;)å¦ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œåœ¨ Vapor æºç ä¸­ï¼Œä¸ºäº†é¿å…è¿‡åº¦ä½¿ç”¨èµ„æºã€è€—è´¹æ€§èƒ½ï¼Œé€šå¸¸æ˜¯ç¡®å®šæŸä¸ªæ¡ä»¶ä¹‹åå†ä½¿ç”¨æŸä¸ªå±æ€§ã€‚æ¯”å¦‚è¿™æ®µä»£ç ï¼špublic func unwrap(or error: @autoclosure @escaping () -&amp;gt; Error) -&amp;gt; Future&amp;lt;Expectation.WrappedType&amp;gt; { return map(to: Expectation.WrappedType.self) { optional in guard let wrapped = optional.wrapped else { throw error() } return wrapped }}è¿™é‡Œ Error æ˜¯åœ¨ optional ç¡®å®šä¸ä¸º nil ä¹‹åå†ç”Ÿæˆçš„ã€‚æœ€åè¦æä¸€å¥çš„æ˜¯ï¼Œ@autoclosure å¹¶ä¸æ”¯æŒå¸¦æœ‰è¾“å…¥å‚æ•°çš„å†™æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰å½¢å¦‚ () -&amp;gt; T çš„å‚æ•°æ‰èƒ½ä½¿ç”¨è¿™ä¸ªç‰¹æ€§è¿›è¡Œç®€åŒ–ã€‚" }, { "title": "RxSwift åœ¨å·¥ç¨‹ä¸­çš„åº”ç”¨", "url": "/posts/RxSwift%E5%9C%A8%E5%B7%A5%E7%A8%8B%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/", "categories": "Tech, FRP", "tags": "Swift, RxSwift, FRP", "date": "2018-06-07 15:08:00 +0800", "snippet": "RxSwiftåœ¨å·¥ç¨‹ä¸­çš„è§„èŒƒåŒ–åº”ç”¨åœ¨å·¥ç¨‹ä¸­ä½¿ç”¨ RxSwif å’Œ RxCocoa ä¹‹åï¼Œé‡åˆ°äº†ä¸å°‘é—®é¢˜ï¼Œä»è¿™äº›é—®é¢˜ä¸­æ€»ç»“å‡ºäº†ä¸€äº›ä¼˜åŒ–ç‚¹å’Œéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œä½œä¸ºè®¨è®ºå’Œä»¥åç¼–ç æ—¶çš„æŒ‡å¯¼ã€‚ç®€åŒ– Observable åŠŸèƒ½Observable ç”¨æ¥æè¿°ä¸€ä¸ªæ“ä½œçš„æµç¨‹ï¼Œç®€å•å¯ä»¥æè¿°ä¸ºï¼šè¾“å…¥-&amp;gt;æ‰§è¡Œ-&amp;gt;è¾“å‡º * n-&amp;gt;ç»“æŸã€‚å¯¹äºä¸€ä¸ª Observable æ¥è¯´ï¼Œä»–çš„æ‰§è¡Œéƒ¨åˆ†ä»£ç éœ€è¦æ‰§è¡Œå°½é‡å°‘çš„åŠŸèƒ½ä»£ç ï¼Œå¦‚æœåŠŸèƒ½è¾ƒä¸ºåºå¤§åˆ™å¯ä»¥è€ƒè™‘æ‹†åˆ†ä¸ºä¸åŒçš„åŠŸèƒ½ã€‚è¿™æ ·ä¼˜ç‚¹æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå¯¹äºå‡½æ•°å¼ç¼–ç¨‹æ¥è¯´ï¼ŒåŠŸèƒ½è¶Šç®€å•çš„å‡½å­(functor)è¶Šèƒ½ç»„åˆå‡ºè¶Šå¤šåŠŸèƒ½è¶Šå¤æ‚çš„å‡½æ•°ã€‚ç¬¬äºŒï¼Œè¿™ç§å°åŠŸèƒ½çš„å‡½æ•°ä¹Ÿæ›´æ–¹ä¾¿æµ‹è¯•å’Œå®šä½é—®é¢˜ï¼ŒåŒæ—¶ä½¿ä»£ç ç»“æ„æ›´å¥½ï¼Œä»£ç å¯è¯»æ€§æ›´å¼ºã€‚ä¾‹å­ï¼šè·å–é‚®ä»¶çš„æ“ä½œæµç¨‹å¦‚ä¸‹ï¼Œå¦‚æœå±•å¼€æ‰€æœ‰åŠŸèƒ½ï¼Œä»£ç æ˜¯è¿™æ ·çš„ï¼Œé¦–å…ˆä¼šæ£€æŸ¥ç½‘ç»œï¼Œå†æ£€æŸ¥è´¦å·ç™»å½•æƒ…å†µï¼Œå†å»æ‹‰å– messageï¼Œè¿”å›æ‹‰å–çš„æ•°æ®ã€‚func fetchMailsOb(of folderPath: String) -&amp;gt; Observable&amp;lt;IMAPResult&amp;lt;[MCOIMAPMessage]&amp;gt;&amp;gt; { if Utils.netIsReachable { // check acount: if IMAPManager.shared.checkAccount(username: user, password: pass) { // do something return IMAPManager.shared .fetchLatestMessages(expectedNumber: kMaxMessage, folder: folder) .map({ (messages) -&amp;gt; IMAPResult&amp;lt;[MCOIMAPMessage]&amp;gt; in return IMAPResult.succ(messages) }) } else { return .error(Errors.CheckAccountError) } } else { return .just(IMAPResult.failed(Errors.Request.noNetworkError)) }}æ ¹æ®æˆ‘ä»¬çš„ç®€åŒ–åŸåˆ™ï¼Œå¯ä»¥æŠŠç½‘ç»œæ£€æŸ¥ã€è´¦å·æ£€æŸ¥å†å°è£…æˆå•ç‹¬çš„ Observable å†è¿›è¡Œä½¿ç”¨ï¼šfunc reachabilityChecking() -&amp;gt; Observable&amp;lt;Void&amp;gt; {...} // throw error when not reachablefunc IMAPAccountChecking() -&amp;gt; Observable&amp;lt;Void&amp;gt; {...} // throw error when failed.func fetchMailsOb(of folderPath: String) -&amp;gt; Observable&amp;lt;IMAPResult&amp;lt;[MCOIMAPMessage]&amp;gt;&amp;gt; { return reachabilityChecking() .flatMap { IMAPAccountChecking() } .flatMap { IMAPManager.shared.fetchLatestMessages(expectedNumber: kMaxMessage, folder: folder) } .map({ (messages) -&amp;gt; IMAPResult&amp;lt;[MCOIMAPMessage]&amp;gt; in return IMAPResult.succ(messages) }) .catchError { .just(IMAPResult.failed($0)) }}è¿™æ ·å°±ç®€åŒ–äº†fetchMailOb(of:)è¿™ä¸ªå‡½æ•°ï¼Œå¯è¯»æ€§æ›´å¼ºï¼Œå¹¶ä¸”ç½‘ç»œæ£€æŸ¥ã€è´¦å·æ£€æµ‹çš„æ–¹æ³•åŒæ—¶å¯ä»¥æä¾›ç»™å…¶ä»–å‡½æ•°è¿›è¡Œä½¿ç”¨ï¼Œæé«˜å¤ç”¨æ€§å‡å°‘ä»£ç é‡ã€‚é”™è¯¯å¤„ç†å°½é‡ä½¿ç”¨ Observable.errorRxç»™æˆ‘ä»¬æä¾›äº†ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æŠ¥å‘Šæœºåˆ¶ï¼Œä»–æ˜¯ä¸€ç§é˜»æ–­å¼çš„å¤„ç†æ–¹å¼ï¼Œåœ¨é“¾å¼æµé‡Œå½“å…¶ä¸­ä¸€ä¸ªæ“ä½œå‘ç”Ÿé”™è¯¯ï¼Œåˆ™æ•´ä¸ªé“¾å¼æµç»ˆæ­¢ã€‚a.flatMap { _ in b }.flatMap { _ in c } // å¦‚æœb throwäº†ä¸€ä¸ªerror1ï¼Œåˆ™ Observable å°†æ”¶åˆ°ä¸€ä¸ª Error Event(error1)ã€‚ç»Ÿä¸€ä½¿ç”¨çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥è§„èŒƒåº”ç”¨å†…çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚å¦‚æœä¸åŒæ¨¡å—é—´å®šä¹‰äº†å¤šç§é”™è¯¯ç±»å‹ï¼Œå¦‚ï¼šMyResult.failed(Error), YourResult.error(Error)ï¼Œåœ¨è¿ç®—æˆ–ç»“åˆå‡½æ•°æ—¶ï¼Œéš¾å…åšç±»å‹è½¬æ¢å’Œåˆ¤æ–­ï¼Œå¸¦æ¥ä¸å¿…è¦çš„ä»£ç é‡ã€‚åœ¨è·å–åˆ° Error ä¹‹åä¹Ÿæ›´å®¹æ˜“ä½¿ç”¨catchErroræˆ–do(onError:)æ¥åšä¸€äº›ç»Ÿä¸€å¤„ç†ã€‚ ç‰¹æ®Šæƒ…å†µï¼šåœ¨å®é™…éœ€æ±‚ä¸­å¯èƒ½å‡ºç°ï¼Œa çš„é”™è¯¯åˆ™å¼¹ Toast æç¤ºï¼Œb çš„é”™è¯¯åˆ™å¼¹ Alertï¼Œc çš„æç¤ºåˆ™ä¸å“åº”ã€‚è¿™ç§æƒ…å†µåˆ™åœ¨åˆ›å»ºé“¾å¼æ“ä½œæµæ—¶åšåŒºåˆ†æ“ä½œï¼ša.do(onError: { toast(...) }) .flatMap{ _ in b } .do(onError: { alert() }) .flatMap { _ in c }ä½¿ç”¨å€¼ç±»å‹ä¼ é€’æ•°æ®åœ¨å®é™…ä½¿ç”¨å‡½æ•°æ—¶ï¼Œç»å¸¸ä¼šç”¨åˆ°é—­åŒ…ï¼Œä»è€Œä¼šæ¶‰åŠåˆ°å¼•ç”¨ç±»å‹å’Œå€¼ç±»å‹çš„ä½¿ç”¨ã€‚å¼•ç”¨ç±»å‹åˆ™è¦æ³¨æ„å¾ªç¯å¼•ç”¨å¼•èµ·çš„å†…å­˜æ³„éœ²ã€‚var ref = ClassA()operation .flatMap { [weak ref] rst in return information(with: rst.first, in: ref) }è¿™æ ·çš„è¯è¿˜æ˜¯ä¼šåœ¨ç‰¹å®šæ¡ä»¶ä¸‹é‡åˆ°é—®é¢˜ï¼Œæ¯”å¦‚å¤šçº¿ç¨‹æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨å¼•ç”¨å¯¹è±¡ refï¼Œå› ä¸º Swift ä¸­ varçš„å¼•ç”¨å¯¹è±¡å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥å¯èƒ½ä¼šé€ æˆè¯»å†™æ•°æ®çš„ä¸å¯é ï¼Œè€Œä¸”å¤šçº¿ç¨‹ä¸‹æ›´æ¶ˆè€—èµ„æºã€‚å¦‚æœä¸å¯é¿å…çš„ä½¿ç”¨å¼•ç”¨ç±»å‹ï¼Œåˆ™éœ€è¦æ³¨æ„è¿™äº›é—®é¢˜ã€‚å€¼ç±»å‹åˆ™ä¸ç”¨é¡¾è™‘è¿™ä¹ˆå¤šï¼Œé—­åŒ…çš„ä¸Šä¸‹æ–‡æ•æ‰ã€èµ‹å€¼éƒ½æ˜¯åŸºäºæ‹·è´çš„ï¼Œå¹¶ä¸”ä¼šæœ‰ç¼–è¯‘ä¼˜åŒ–ã€‚ä½¿ç”¨ shareReplay() , share() æé«˜æ•ˆç‡å¦‚æœä½¿ç”¨éè¿æ¥å¼çš„ Observableï¼Œåˆ™å¤šæ¬¡è®¢é˜…ä¼šé€ æˆ Observable çš„å¤šæ¬¡è°ƒç”¨ã€‚è¿™æ—¶å€™æˆ‘ä»¬ä¸æƒ³é‡å¤è§¦å‘ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨publish(),replay(),share(),shareReplay()ç­‰æ–¹å¼å…±äº«è®¢é˜…è€…ã€‚ shareReplay(n)å¯ä»¥è®©è§‚å¯Ÿè€…å…±äº«ä¸€ä¸ªæºï¼Œå¹¶ä¸”å›æ”¾nä¸ªè®¢é˜…äº‹ä»¶ã€‚ share()ä¸shareReplay()åŒºåˆ«æ˜¯ï¼Œåœ¨è®¢é˜…åï¼Œä¸ä¼šå—åˆ°è®¢é˜…ä¹‹å‰çš„ä¿¡å·ã€‚ RxRealmä½¿ç”¨å®é™…ä½¿ç”¨ä¸­ç»å¸¸ç”¨åˆ°ç›‘å¬æ•°æ®åº“å¯¹è±¡çš„æ•°æ®å˜åŒ–ï¼Œä»è€Œè§¦å‘æŸäº›ä¸šåŠ¡é€»è¾‘æˆ–ååº”åˆ°ç•Œé¢ä¸Šã€‚ å¯¹äºç›‘å¬åˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨Observable.collection(from:synchronousStart:)ï¼šlet realm = try! Realm()let laps = realm.objects(Lap.self)Observable.collection(from: laps) .map { laps in &quot;\\(laps.count) laps&quot; } .subscribe(onNext: { text in print(text) }) ç›‘å¬å•ä¸ªå¯¹è±¡ï¼Œæˆ–æŒ‡å®šå…¶æŸä¸ªå±æ€§ï¼š Observable.from(object: ticker, properties: [&quot;name&quot;, &quot;id&quot;, &quot;family&quot;]) æ³¨æ„äº‹é¡¹ï¼šåœ¨æ³¨å†Œ notification æ—¶ï¼ˆç›‘å¬å˜åŒ–ï¼‰ï¼Œrealm ä¼šè¿›å…¥ write transactionï¼Œæ‰€ä»¥åœ¨å¼€å§‹ç›‘å¬çš„æ—¶å€™è¦æ³¨æ„å†™å†²çªã€‚ add() and delete()Rxå¼çš„å†™æ“ä½œï¼šlet realm = try! Realm()let messages = [Message(&quot;hello&quot;), Message(&quot;world&quot;)]Observable.from(messages) .subscribe(realm.rx.add())let allMessages = realm.objects(Message.self)Observable.from(allMessages) .subscribe(realm.rx.delete()) TableView, CollectionView æ•°æ®ç»‘å®šä½¿ç”¨åº“ RxRealmDataSourcesï¼Œå¯ä»¥ç®€å•çš„å»ºç«‹ DataSourceï¼Œç›´æ¥ç»‘å®šæ•°æ®åˆ° TableView æˆ– CollectionView ä¸Šã€‚// æ— åŠ¨ç”»å¯ä»¥ç›´æ¥ä½¿ç”¨ bindTo:Observable.from( [Realm collection] ) .bindTo(tableView.rx.items) {tv, ip, element in let cell = tv.dequeueReusableCell(withIdentifier: &quot;Cell&quot;)! cell.textLabel?.text = element.text return cell } .addDisposableTo(bag)// åŒ…å«åŠ¨ç”»ï¼š// create data sourcelet dataSource = RxTableViewRealmDataSource&amp;lt;Lap&amp;gt;( cellIdentifier: &quot;Cell&quot;, cellType: PersonCell.self) {cell, ip, lap in cell.customLabel.text = &quot;\\(ip.row). \\(lap.text)&quot;}// RxRealm to get Observable&amp;lt;Results&amp;gt;let realm = try! Realm()let lapsList = realm.objects(Timer.self).first!.lapslet laps = Observable.changeset(from: lapsList)// bind to table viewlaps .bindTo(tableView.rx.realmChanges(dataSource)) .addDisposableTo(bag)çº¿ç¨‹ä½¿ç”¨å¦‚æœæŸäº›æ“ä½œè¿‡äºè€—æ—¶æˆ–æ¶ˆè€—èµ„æºï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå»ºç«‹ç‹¬ç«‹çš„çº¿ç¨‹ç”¨æ¥æ‰§è¡Œè¿™äº›å·¥ä½œã€‚åœ¨ Rx ä¸­æˆ‘ä»¬ä½¿ç”¨ observeOn: å’Œ subscribeOn: æ¥åˆ†é…å·¥ä½œåœ¨æŒ‡å®šçš„çº¿ç¨‹ï¼šobserveOn: å’Œ subscribeOn: çš„åŒºåˆ«æ˜¯ï¼ŒobserveOn åªä¿è¯è§‚å¯Ÿå¯¹è±¡çš„å›è°ƒåœ¨æŒ‡å®šçš„çº¿ç¨‹ï¼Œè€Œ subscribeOn: åˆ™ä¼šæŠŠè®¢é˜…å’Œéè®¢é˜…çš„é€»è¾‘éƒ½æ”¾åœ¨æŒ‡å®šçº¿ç¨‹æ‰§è¡Œã€‚let a = Observable.just(1)let b = Observable.just(2)a .flatMap { _ -&amp;gt; Observable&amp;lt;Int&amp;gt; in print(&quot;logic on: \\(Thread.current)&quot;) return b } .subscribeOn(ConcurrentDispatchQueueScheduler.init(qos: .default)) .subscribe { (event) in print(&quot;\\(event), \\(Thread.current)&quot;) } .disposed(by: bag)// output:logic on: &amp;lt;NSThread: 0x600000264040&amp;gt;{number = 3, name = (null)}next(2), &amp;lt;NSThread: 0x600000264040&amp;gt;{number = 3, name = (null)}completed, &amp;lt;NSThread: 0x600000264040&amp;gt;{number = 3, name = (null)}a .flatMap { _ -&amp;gt; Observable&amp;lt;Int&amp;gt; in print(&quot;logic on: \\(Thread.current)&quot;) return b } .observeOn(ConcurrentDispatchQueueScheduler.init(qos: .default)) .subscribe { (event) in print(&quot;\\(event), \\(Thread.current)&quot;) } .disposed(by: bag)// output:logic on: &amp;lt;NSThread: 0x600000074080&amp;gt;{number = 1, name = main} -&amp;gt; é€»è¾‘å¤„ç†åœ¨ä¸»çº¿ç¨‹next(2), &amp;lt;NSThread: 0x6000002611c0&amp;gt;{number = 5, name = (null)}completed, &amp;lt;NSThread: 0x6000002611c0&amp;gt;{number = 5, name = (null)}ä½¿ç”¨ subscribeOn: æƒ…å†µä¸‹ï¼Œåœ¨æ“ä½œé“¾ä¸­ä»»æ„ä¸€ä¸ªåœ°æ–¹è°ƒç”¨ï¼Œé¢„æœŸç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚observeOn: åˆ™åªä¼šå½±å“å®ƒä¹‹åçš„æ•°æ®æ“ä½œã€‚æ··åˆè°ƒç”¨ subscribeOn: å’Œ observeOn: ä¼šå¯¼è‡´åˆ‡æ¢çº¿ç¨‹:let a = Observable&amp;lt;Int&amp;gt;.create { (observer) -&amp;gt; Disposable in print(&quot;a create on: \\(Thread.current)&quot;) observer.onNext(1) observer.onCompleted() return Disposables.create()}let b = Observable.just(2)a .flatMap { _ -&amp;gt; Observable&amp;lt;Int&amp;gt; in print(&quot;logic on: \\(Thread.current)&quot;) return b } .subscribeOn(ConcurrentDispatchQueueScheduler.init(qos: .default)) .observeOn(ConcurrentDispatchQueueScheduler.init(qos: .default)) .subscribe { (event) in print(&quot;\\(event), \\(Thread.current)&quot;) } .disposed(by: bag)// output:a create on: &amp;lt;NSThread: 0x600000266840&amp;gt;{number = 5, name = (null)}logic on: &amp;lt;NSThread: 0x600000266840&amp;gt;{number = 5, name = (null)}next(2), &amp;lt;NSThread: 0x600000265c80&amp;gt;{number = 4, name = (null)}completed, &amp;lt;NSThread: 0x600000265c80&amp;gt;{number = 4, name = (null)} å¦‚æœè¦åœ¨å…¶ä»–çº¿ç¨‹ä½¿ç”¨ realm æ•°æ®åº“å¯¹è±¡ï¼Œåˆ™éœ€è¦åœ¨é—­åŒ…ä¸­é‡æ–°è·å–å¯¹è±¡ã€‚Side-effectsï¼ˆå‰¯ä½œç”¨ï¼‰é¦–å…ˆè¯´æ˜ä¸‹ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°è¢«è®¤ä¸ºåŒ…å«å‰¯ä½œç”¨ï¼Œåˆ™å®ƒé™¤äº†è¿”å›ä¸€ä¸ªå€¼ä¹‹å¤–ï¼Œè¿˜ä¼šé€ æˆå…¶ä»–å¯è§‚å¯Ÿçš„æ•ˆåº”ã€‚é€šå¸¸æ¥è¯´è¿™ä¸ªæ•ˆåº”æ˜¯æŒ‡çŠ¶æ€çš„æ”¹å˜ï¼Œå¯èƒ½ä¸ºä¸‹é¢æƒ…å†µï¼š æ›´æ”¹äº†ä¸€ä¸ªåœ¨å¤§äºå‡½æ•°å½“å‰èŒƒå›´ï¼ˆscopeï¼‰çš„å˜é‡ã€‚ æ–‡ä»¶æˆ–ç½‘ç»œçš„I/Oæ“ä½œ æ›´æ–°äº†ç•Œé¢ä¿¡æ¯ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼švar i = 0let observable = Observable.from([1,2,3]) .map { ele in i += 1 return ele + i }observable.subscribe(on: { event in if case let Event.next(result) = event { print(&quot;observer a:\\(result)&quot;) }}).disposed(by: bag)// output:observer a:2observer a:4observer a:6observable.subscribe(on: { event in if case let Event.next(result) = event { print(&quot;observer b:\\(result)&quot;) }}).disposed(by: bag)// output:observer b:5observer b:7observer b:9å‰¯ä½œç”¨æœ‰å¯èƒ½æ˜¯å¶ç„¶çš„ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æœ‰æ„ä¸ºä¹‹çš„ã€‚ç®€å•æ¥è¯´é¿å…å‰¯ä½œç”¨çš„æ–¹å¼æ˜¯ï¼Œå°½é‡åœ¨å‡½æ•°å†…é¿å…æ”¹å˜å…¶ä»–å˜é‡æˆ–çŠ¶æ€ã€‚ä¸ºä»€ä¹ˆè¦é¿å…è¿™ç§å‰¯ä½œç”¨ï¼Ÿ ä½¿ä»£ç æ›´å…·å¯ç»´æŠ¤æ€§(maintainability),ä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¯ç»´æŠ¤æ€§çš„å‡½æ•°åº”è¯¥ç¡®å®šè¾“å…¥å’Œè¾“å‡ºçš„é€»è¾‘æ€§ï¼Œå¦‚æœå‡½æ•°ä¸­åŒ…å«ä¸ç¡®å®šçš„å¯å˜å…ƒç´ ï¼Œå¯èƒ½å¯¼è‡´åŒæ ·çš„è¾“å…¥äº§å‡ºä¸åŒçš„ç»“æœã€‚è¿™å¯¹å…¶ä»–ä½¿ç”¨è€…æ¥è¯´ä¼šé€ æˆç–‘æƒ‘ç”šè‡³æ˜¯ bugã€‚ å‡½æ•°æ”¹å˜äº†å…¬å…±å±æ€§æˆ–çŠ¶æ€ï¼Œè¿™äº›å±æ€§å’ŒçŠ¶æ€åˆ™å¯¹äºå…¶ä»–äººæ¥è¯´å¯èƒ½æ˜¯ä¸å¯é¢„çŸ¥çš„ã€‚ ä¸æ–¹ä¾¿æµ‹è¯•ã€‚æ€ä¹ˆè§£å†³å‰¯ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠçŠ¶æ€æˆ–è€…å€¼å½“åšä¸€ä¸ªå‡½æ•°çš„ä¸€ä¸ªå‚æ•°æ¥æ”¹é€ å‡½æ•°ï¼šfunc increase(of array: [Int]) -&amp;gt; Observable&amp;lt;Int&amp;gt; { let indeces = 0..&amp;lt;array.count return Observable.from(indeces) .map { index in return array[index] + index }}è¿™æ ·è¿™ä¸ªå‡½æ•°å°±ä¿è¯äº†ä¸ç®¡è°è°ƒç”¨ï¼Œè¾“å…¥è¾“å‡ºéƒ½æ˜¯å¯æ§çš„ã€‚åˆ›å»ºæ˜“äºæµ‹è¯•çš„ä»£ç ä¸‹é¢çš„ä»£ç å¯èƒ½æ˜¯æˆ‘ä»¬å¹³å¸¸ç»å¸¸ç¼–å†™çš„ï¼šfunc someFunction() -&amp;gt; Observable&amp;lt;String&amp;gt; { return otherOb.map { result in return result + GlobalInstance.property1 } ...}GlobalInstance.property1 å¯èƒ½æ˜¯å·¥ç¨‹ä¸­çš„å…¨å±€å˜é‡ï¼Œåœ¨æˆ‘ä»¬æ„è¯†åˆ°è¿™ä¸ªå˜é‡æ˜¯æµ‹è¯•æ¡ä»¶ä¹‹å‰ï¼Œç›´æ¥åœ¨å‡½æ•°ä¸­ä½¿ç”¨æ˜¯åˆç†çš„ã€‚è¿™æ ·çš„ä»£ç åœ¨å¹³å¸¸è¿è¡Œå’Œé˜…è¯»æ—¶æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœåœ¨æµ‹è¯•æ—¶ï¼ŒGlobalInstance.property1 æˆä¸ºæµ‹è¯•æ¡ä»¶ä¹‹ä¸€æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•å°±å˜å¾—ä¸å¯æµ‹è¯•äº†ã€‚ç®€å•çš„åšæ³•æ˜¯ï¼Œåœ¨å†™ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘ä¸‹è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½å’Œæµ‹è¯•æ¡ä»¶ï¼Œå°½é‡æŠŠæµ‹è¯•æ¡ä»¶å½“åšå¯å˜å‚æ•°è¿›è¡Œæ„å»ºï¼šfunc someFunction(with param: String) -&amp;gt; Observable&amp;lt;String&amp;gt; { return otherOb.map { result in return result + param } ...}è¿™æ ·çš„è¯ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„æµ‹è¯•æ¡ä»¶è®¾å®šå‡½æ•°çš„è¾“å…¥æ¥æµ‹è¯•å‡½æ•°çš„æ­£ç¡®æ€§ã€‚å¦‚æœè¾“å…¥æ¡ä»¶æ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥æ ¹æ®å®é™…åˆ†ç±»æ¥è§„æ•´å‡ºåè®®ï¼Œæé«˜å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼šfunc someFunction(with info: ProtocolA &amp;amp; ProtocolB) -&amp;gt; Observable&amp;lt;String&amp;gt; { return otherOb .map { result in return result + info.property1 + info.property2 }}func test() { let scenarioA: (ProtocolA &amp;amp; ProtocolB) = ... let scenarioB: (ProtocolA &amp;amp; ProtocolB) = ... someFunction(with: scenarioA) .subscribe(onNext: { ele ... }) .dispose(by: bag) someFunction(with: scenarioB) .subscribe(onNext: { ele ... }) .dispose(by: bag)}" }, { "title": "Learning ReactiveSwift - Part 2", "url": "/posts/Learning-ReactiveSwift-Part-2/", "categories": "Tech, FRP", "tags": "Swift, FRP, ReactiveSwift", "date": "2017-07-04 20:00:00 +0800", "snippet": "æ•°æ®æµFRPä¹‹å‰ä¸€ç¯‡å·²ç»ä»‹ç»è¿‡ï¼Œæ˜¯ä¸€ç§æŠ½è±¡çš„æ•°æ®æµå‹çš„ç¼–ç¨‹æ€æƒ³ã€‚å¯¹äºæ•°æ®æµï¼Œå¼€å§‹ä¸€ä¸ªæ•°æ®æµåï¼Œä¼šäº§ç”Ÿå¾ˆå¤šäº‹ä»¶ã€‚åœ¨ReactiveSwiftä¸­ï¼Œå®šä¹‰çš„äº‹ä»¶æœ‰Eventã€Errorã€‚å¯¹åº”Observeråˆ™ä¼šæœ‰observe valueã€failedã€completeã€interruptedã€‚å¯¹äºå†·ä¿¡å·ï¼šlet observer = Signal&amp;lt;Int, NSError&amp;gt;.Observer( value: { print(&quot;value: \\($0)&quot;) }, failed: { print(&quot;failed with \\($0)&quot;)}, completed: { print(&quot;complete&quot;) }, interrupted: { print(&quot;interupted&quot;) })SignalProducer&amp;lt;Int, NSError&amp;gt;([1,2,3,4]).start(observer)/*print:value: 1value: 2value: 3value: 4complete */ // orlet producer = SignalProducer&amp;lt;Int, NSError&amp;gt;([1, 2, 3, 4])producer.startWithSignal { (signal, disposable) in signal.observe({ (event) in switch event { case .value(let value): print(&quot;value: \\(value)&quot;) case .failed(let error): print(&quot;failed with \\(error)&quot;) case .interrupted: print(&quot;interrupted&quot;) case .completed: print(&quot;completed&quot;) } })}å¯¹äºçƒ­ä¿¡å·ï¼šlet (signal, observer) = Signal&amp;lt;String, TestError&amp;gt;.pipe()signal.observe { event in switch event { case .value(let value): print(&quot;value: \\(value)&quot;) case .failed(let error): print(&quot;failed with \\(error)&quot;) case .interrupted: print(&quot;interrupted&quot;) case .completed: print(&quot;completed&quot;) }}éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨signalæ¥æ”¶åˆ°failed, interrupted, completeäº‹ä»¶åï¼Œè¯¥é€šé“å°±ç›¸å½“äºå…³é—­äº†ï¼Œä¹‹åçš„äº‹ä»¶åˆ™ä¸ä¼šå†æ¥æ”¶åˆ°ã€‚Mapmapå°±åƒä¸€èˆ¬å‡½æ•°å¼ç¼–ç¨‹ä¸­mapç”¨æ³•ä¸€æ ·ï¼Œå¯¹sequenceå†…å¯¹è±¡è¿›è¡Œtransformï¼Œå¦‚ä¸‹é¢ä¾‹å­ï¼Œå¯¹æ•°ç»„ä¸­çš„æ•°è¿›è¡Œä¹˜2ï¼šSignalProducer&amp;lt;Int, NoError&amp;gt;([1, 2, 3, 4]) .map { $0 * 2 } .startWithValues { print($0) }// print: // 2 4 6 8mapErroræ˜¯å¯¹failedæƒ…å†µè¿›è¡Œtransformï¼šenum TestError: Error { case code(Int)}SignalProducer&amp;lt;Int, NSError&amp;gt;(error: NSError(domain: &quot;test.domain&quot;, code: 100, userInfo: nil)) .mapError { return TestError.code($0.code) } .startWithFailed { (error) in switch error { case let .code(code): print(code) }}// print: 100flatMapæ˜¯å¯¹SignalProducerè¿›è¡Œè½¬æ¢SignalProducer&amp;lt;Int, NoError&amp;gt;([ 1, 2, 3, 4 ]) .flatMap(.latest) { SignalProducer(value: $0 + 3) } .startWithValues { value in print(value)}/*print:4567*/Filterå¯¹Valueè¿›è¡Œè¿‡æ»¤ï¼Œåªæœ‰ç¬¦åˆæ¡ä»¶çš„valueæ‰èƒ½è§¦å‘äº‹ä»¶:SignalProducer&amp;lt;Int, NoError&amp;gt;([ 1, 2, 3, 4 ]) .filter { $0 &amp;gt; 3 } .startWithValues { value in print(value) }// print: 4Takeå–äº‹ä»¶çš„å‰Né¡¹ï¼ˆtake(first:)ï¼‰æˆ–åNé¡¹(take(last:))let producer = SignalProducer&amp;lt;Int, NSError&amp;gt;([1, 2, 3, 4])producer .take(last: 2) .startWithResult { print($0) }// .success(3)// .success(4)CombinecombineLatestæ˜¯æŠŠç¬¬ä¸€ä¸ªproducerçš„æœ€åä¸€é¡¹ä¸ç¬¬äºŒä¸ªproducerçš„valueè¿›è¡Œç»‘å®šï¼šlet producer1 = SignalProducer&amp;lt;Int, NoError&amp;gt;([ 1, 2, 3, 4 ])let producer2 = SignalProducer&amp;lt;Int, NoError&amp;gt;([ 1, 2 ])producer1 .combineLatest(with: producer2) .startWithValues { value in print(&quot;\\(value)&quot;)}// print:// (4, 1)// (4, 2)combinePreviousæ˜¯æ¯æ¬¡valueéƒ½ç»‘å®šå‰ä¸€æ¬¡eventçš„valueSignalProducer&amp;lt;Int, NoError&amp;gt;([ 1, 2, 3, 4 ]) .combinePrevious(42) .startWithValues { value in print(&quot;\\(value)&quot;)}/* print :(42, 1)(1, 2)(2, 3)(3, 4)*/å°ç»“å¯¹äºSignalProducerå’ŒSignalï¼Œè¿˜æœ‰å¾ˆå¤šæ–¹ä¾¿çš„å°å·¥å…·å¯¹å…¶è¿›è¡Œæ“ä½œæˆ–è€…è½¬æ¢ï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­æ ¹æ®éœ€æ±‚çš„ä¸åŒè¿›è¡Œä½¿ç”¨ã€‚" }, { "title": "Learning ReactiveSwift - Part 1", "url": "/posts/Learning-ReactiveSwift-Part-1/", "categories": "Tech, FRP", "tags": "Swift, FRP, ReactiveSwift", "date": "2017-04-24 19:18:00 +0800", "snippet": " RAC 4.0å‘å¸ƒä»¥åå‘ç°ï¼ŒRACè¿›è¡Œäº†å¤§é‡çš„æ›´æ–°ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„æ˜¯ä½¿ç”¨äº†ReactiveSwiftä½œä¸ºåŸºç¡€åº“ï¼Œæ›¿æ¢æ‰äº†ä»¥å‰OCç‰ˆçš„åº“ï¼ŒRACåˆ™æ˜¯å¯¹äºRASå’ŒCocoaæ¡†æ¶çš„å°è£…ã€‚å…¥é—¨å¯¹äºä»¥å‰çš„RACæ•™ç¨‹ï¼Œç†è®ºéƒ¨åˆ†å¤§éƒ¨åˆ†è¿˜æ˜¯é€šç”¨çš„ï¼Œä½†æ˜¯ReactiveSwiftåœ¨æŸäº›æ–¹é¢è¿›è¡Œäº†é‡æ„å’Œä¿®æ”¹ï¼Œè€Œä¸”ç°æœ‰æ•™ç¨‹ç¼ºä¹æ›´æ–°ï¼Œä¸å¾—å·²æˆ‘ä»¬é‡å¤´æ¥æ¢³ç†éReactiveSwiftçš„å…¥é—¨æ•™ç¨‹ã€‚ReactiveSwiftçš„æ–‡æ¡£æ˜¯ä¸€ç¯‡ä¸é”™çš„å…¥é—¨ä»‹ç»ï¼Œæœ¬æ–‡éƒ¨åˆ†ç›´æ¥ç¿»è¯‘è‡ªåŸæ–‡ã€‚ä»€ä¹ˆæ˜¯ReactiveSwiftReactiveSwiftæä¾›äº†å¯ç»„åˆçš„ã€å®£è¨€å¼çš„ã€çµæ´»çš„åŸºå…ƒï¼Œç”¨æ¥æ„å»ºæ•°æ®æµï¼ˆstreams of valuesï¼‰ï¼Œè¿™ç§å½¢å¼æ˜¯Reative Programmingçš„é‡è¦è¡¨ç°ä¹‹ä¸€ã€‚ReactiveSwiftä½¿ç”¨çš„æ˜¯Functional Reactive Programming(FRP)ï¼ŒFRPæ˜¯ä¸¤ç§æ¦‚å¿µçš„ç»“åˆï¼ŒReactive Programmingå’ŒFunctional Programmingã€‚Reactive Programmingæ˜¯ä¸“æ³¨äºç›‘å¬å¼‚æ­¥æ•°æ®æµï¼Œå¹¶ä¸”å¯ä»¥ä½œå‡ºç›¸åº”åé¦ˆçš„ä¸€ç§ç¼–ç¨‹æ–¹å¼ã€‚å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« çš„è¯¦ç»†ä»‹ç»ã€‚Functional Programmingå¼ºè°ƒä½¿ç”¨æ•°å­¦æ¨¡å‹çš„å‡½æ•°æ¥è®¡ç®—ï¼Œç‰¹ç‚¹æ˜¯ä¸å¯å˜ã€è€Œåˆè¡¨è¾¾æ˜ç¡®æ¸…æ™°ï¼Œæœ€å°åŒ–ä½¿ç”¨å˜é‡å’ŒçŠ¶æ€ã€‚ç†è§£å…ˆæ¥çœ‹çœ‹ReactiveSwiftçš„å‡ ä¸ªé‡è¦åŸºå…ƒï¼šSignal, SignalProducer, Event, Observer, Action.å½“ä¸€ä¸ªå¯¹è±¡æŒæœ‰ä¸€ä¸ªSignalï¼Œå¯ä»¥çœ‹åšï¼Œä¸€å®¶ç”µè§†å°æœ‰åœ¨æŸä¸ªé¢‘é“çš„ç”µè§†èŠ‚ç›®ï¼ŒSignalå°±æ˜¯è¿™ä¸ªé¢‘é“ï¼ˆé€šé“ï¼‰ã€‚Eventï¼Œå¯ä»¥çœ‹åšæ˜¯è¿™ä¸ªé¢‘é“ä¸Šçš„æ•°æ®ã€‚Observeråˆ™æ˜¯ç”µè§†è§‚ä¼—ï¼Œä»–ä»¬è®¢é˜…ï¼ˆsubscribeæˆ–observeï¼‰äº†è¿™ä¸ªé¢‘é“ï¼ˆsignal)ï¼Œåˆ™å¯ä»¥ä»é¢‘é“ä¸­è·å–å†…å®¹ï¼ˆeventsï¼‰ã€‚Actionåˆ™æ˜¯ä¸€ç§åŠ¨ä½œï¼Œå¯¹Signaläº§ç”Ÿå½±å“ï¼Œå´ä¸å¯¹Signalçš„æŒæœ‰è€…äº§ç”Ÿå½±å“ï¼Œå°±åƒï¼šæ¢å°ï¼ˆsendInterruptï¼‰ã€‚è€ŒSignalå’ŒSignalProduceråˆ™æ˜¯RACæ›´æ–°ä¸­çš„ä¸€ä¸ªå˜åŠ¨ï¼Œä»–ä¿©çš„å®šä¹‰å°±åƒâ€œå†·ã€çƒ­ä¿¡å·â€ã€‚åœ¨Rxå’ŒRAC 2.xä»¥å‰ä»–ä»¬æ˜¯ç»Ÿä¸€ä¸€èµ·çš„ã€‚ä¹‹æ‰€ä»¥åˆ†å¼€ï¼Œå®˜æ–¹æ–‡æ¡£çš„è§£é‡Šæ˜¯ï¼š â€¦ it is impossible to tell whether subscribing to (observing) that IObservable will involve side effects. If it does involve side effects, itâ€™s also impossible to tell whether each subscription has a side effect, or if only the first one does. This example is contrived, but it demonstrates a real, pervasive problem that makes it extremely hard to understand Rx code (and pre-3.0 ReactiveCocoa code) at a glance. ReactiveSwift addresses this by distinguishing side effects with the separate Signal and SignalProducer types. Although this means thereâ€™s another type to learn about, it improves code clarity and helps communicate intent much better. In other words, ReactiveSwiftâ€™s changes here are simple, not easy.ç®€å•æ¥è¯´ï¼Œç›‘å¬æˆ–è®¢é˜…ä¸€ä¸ªä¿¡å·ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œä¸ºäº†åŒºåˆ†æ˜¯å¦äº§ç”Ÿå‰¯ä½œç”¨ï¼ŒReactiveSwiftåŒºåˆ†äº†ä¸¤ä¸ªç±»å‹ã€‚Signal vs. SignalProducerä¸ºäº†ç†è§£Signalå’ŒSignalProducerä¹‹é—´çš„åŒºåˆ«ï¼Œæˆ‘é—¨å¯ä»¥ä¸¾ä¸€ä¸ªä¼ ç»Ÿç”µè§†èŠ‚ç›®å’Œè§†é¢‘ç½‘ç«™çš„ä¾‹å­ã€‚Signalçš„è¡¨ç°å°±åƒæ˜¯ç”µè§†èŠ‚ç›®ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªè¿ç»­çš„è§†é¢‘æµå’ŒéŸ³é¢‘æµã€‚åœ¨ä¸€ä¸ªå›ºå®šçš„æ—¶é—´ç‚¹ï¼Œæ¯ä¸ªè§‚ä¼—çœ‹åˆ°çš„ç”µè§†èŠ‚ç›®å†…å®¹éƒ½æ˜¯ä¸€æ ·çš„ã€‚è§‚ä¼—æ—¢ä¸èƒ½å‘ç”µè§†èŠ‚ç›®å†…å®¹å†…æ’å…¥äº‹ä»¶ï¼ˆå‰¯ä½œç”¨ï¼‰ï¼Œä¹Ÿä¸èƒ½å‘½ä»¤ç”µè§†èŠ‚ç›®å¼€å§‹å’Œç»“æŸã€‚è§‚ä¼—åªèƒ½å¼€å§‹æˆ–åœæ­¢æ¥å—ç”µè§†èŠ‚ç›®å†…å®¹ã€‚å¦ä¸€æ–¹é¢ï¼ŒSignalProduceråƒæ˜¯ä¸€ä¸ªè§†é¢‘ç½‘ç«™çš„è§†é¢‘æµï¼Œå°±åƒ YouTube ä¸€æ ·ã€‚è§‚ä¼—å¯ä»¥æ”¶åˆ°è§†é¢‘å’ŒéŸ³é¢‘çš„æ•°æ®æµï¼Œä½†æ˜¯æ¯ä¸ªä¸ä¸€æ ·çš„è§‚ä¼—åœ¨åŒä¸€æ—¶é—´ç‚¹æ”¶åˆ°çš„å†…å®¹æ˜¯ä¸ä¸€æ ·çš„ã€‚åŒæ—¶è§‚ä¼—å¯ä»¥ä¸»åŠ¨å¼€å¯å’Œå…³é—­ä»–è§‚çœ‹çš„è§†é¢‘ã€‚å› æ­¤ï¼ŒSignals é€šå¸¸æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ­£åœ¨è¿›è¡Œä¸­çš„äº‹ä»¶æµï¼Œåƒæ˜¯å¹¿æ’­ã€ç”¨æˆ·è¾“å…¥ç­‰ã€‚å¦ä¸€æ–¹é¢ï¼ŒSignalProducers é€šå¸¸è¡¨ç¤ºä¸€ä¸ªéœ€è¦è¢«ä¸»åŠ¨å¼€å¯çš„æ“ä½œæˆ–è€…ä»»åŠ¡ã€‚ä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼Œæ¯ä¸€æ¬¡è°ƒç”¨startéƒ½ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„æ“ä½œï¼Œã€‚è¿™ä¸ªä¾‹å­ä¸­å¦‚æœä½¿ç”¨äº† Signalï¼Œç»“æœæ˜¯æ‰€æœ‰åœ¨ç½‘ç»œè¯·æ±‚å“åº”å›æ¥ä¹‹å‰ï¼Œå¼€å§‹ç›‘å¬å½“å‰Signalçš„è§‚å¯Ÿè€…ï¼Œéƒ½ä¼šæ”¶åˆ°ç½‘ç»œè¯·æ±‚å›è°ƒã€‚æ¥æºï¼š To understand the difference between Signal and SignalProducer, letâ€™s take the analogy of TV and on-demand streaming service. Signal behaves like a TV feed which is a continuous stream of video and audio. At a given point of time, every observer of the TV feed sees the same sequence of the frame. The observer neither can inject any side effect to TV feed, nor it can start or stop the feed. The observer can only start and stop receiving the feed. On the other hand, SignalProducer is like an on demand streaming service like YouTube. Here, the observer can receive a stream of video and audio, but the sequence of the stream is different for a different observer. Here the observer can start and stop the feed. Therefore, Signals are generally used to represent event streams that are already â€œin progress,â€ such as notifications, user input, etc. SignalProducers, on the other hand, are used to represent operations or tasks which need to be started. For example, like network requests, where each invocation of start will create a new underlying operation. In the case of a Signal, the results might be sent before any observers are attached. In the case of a SignalProducer, the results are not sent unless it is started.ç®€å•ä½¿ç”¨ReactiveSwift äº†è§£åŸºç¡€ç”¨æ³•ï¼Œå…¶å®å¯ä»¥ä¸‹è½½ReactiveCocoaæºç å·¥ç¨‹ï¼Œåœ¨å•å…ƒæµ‹è¯•ä¸­å¯ä»¥æ‰¾åˆ°APIçš„å„ç§ç”¨æ³•ã€‚ä¸‹é¢æºç å¤§éƒ¨åˆ†å–è‡ªå•å…ƒæµ‹è¯•ä»£ç ã€‚Signal// ä½¿ç”¨ä¸€æ®µä»£ç ï¼ˆè¿è¡Œï¼‰let disposable = SimpleDisposable()let signal: Signal&amp;lt;Int, NoError&amp;gt; = Signal { observer in // do something return disposable}signal.observe { event in switch event { case let .value(number): // do something case .completed: // do completion default: break }}// ä½¿ç”¨pipe()let (signal, observer) = Signal&amp;lt;String, TestError&amp;gt;.pipe()// åŒæ ·å¯ä½¿ç”¨observesignal.observe { event in // blabla}// observerå¯ä»¥send eventsobserver.send(value: &quot;a string&quot;)observer.sendCompleted()SignalProducerSignalProduceræ˜¯è§¦å‘å¼çš„var disposable: Disposable!let producer = SignalProducer&amp;lt;Int, NoError&amp;gt; { observer, innerDisposable in disposable = innerDisposable innerDisposable += { observer.send(value: 1) } observer.send(value: 0)}producer.startWithSignal { signal, disposable in signal.observeValues { print($0) }}disposable.dispose()// print:// 0// 1Disposableçœ‹åˆ°ä¸Šé¢SignalProducerå’ŒSignalçš„ä¾‹å­ï¼Œç”¨åˆ°Disposableçš„åœºæ™¯ã€‚Disposableæ˜¯ç”±åè®®Disposableæè¿°çš„ï¼Œæ‹¥æœ‰å†…å­˜ç®¡ç†å’Œå–æ¶ˆæœºåˆ¶ä¸€ç§å¯¹è±¡ã€‚å½“å¯åŠ¨ä¸€ä¸ªSignal producerï¼Œä¼šè¿”å›ä¸€ä¸ªdisposableå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯è¢«ç”¨ä½œå–æ¶ˆè¢«å¯åŠ¨çš„å·¥ä½œï¼Œæ¸…ç†æ‰€æœ‰ä¸´æ—¶èµ„æºï¼Œç„¶åå‘é€ä¸€ä¸ªinterruptedäº‹ä»¶ï¼ˆEventï¼‰ç»™è¢«åˆ›å»ºçš„Signalã€‚ç›‘å¬ï¼ˆObserverï¼‰ä¸€ä¸ªSignalä¹Ÿä¼šè¿”å›ä¸€ä¸ªdisposableå¯¹è±¡ï¼Œç”¨æ¥ä½¿ç›‘å¬è€…åœæ­¢ä»Signalæ¥æ”¶eventsï¼Œä½†æ˜¯ä¸ä¼šå¯¹Signaläº§ç”Ÿå½±å“ã€‚Eventsäº‹ä»¶ï¼Œæè¿°ä¸€ä¸ªå‘ç”Ÿçš„äº‹æƒ…ã€‚åœ¨ReactiveSwiftä¸­ï¼Œäº‹ä»¶æ˜¯é€šè®¯çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ä¸€äº›äº‹ä»¶ç”Ÿæˆå™¨å¯ä»¥é€šè¿‡Signalå‘é€äº‹ä»¶ç»™æ³¨å†Œçš„è§‚å¯Ÿè€…ä»¬ã€‚Unidirectional Bindingå•å‘ç»‘å®šï¼Œé€šè¿‡ä¸€ä¸ªæ•°æ®æºï¼ˆBindingSourceï¼‰ç»‘å®šåˆ°ä¸€ä¸ªç›®æ ‡ï¼ˆBindingTargetProviderï¼‰ä¸Šã€‚public func &amp;lt;~&amp;lt;Provider, Source&amp;gt;(provider: Provider, source: Source) -&amp;gt; Disposable? where Provider : BindingTargetProvider, Source : BindingSource, Source.Error == Result.NoError, Source.Value == Provider.Valueæœ‰å®šä¹‰å¯è§ï¼Œåªè¦Sourceå’ŒProviderçš„Valueæ˜¯åŒä¸€ç±»å‹ï¼Œå°±å¯ä»¥è¿›è¡Œç»‘å®šã€‚ä¸¾ä¸ªä¾‹å­ï¼švar value: Int? = nil let (lifetime, _) = Lifetime.make()let target = BindingTarget&amp;lt;Int&amp;gt;(lifetime: lifetime) { value = $0 }let property = MutableProperty.init(1) target &amp;lt;~ property// value = 1property.value = 2// value = 2 è¿™ä¾‹å­æ˜¯å•å…ƒæµ‹è¯•çš„ä¾‹å­ï¼Œä½†æ˜¯æˆ‘è‡ªå·±è¯•çš„æ—¶å€™valueä¸€ç›´æ˜¯nilâ€¦ä¸çŸ¥é“é‚£å‡ºäº†é—®é¢˜ã€‚Lifetimeç”Ÿå‘½å‘¨æœŸçš„ç›‘æ§ï¼Œæ¯”å¦‚ï¼šlet object = MutableReference(TestObject())var isEnded = falsevar isCompleted = falseobject.value!.ended.observeCompleted { isCompleted = true }object.value!.lifetime.observeEnded { isEnded = true }expect(isCompleted) == falseexpect(isEnded) == falseobject.value = nilexpect(isCompleted) == trueexpect(isEnded) == trueTake a breakè¿™ç¯‡ä¸»è¦æ˜¯è®²ä¸€äº›ReactiveSwiftçš„åŸºç¡€ç”¨æ³•ï¼Œä¸‹ç¯‡ä¸»è¦è®²ä»–çš„å‡½æ•°å¼éƒ¨åˆ†ï¼Œæ¯”å¦‚mapã€filterç­‰ã€‚" }, { "title": "POP, æ³›å‹å’Œå‡½æ•°å¼æ€æƒ³åœ¨iOSä¸­çš„åº”ç”¨", "url": "/posts/POP-%E6%B3%9B%E5%9E%8B%E5%92%8C%E5%87%BD%E6%95%B0%E5%BC%8F%E6%80%9D%E6%83%B3%E5%9C%A8iOS%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/", "categories": "Tech, Functional Swift", "tags": "POP, Functional", "date": "2017-04-01 13:00:00 +0800", "snippet": "ä»€ä¹ˆæ˜¯POP (Protocol-oriented-programing) åœ¨æˆ‘ä»¬å¹³å¸¸å·¥ä½œä¸­ï¼Œç»å¸¸ä½¿ç”¨çš„æ˜¯OOPï¼ˆObject-Oriented-Programingï¼‰ï¼Œæ¯”å¦‚C++ã€OCã€JAVAã€‚ä»–ä»¬æ˜¯æŠŠä¸€äº›æ•°æ®æˆ–åŠ¨ä½œé›†åˆå½“åšä¸€ä¸ªå¯¹è±¡æ¥çœ‹å¾…ï¼Œæ¯”å¦‚æ ‘ã€äººã€æœºå™¨ç­‰ã€‚POPåˆ™ä¸åŒï¼Œå®ƒä»å¦ä¸€ä¸ªè§†è§’çœ‹å¾…äº‹ç‰©ï¼šå±æ€§ã€‚ä¸€ä¸ªå¯¹è±¡æ‹¥æœ‰çš„æ•°æ®å±æ€§å’ŒåŠ¨ä½œå±æ€§ï¼Œéƒ½å¯ä»¥æˆä¸ºä¸€ç§åè®®ï¼ˆprotocolï¼‰ï¼Œä¸åŒçš„å¯¹è±¡é—´æœ‰ç€å…±åŒçš„åè®®æˆ–ç›¸ä¼¼çš„åè®®ã€‚ å®é™…ç¼–ç è¿‡ç¨‹ä¸­ï¼Œå®šä¹‰å„ç§åè®®æ¥è§„èŒƒå’Œæ‹“å±•ç±»çš„æ–¹å¼ï¼Œç»Ÿç§°å«åšPOPã€‚ä¸¾ä¸ªğŸŒ°ä»¥å‰æˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·æ„å»ºä¸€ä¸ªç±»ï¼šclass bird { var name = &quot;&quot; var canFly = true}class penguin: bird { override init() { super.init() self.canFly = false self.name = &quot;penguin&quot; }}å¯¹äºOOPæ¥è¯´æ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œbirdä¸ºpenguinçš„çˆ¶ç±»ï¼Œå­ç±»ç»§æ‰¿å’Œè¦†ç›–äº†çˆ¶ç±»çš„å±æ€§ã€‚è€Œåœ¨POPä¸­ï¼Œæˆ‘ä»¬è¿™ä¹ˆå¹²:protocol Flyable { var canFly: Bool { get }}struct Plane: Flyable { var canFly: Bool = true}struct Swallow: Flyable { var canFly: Bool = true}æ˜æ˜¾Flyableå±æ€§å…¶å®ä¸å•ç‹¬å±äºé¸Ÿç±»ï¼Œå®ƒåŒæ ·ä¹Ÿæ˜¯å¾ˆå¤šå…¶ä»–å¯¹è±¡çš„å±æ€§ã€‚æ‰€ä»¥åœ¨æ„é€ å…¶ä»–å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä»–ä»¬è´´ä¸ŠåŒæ ·çš„â€œæ ‡ç­¾â€ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¯•ç€ä¸°å¯Œä¸€ä¸‹æˆ‘ä»¬çš„æ ‡ç­¾ã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¯ä»¥æè¿°é€Ÿåº¦çš„åè®®ï¼šprotocol Racer { var speed: Double { get }}extension Plane: Racer { var speed: Double { return 1000 }}extension Swallow: Racer { var speed: Double { return 200 }}è¿™æ ·ï¼Œæˆ‘ä»¬çš„âœˆï¸å’ŒğŸ¦å°±æ‹¥æœ‰é€Ÿåº¦äº†~ ç„¶åæˆ‘ä»¬å¯ä»¥ç”¨Raceræ¥è¿›è¡Œæ‹“å±•ã€‚æ‹“å±•ä¸€ä¸ªå¾ˆç®€å•çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬çŸ¥é“Arrayæ˜¯ç»§æ‰¿Sequenceåè®®çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Sequenceä¸­åŠ å…¥ä¸€ä¸ªåŠŸèƒ½ï¼Œä½¿å¾—å¿«é€Ÿæ‰¾å‡ºSequenceä¸­é€Ÿåº¦æœ€å¿«çš„å¯¹è±¡ã€‚extension Sequence where Iterator.Element == Racer { func fastest() -&amp;gt; Iterator.Element? { return self.max(by: { (a: Iterator.Element, b: Iterator.Element) -&amp;gt; Bool in return a.speed &amp;lt; b.speed }) }}let plane = Plane()let swallow = Swallow()let array: Array&amp;lt;Racer&amp;gt; = [plane, swallow]array.fastest()è¿™æ ·Arrayå°±å…·æœ‰äº†ä¸€ä¸ªç®€å•çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç§æ€æƒ³å»æ„å»ºä¸€ä¸ªä½“ç³»ï¼ŒSwiftä¸­çš„Arrayå’ŒDictionaryå°±æ˜¯å¾ˆå¥½çš„ä¾‹å­ã€‚Popçš„ç®€å•åº”ç”¨å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼ŒiOSçš„TableViewæˆ‘ä»¬é€šå¸¸è¿™æ ·å†™ï¼šclass CommentCell: UITableViewCell {}class MyViewcontroller: UIViewController, UITableViewDelegate, UITableViewDataSource { var tableView = UITableView() override func viewDidLoad() { super.viewDidLoad() let cellNib = UINib(nibName: &quot;CommentCell&quot;, bundle: nil) tableView .register(cellNib, forCellReuseIdentifier: &quot;comment_cell&quot;) } func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&amp;gt; UITableViewCell { guard let cell = tableView.dequeueReusableCell(withIdentifier: &quot;comment_cell&quot;, for: indexPath) as? CommentCell else { return UITableViewCell() } return cell; }}è¿™çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œå¤¹æ‚ç€å„ç§åˆ¤æ–­å’Œè½¬æ¢ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Swiftçš„ç‰¹æ€§å’ŒPOPæ–¹å¼ï¼šprotocol ReusableView {}extension ReusableView where Self: UITableViewCell { static var reusedIdentifier: String { return String(describing: self.self) }}protocol NibLoadableView: class { }extension NibLoadableView where Self: UIView { static var NibName: String { return String(describing: self.self) }}extension CommentCell: ReusableView, NibLoadableView {}æœ‰äº†è¿™ä¸¤ä¸ªåè®®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹TableViewçš„æ–¹æ³•è¿›è¡Œæ”¹é€ ï¼Œä½¿ç”¨æ³›å‹æ–¹æ³•ï¼šextension UITableView { func registerNib&amp;lt;T: UITableViewCell&amp;gt;(_: T.Type) -&amp;gt; Void where T: ReusableView, T: NibLoadableView { let nib = UINib(nibName: T.NibName, bundle: nil) self.register(nib, forCellReuseIdentifier: T.reusedIdentifier) } func dequeReusableCell&amp;lt;T: UITableViewCell&amp;gt;(forIndexPath ip: IndexPath) -&amp;gt; T where T: ReusableView { guard let cell = self.dequeueReusableCell(withIdentifier: T.reusedIdentifier, for: ip) as? T else { fatalError(&quot;couldn&#39;t deque cell with identifier: \\(T.reusedIdentifier)&quot;) } return cell }}ç„¶ååœ¨å®ç°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸€åˆ‡å˜å¾—æ›´å¥½äº†extension MyViewcontroller { func register() -&amp;gt; Void { tableView.registerNib(CommentCell.self) } func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&amp;gt; UITableViewCell { return tableView.dequeReusableCell(forIndexPath: indexPath) as CommentCell }}è¿™åªæ˜¯ä¸ªå®ä¾‹ï¼Œè¿™ç§æ€æƒ³å¹¶ä¸ä¼šä¸€å®šå¸®åŠ©ä½ çš„ä»£ç æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯åˆç†åˆ©ç”¨ä¸‹ï¼Œä¼šè®©ä½ çš„ä»£ç å¯è¯»æ€§å˜å¾—å¾ˆå¼ºï¼Œæ‹“å±•æ€§å˜çš„æé«˜ï¼Œæ€è·¯å˜å¾—æ¸…æ™°ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹åœ¨å®é™…é¡¹ç›®ä¸­POPçš„åº”ç”¨ã€‚ä¸€ä¸ªç½‘ç»œå±‚æ¡†æ¶è¿™ä¸ªæ˜¯ä¸€ä¸ªé¡¹ç›®ä¸­å®é™…ä½¿ç”¨çš„ç½‘ç»œè¯·æ±‚æ¡†æ¶ã€‚åœ¨çˆ¶ç±»çš„APIManagerä¸­åŒ…å«äº†ä¸€ä¸ªæŒ‡å‘å­ç±»çš„æŒ‡é’ˆï¼Œå¹¶ä¸”å¼ºåˆ¶å­ç±»å®ç°ä¸€ä¸ªAPIManagerProtocolã€‚çˆ¶ç±»åˆå§‹åŒ–æ—¶è¦æ±‚å­ç±»çš„çº¦æŸæ¡ä»¶ã€‚- (instancetype)init { if (self = [super init]) { if ([self conformsToProtocol:@protocol(XLAPIManagerProtocol)]) { self.child = (id &amp;lt;XLAPIManagerProtocol&amp;gt;)self; self.shouldAutoRetry = [self.child respondsToSelector:@selector(autoRetryCountWithErrorCode:)]; self.autoProcessReceivedData = YES; } else { NSAssert(NO, @&quot;APIManager å­ç±»å¿…é¡»é›†æˆXLAPIManagerProtocl&quot;); } } return self;}åˆ©ç”¨self.childæ¥è§„èŒƒå­ç±»çš„å®ç°ï¼ŒåŒæ—¶é€šè¿‡protocolæ¥è·å–å­ç±»çš„ç›¸å…³ä¿¡æ¯ï¼Œä½¿åŠŸèƒ½å®ç°èšåˆåœ¨BaseAPIä¸­ã€‚æ¯”å¦‚è¿™ä¸ªè·å–å®Œæ•´URLStringçš„æ–¹æ³•ï¼š- (NSString *)fullURLString { if (!self.urlString) { NSMutableString *url = [NSMutableString stringWithString:[self.child server].url]; if ([self.child apiVersion] &amp;amp;&amp;amp; [self.child apiVersion].length &amp;gt; 0) { [url appendFormat:@&quot;/%@&quot;, [self.child apiVersion]]; } [url appendFormat:@&quot;/%@&quot;, [self.child apiName]]; self.urlString = url; } return self.urlString;}å®ç°åæˆ‘ä»¬ä¼šå‘ç°ï¼Œå­ç±»å®ç°APIä¼šéå¸¸æ¸…æ™°å’Œç®€æ´ã€‚ä¸€ä¸ªAPIç±»çš„å®ç°ï¼Œåªéœ€è¦å‡ è¡Œä»£ç @implementation KNBindInfoAPIManager- (NSString *)apiName { return @&quot;bindinfo&quot;;}- (NSString *)apiVersion { return @&quot;&quot;;}- (NSString *)httpMethod { return @&quot;GET&quot;;}- (XLServer *)server { return [XLVipExtServer sharedServer];}@endåœ¨ä»¥å‰çš„é”™è¯¯ç å¤„ç†ä¸­ï¼Œéƒ½æ˜¯ç»Ÿä¸€åœ¨APIManagerä¸­å¤„ç†ã€‚ä½†æ˜¯åæ¥é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºè¯·æ±‚çš„æœåŠ¡å™¨ä¸åŒï¼Œå¯¼è‡´é”™è¯¯ç å¤„ç†ä¸ä¸€è‡´ï¼Œå†çœ‹æˆ‘ä»¬ä¹‹å‰çš„å®ç°ï¼Œå°±æœ‰ç‚¹ä»£ç çš„åå‘³é“äº†ã€‚åˆ†æåå‘ç°ï¼Œé”™è¯¯ç å…¶å®æ˜¯å’ŒæœåŠ¡å™¨æŒ‚é’©ï¼ŒçœŸæ­£è¯¥å¦‚ä½•å¤„ç†ä¸€ä¸ªæ•°æ®åº”è¯¥æ˜¯ç”±è¯¥æœåŠ¡å™¨è¯´äº†ç®—ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™XLServerè¿™ä¸ªç±»åŠ äº†ä¸€ä¸ªåè®®ï¼š@protocol XLServerDataProcessProtocol &amp;lt;NSObject&amp;gt;/** * å¤„ç†æ•°æ®ï¼Œå¯æŠ›å‡ºå¼‚å¸¸æˆ–è¯·æ±‚é‡è¯•ã€‚ * * @param data è¦å¤„ç†çš„æ•°æ® * @param error é”™è¯¯ * @param retry æ˜¯å¦éœ€è¦é‡è¯• */- (void)handleData:(id)data error:(NSError **)error shouldRetry:(BOOL *)retry;// åœ¨çˆ¶APIManager.m å®ç°ä¸­if ([self.child.server conformsToProtocol:@protocol(XLServerDataProcessProtocol)]) { NSError *error = nil; BOOL retry = NO; [(id &amp;lt;XLServerDataProcessProtocol&amp;gt;)self.child.server handleData:responseObject error:&amp;amp;error shouldRetry:&amp;amp;retry]}åœ¨APIå¤„ç†ç»“æœä¸­ï¼Œå¯¹å½“å‰å­ç±»çš„serverè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæœ‰å“åº”åè®®ï¼Œåˆ™äº¤ç»™ç›¸åº”æœåŠ¡å™¨å¯¹è±¡å¤„ç†ã€‚è¿™äº›åœ¨Objective-Cä¸­çš„å®è·µä¾‹å­ï¼Œå®é™…ç”¨å¤„æ˜¯è§„èŒƒäº†å„ä¸ªç±»çš„æ•°æ®å’ŒåŠ¨ä½œçš„å®ç°ï¼Œä½¿å¾—ä»£ç ç»“æ„å˜å¾—æ¸…æ™°ï¼Œé€»è¾‘ä¸¥å¯†ã€‚ç®€è°ˆå‡½æ•°å¼ç¼–ç¨‹ åœ¨Swiftä¸­ï¼Œå‡½æ•°æˆä¸ºäº†First class valueï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ä¼ é€’ã€ä½¿ç”¨å‡½æ•°å°±åƒä½¿ç”¨ä¸€ä¸ªæ•°å­—ã€ä¸€ä¸ªå­—ç¬¦ä¸²ä¸€æ ·ç®€å•ã€‚ å¯ä»¥ç²—ç•¥çš„çœ‹å¾…ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯ä¸€ä¸ªè¿‡ç¨‹ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡å˜æ¢å‡½æ•°ï¼Œåˆ›é€ ä¸€ä¸ªä¸ªâ€œå°å·¥å…·â€ï¼Œè¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ„å»ºå¤æ‚çš„è¿‡ç¨‹ã€‚ å‡½æ•°æ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•å’Œæ‰¾å‡ºbugä¸€ä¸ªç®€å•çš„å‡½æ•°å¼æ€æƒ³çš„ä¾‹å­å‡å¦‚æˆ‘ä»¬å†™ä¸€ä¸ªæˆ˜èˆ¹çš„ä¾‹å­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥å®šä½æ•Œæ–¹æˆ˜èˆ¹æ˜¯å¦åœ¨æˆ‘ä»¬çš„æœ‰æ•ˆå°„ç¨‹èŒƒå›´å†…ï¼štypealias Distance = Doublestruct Position { var x: Double var y: Double}extension Position { func inRange(range: Distance) -&amp;gt; Bool { return sqrt(x * x + y * y) &amp;lt;= range }}struct Ship { var position: Position var firingRange : Distance var unsafeRange : Distance}extension Ship { // æœ€åˆæˆ‘ä»¬å°±åˆ¤æ–­æ˜¯ä¸æ˜¯åœ¨å°„ç¨‹èŒƒå›´é‡Œ func canEngageShip(target: Ship) -&amp;gt; Bool { let dx = target.position.x - position.x let dy = target.position.y - position.y return sqrt(dx * dx + dy * dy) &amp;lt;= firingRange } // å‘ç°åŒæ—¶ï¼Œæ•Œæ–¹ä¹Ÿä¸èƒ½ç¦»æˆ‘ä»¬å¤ªè¿‘ func canSafelyEngageShip(target: Ship) -&amp;gt; Bool { let dx = target.position.x - position.x let dy = target.position.y - position.y let targetDistance = sqrt(dx * dx + dy * dy) return targetDistance &amp;lt;= firingRange &amp;amp;&amp;amp; targetDistance &amp;gt; unsafeRange } // å‹æ–¹æˆ˜èˆ¹ä¹Ÿä¸èƒ½ç¦»ç›®æ ‡å¤ªè¿‘ func canSafelyEngageShip1(target: Ship, friendly: Ship) -&amp;gt; Bool { let dx = target.position.x - position.x let dy = target.position.y - position.y let targetDistance = sqrt(dx * dx + dy * dy) let friendlyDx = friendly.position.x - target.position.x let friendlyDy = friendly.position.y - target.position.y let friendlyDistance = sqrt(friendlyDx * friendlyDx + friendlyDy * friendlyDy) return targetDistance &amp;lt;= firingRange &amp;amp;&amp;amp; targetDistance &amp;gt; unsafeRange &amp;amp;&amp;amp; (friendlyDistance &amp;gt; friendly.unsafeRange) }}ä¸ºäº†ç®€åŒ–è®¡ç®—ï¼Œæˆ‘ä»¬æŠ½å–å…¶ä¸­çš„å‡ ä¸ªæ–¹æ³•ï¼šextension Position { func minus(_ p: Position) -&amp;gt; Position { return Position(x: x - p.x, y: y - p.y) } var length: Double { return sqrt(x * x + y * y) }}extension Ship { func canSafelyEngageShip2(target: Ship, friendly: Ship) -&amp;gt; Bool { let targetDistance = target.position.minus(self.position).length let friendlyDistance = friendly.position.minus(target.position).length return targetDistance &amp;lt;= firingRange &amp;amp;&amp;amp; targetDistance &amp;gt; unsafeRange &amp;amp;&amp;amp; (friendlyDistance &amp;gt; unsafeRange) }}æœ€ç»ˆè¿™ä¸ªå‡½æ•°è¡¨ç°æˆè¿™æ ·ï¼Œçœ‹èµ·æ¥æ¡ä¾‹æ¸…æ™°ï¼Œé€»è¾‘æ¸…æ¥šï¼Œä½†æ˜¯éš¾å…åœ¨æ•´ä¸ªå‡½æ•°æ„å»ºè¿‡ç¨‹ä¸­å‘ç°ï¼Œè¿™ä¸ªè¿‡ç¨‹åŒ…å«ç€ä¸€æ¬¡æ¬¡é‡æ„ã€‚ç°åœ¨æˆ‘ä»¬æ¢ä¸ªæ€è·¯ï¼ŒæŠŠè¿™ä¸€ä¸ªå…³é”®çš„åˆ¤æ–­è¿‡ç¨‹çœ‹åšä¸€ä¸ªå¯¹è±¡:typealias Region = (Position) -&amp;gt; Boolæˆ‘ä»¬æŠŠè¿™ä¸ªè¿‡ç¨‹å®šä¹‰æˆä¸€ä¸ªåä¸ºåŒºåŸŸçš„ç±»å‹ã€‚ç„¶åæˆ‘ä»¬éœ€è¦ä¸€äº›å·¥å…·æ¥ç”Ÿæˆæˆ–è€…æ”¹å˜åŒºåŸŸï¼šfunc circle(_ radius: Distance) -&amp;gt; Region { return { $0.length &amp;lt;= radius }}func shift(_ region: @escaping Region, offset: Position) -&amp;gt; Region { return { region($0.minus(offset)) }}func invert(_ region: @escaping Region) -&amp;gt; Region { return { !region($0) }}func intersection(_ region1: @escaping Region, _ region2: @escaping Region) -&amp;gt; Region { return { point in region1(point) &amp;amp;&amp;amp; region2(point) }}func union(_ region1: @escaping Region, _ region2: @escaping Region) -&amp;gt; Region { return { point in region1(point) || region2(point) }}func difference(_ region1: @escaping Region, minus: @escaping Region) -&amp;gt; Region { return intersection(region1, invert(minus))}æœ‰äº†è¿™äº›å°å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„å®šä¹‰ä¹‹å‰çš„å‡½æ•°extension Ship { func canSafelyEngageShip(target: Ship, friendly: Ship) -&amp;gt; Bool { // ç”Ÿæˆè‡ªå·±çš„å®‰å…¨æ”»å‡»èŒƒå›´ let rangeRegion = difference(circle(firingRange), minus: circle(unsafeRange)) // ä½ç§»ä¸€ä¸‹åˆ°æˆ˜èˆ¹æ‰€å¤„åæ ‡ let firingRegion = shift(rangeRegion, offset: position) // ç”Ÿæˆå‹æ–¹çš„å®‰å…¨èŒƒå›´ let friendlyRegion = shift(circle(friendly.unsafeRange),offset: friendly.position) // ç”Ÿæˆå®é™…æœ‰æ•ˆèŒƒå›´ let resultRegion = difference(firingRegion, minus: friendlyRegion) return resultRegion(target.position) }}let me = Ship(position: Position(x: 0, y: 0), firingRange: 100, unsafeRange: 20)let target = Ship(position: Position(x: 77, y: -10), firingRange: 100, unsafeRange: 20)let friendly = Ship(position: Position(x: 59, y: 8), firingRange: 100, unsafeRange: 20)me.canSafelyEngageShip(target: target, friendly: friendly)// output: truePOPã€æ³›å‹å’Œå‡½æ•°å¼ç¼–ç¨‹çš„ç»“åˆæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ“ä½œè¿‡ç¨‹ï¼Œä¼ å…¥ä¸€ä¸ªå‚æ•°äº§ç”Ÿä¸€ä¸ªç»“æœã€‚è¿™ç§åŸºç¡€è¿‡ç¨‹éå¸ƒæˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼šenum Result&amp;lt;T&amp;gt; { case success(T) case failed(Error)}typealias fu_operation&amp;lt;E, T&amp;gt; = (E) -&amp;gt; Result&amp;lt;T&amp;gt;è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªæšä¸¾çš„ç»“æœç±»å‹ï¼Œç”¨æ³›å‹è¡¨ç¤ºç»“æœä¸­çš„å®é™…ç±»å‹ã€‚å®šä¹‰çš„operationè¡¨ç¤ºè¾“å…¥ä¸€ä¸ªEç±»å‹çš„æ•°æ®ï¼Œäº§ç”Ÿä¸€ä¸ªResult&amp;lt;T&amp;gt;ç±»å‹çš„ç»“æœã€‚ç„¶åæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªcombineå‡½æ•°ï¼Œç”¨äºç»“åˆä¸¤ä¸ªoperationï¼šfunc combine&amp;lt;E, T, H&amp;gt;(op1: @escaping fu_operation&amp;lt;E, T&amp;gt;, op2: @escaping fu_operation&amp;lt;T, H&amp;gt;) -&amp;gt; fu_operation&amp;lt;E, H&amp;gt; { return { params in let rst = op1(params) switch rst { case .success(let value): return op2(value) case .failed(let e): return .failed(e) } }}æµ‹è¯•ä¸€ä¸‹ï¼Œaæ˜¯å°†å­—å…¸æ‰€æœ‰keyå€¼å–å‡ºæ¥ç¼–ç¨‹æ•°ç»„çš„è¿‡ç¨‹ï¼Œbæ˜¯æŠŠæ•°ç»„è½¬æˆå¯è¯»å­—ç¬¦ä¸²çš„è¿‡ç¨‹ï¼šlet a: fu_operation&amp;lt;[String: Any] ,[String]&amp;gt; = { params in return .success( params.reduce([String](), { (rst: [String], couple: (key: String, value: Any)) -&amp;gt; [String] in var newRst: [String] = rst newRst.append(couple.key) return newRst }) )}let b: fu_operation&amp;lt;[String], String&amp;gt; = {params in var str = &quot;&quot; for value in params { str.append(value + &quot; ,&quot;) } return .success(str)}combine(op1: a, op2: b)([&quot;a&quot;: 1, &quot;b&quot;: 2])//è¾“å‡ºä¸ºï¼š//success(&quot;b ,a ,&quot;)ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªç±»ï¼Œä»¥åä¹Ÿå¯ä»¥åœ¨å…¶ä¸­åšæ‰©å±•ï¼šclass st_operation&amp;lt;E, T&amp;gt; { var op: fu_operation&amp;lt;E, T&amp;gt; = { _ in .failed(NSError())} init() { } init(with operation: @escaping (E) -&amp;gt; Result&amp;lt;T&amp;gt;) { self.op = operation }}ä»¥ä¸€ä¸ªæ•°æ®è¯·æ±‚åŠ¨ä½œä¸ºä¾‹ï¼Œæ‹¿åˆ°çš„æ•°æ®é€šå¸¸æ˜¯JSONè½¬æ¢æˆçš„Dictionaryï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåè®®ï¼šprotocol ConstructableFromDictionary { static func generate(from dictionary: [String: Any]) -&amp;gt; Self?}æ¥ç€æˆ‘ä»¬å®šä¹‰æˆ‘ä»¬çš„APIåŠ¨ä½œï¼ŒåŠ¨ä½œæœ‰ä¸¤ä¸ªæ“ä½œï¼Œä¸€ä¸ªæ˜¯å‘èµ·è¯·æ±‚è·å–æºæ•°æ®ï¼Œä¸€ä¸ªæ˜¯è½¬æ¢å…ƒæ•°æ®åˆ°æˆ‘ä»¬å®šä¹‰çš„æ¨¡å‹ï¼štypealias Parameters = [String: Any]class API&amp;lt;T: ConstructableFromDictionary&amp;gt; { var requestOperation: st_operation&amp;lt;Parameters, [String: Any]&amp;gt; = st_operation { .success(Request.GET(params: $0)) } var transform: st_operation&amp;lt;[String: Any], T&amp;gt; = st_operation { if let rst = T.generate(from: $0) { return .success(rst) } else { return .failed(NSError()) } } func request(params: Parameters?) throws -&amp;gt; T { // é¦–å…ˆç»“åˆä¸¤ä¸ªæ“ä½œï¼Œç„¶åè¿”å›å…¶ä¸­çš„ç»“æœ let op = combine(op1: self.requestOperation.op, op2: self.transform.op) let result = op(params ?? [:]) switch result { case .success(let value): return value case .failed(let error): throw error } }}å‡å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦æ‹‰å–ä¸€ä¸ªæ°´æœçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå®šä¹‰ä¸€ä¸ªæ°´æœçš„ç±»ï¼Œä½¿ä»–å®ç°åè®®ï¼šclass Fruit: ConstructableFromDictionary { var name: String = &quot;&quot; required init() { } static func generate(from dictionary: [String : Any]) -&amp;gt; Self? { let fruit = self.init() fruit.name = dictionary[&quot;name&quot;] as? String ?? &quot;&quot; return fruit }}è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬ä¸ç”¨å†™å…¶ä»–ä»»ä½•å¤šä½™ä»£ç ï¼Œå°±å¯ä»¥åˆ©ç”¨åŸºç¡€çš„APIç±»åšåˆ°æ•°æ®è¯·æ±‚ã€‚let fruitAPI = API&amp;lt;Fruit&amp;gt;()do { let fruit = try fruitAPI.request(params: nil) fruit.name // Get fruit&#39;s name success, yeah} catch { // deal error}æ€»ç»“ Swiftå¸¦ç»™æˆ‘ä»¬çš„æ–°ä½“éªŒæ˜¯Amazingçš„ï¼Œè™½ç„¶POPæˆ–IOPæ¦‚å¿µå¾ˆæ—©å°±æœ‰ï¼Œä½†æ˜¯ç»“åˆæ³›å‹å’Œå‡½æ•°å¼ç¼–ç¨‹ï¼Œå­¦ä¹ å®ƒè€Œå¸¦ç»™æˆ‘ä»¬çš„æ˜¯æ€ç»´ä¸Šçš„è¿›åŒ–æˆ–è€…é©å‘½ï¼Œè®©æˆ‘ä»¬æ‹¥æœ‰æ›´æ–°çš„è§†è§’ã€‚ å¯¹äºiOSè€Œè¨€ï¼Œå®é™…åº”ç”¨ä¸­ï¼ŒOOPå’ŒPOPæ··åˆä½¿ç”¨æ˜¯å¿…ä¸å¯å°‘çš„ï¼ŒPOPçš„åŠ å…¥çš„æ„ä¹‰æ˜¯ä½¿ä»£ç æ›´è§„èŒƒã€çµæ´»ï¼Œä½¿ç»“æ„å’Œé€»è¾‘æ›´æ¸…æ™°æ˜“æ‡‚ã€‚ ä»¥ä¸Šæ‰€æœ‰ä»£ç éƒ½æ˜¯Swift-Onlyçš„ï¼Œæ‰€ä»¥åœ¨ä»¥åè·¨å¹³å°ä¸Šï¼ŒSwiftå’ŒPOPä¼šæ›´æœ‰ä¼˜åŠ¿ã€‚å½“ç„¶åœ¨iOSä¸ŠOCè¿˜æ˜¯èˆå¼ƒä¸æ‰çš„ï¼ŒOCçš„ä¼˜åŠ¿æ˜¯æ›´çµæ´»çš„Runtimeï¼Œå®é™…åº”ç”¨ä¸­æ›´éœ€å„å–æ‰€é•¿ã€‚å†™Swiftä»£ç ä¹Ÿå°½é‡é¿å…rewrite OC codeã€‚å‚è€ƒ [B]Functional Swift - Chris Eidhof, Florian Kugler, Wouter Swierstra Practical Protocol Oriented Programmingæ‰©å±•é˜…è¯» Functors, Applicatives, And Monads In Pictures" }, { "title": "Transmission Between Weex and iOS Native", "url": "/posts/Transmissioin-between-Weex-and-iOS-native/", "categories": "Tech, Hybrid", "tags": "", "date": "2017-03-24 13:00:00 +0800", "snippet": "Weex ä¸ iOS Native çš„ä¼ è¾“åœ¨ä½¿ç”¨Weexæ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æ•°æ®å’Œäº‹ä»¶ä¸nativeä¹‹é—´çš„äº¤äº’ï¼Œå¤šå‘ç”Ÿäºç•Œé¢äº‹ä»¶å’Œæ•°æ®ä¼ è¾“ã€‚ä¸¾ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼ŒWeex pageä¸­ä¸€é¡¹å†…è´­çš„é¡µé¢ï¼Œéœ€è¦æ˜¾ç¤ºApple storeçš„ä»·æ ¼ï¼Œæ­¤æ—¶éœ€è¦nativeä»æœåŠ¡å™¨æ‹¿åˆ°ä»·æ ¼åå‘é€ç»™weex pageåšæ˜¾ç¤ºã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬weexå‘é€è¯·æ±‚åˆ°æœ¬åœ°ï¼Œæœ¬åœ°å¤„ç†å›è°ƒç­‰ã€‚æœ¬æ–‡ä¸»è¦å†…å®¹å°±æ˜¯ï¼Œå¦‚ä½•å®ç°è¿™ä¸€è¿‡ç¨‹åŠä¿è¯ç»Ÿä¸€ã€ä½è€¦åˆçš„ä¸­é—´å±‚ã€‚å®ç°åŸç†Weex ç«¯å‘é€è¯·æ±‚åœ¨Weexç•Œé¢çš„JS scriptä¸­ï¼Œæˆ‘ä»¬èƒ½é€šè¿‡è°ƒç”¨Appæ³¨å†Œçš„æ¨¡ç»„æ¥ç›´æ¥è°ƒç”¨æ–¹æ³•ã€‚åœ¨demoä¸­ï¼Œå¤„ç†è¿™ä¸€è¿‡ç¨‹çš„æ˜¯XLPluginEventç±»ã€‚åœ¨åˆå§‹åŒ–SDKæ—¶ï¼Œé€šè¿‡æ³¨å†Œï¼š[WXSDKEngine registerModule:@&quot;mediator&quot; withClass:NSClassFromString(@&quot;XLPluginEvent&quot;)];JSç«¯å°±å¯ä»¥é€šè¿‡æ³¨å†Œçš„ç±»å…¶ä¸­çš„æ–¹æ³•ï¼Œæ¥å‘èµ·ä¸€ä¸ªEventï¼švar module = weex.requireModule(&#39;mediator&#39;);module.sendRequestData(data, &#39;pluginA&#39;, &#39;native&#39;, (ret) =&amp;gt; { this.result = ret modal.toast({ message: &#39;receive&#39;, duration: 0.3 })})JSç«¯çš„functionå¯ä»¥ä»¥å‚æ•°ä¼ é€’ç»™nativeå¹¶ä»¥blockå½¢å¼è°ƒç”¨ã€‚è¿™æ ·å°±å®ç°äº†JSç«¯å‘èµ·Eventå¹¶å¯ä»¥è·å¾—å›è°ƒã€‚Nativeå‘èµ·EventsNativeç«¯å¯æœ‰ä¸¤ç§æ–¹å¼ä¼ é€’eventsè‡³Weexã€‚ é€šè¿‡WXSDKManageræä¾›çš„fireEvent:ref:type:params:domChanges:æ–¹æ³•ã€‚ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨weex pageä¸Šç›‘å¬åˆ°äº‹ä»¶ï¼Œå¦‚ [[WXSDKManager bridgeMgr] fireEvent:targetWX.InstanceId ref:@&quot;_root&quot; type:@&quot;nativetransport&quot; params:paramsAddCallback domChanges:nil]; &amp;lt;template&amp;gt; &amp;lt;text onClick=&#39;onClick&#39; onnativetransport=&quot;&quot; id=&#39;text1&#39;&amp;gt;callback: &amp;lt;/text&amp;gt; &amp;lt;/template&amp;gt; &amp;lt;script&amp;gt; # ä¸Šç•¥ nativeTransport: function(e) { console.log(e) } &amp;lt;/script&amp;gt; é€šè¿‡fireGlobalEvent:params:æ–¹æ³•è¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯å‘é€ä¸€ä¸ªå…¨å±€é€šçŸ¥ï¼Œæ‰€æœ‰å·²å­˜åœ¨çš„Weex pageéƒ½èƒ½æ¥æ”¶åˆ°è¿™ä¸ªEventï¼Œä½†å‰ææ˜¯Weex pageåˆå§‹åŒ–æ—¶æ³¨å†Œlistenerã€‚ var globalEvent = require(&#39;@weex-module/globalEvent&#39;)globalEvent.addEventListener(&quot;nativetransport&quot;, (e) =&amp;gt; { console.log(e) this.result = &quot;native send a request&quot;}) è¿™æ—¶nativeè°ƒç”¨fireEventå°±å¯ä»¥è§¦å‘è¿™ä¸ªç›‘å¬äº‹ä»¶ã€‚ ä¸­é—´å±‚å»ºç«‹ä¸­é—´å±‚çš„ç›®çš„æ˜¯ç»Ÿä¸€å¯¹æ‰€æœ‰Weex pageçš„eventsåšè½¬å‘ï¼Œä¸€æ¥æ˜¯æ–¹ä¾¿åšhookï¼ŒäºŒæ¥æ˜¯é˜²æ­¢pluginä¸pluginä¹‹é—´äº’ç›¸ç›´æ¥è°ƒç”¨äº§ç”Ÿè€¦åˆã€‚å¦‚æœæ²¡æœ‰ç»Ÿä¸€çš„ä¸­é—´å±‚å’Œæ´¾å‘å…³ç³»ï¼Œæƒ³è±¡ä¸€ä¸‹ç»´æŠ¤è¿‡Nä¸ªç‰ˆæœ¬ä¹‹åçš„æ‚ä¹±æ— ç« çš„è°ƒç”¨å…³ç³»â€¦æ¢³ç†ä¸‹æˆ‘ä»¬æœŸå¾…çš„æµç¨‹å›¾ï¼šç»‘å®šäº‹ä»¶æ¯ä¸ªWeex instanceéƒ½å¯ä»¥ç»‘å®šmoduleæ¥å¤„ç†äº‹ä»¶ï¼Œæ‰€ä»¥moduleçš„å®ä¾‹ä¹Ÿæ˜¯åˆ†æ•£å½¢å¼çš„ã€‚æˆ‘ä»¬ç”¨ç»Ÿä¸€çš„ç±»XLPluginEventæ¥æ”¶é›†ä¿¡æ¯ï¼Œå¹¶å°†ä¿¡æ¯è½¬åˆ°ç»Ÿä¸€çš„ä¸­é—´å±‚ç±»XLWxPluginMediatoråšå¤„ç†ã€‚[WXSDKEngine registerModule:@&quot;mediator&quot; withClass:NSClassFromString(@&quot;XLPluginEvent&quot;)];// In XLPluginEvent class:- (void)sendRequestData:(NSDictionary *)data from:(NSString *)source toTarget:(NSString *)target callback:(WXModuleCallback)callback { [[XLWxPluginMediator sharedInstance] sendRequestData:data from:weexInstance source:source toTarget:target callback:callback];}ä¸­é—´å¤„ç†XLWxPluginMediatoråŒæ—¶å…·æœ‰æ¥æ”¶å’Œå‘é€åŠŸèƒ½ã€‚æ¥æ”¶eventä¹‹åä¼šæ ¹æ®eventé™„å¸¦çš„informationï¼Œåšæœ¬åœ°åˆ†å‘æˆ–æ’ä»¶åˆ†å‘ï¼Œä¸€èˆ¬ç”¨targetæ ‡æ˜eventçš„ç›®æ ‡å¯¹è±¡ã€‚- (void)sendRequestData:(NSDictionary *)data from:(WXSDKInstance *)wx source:(NSString *)source toTarget:(NSString *)target callback:(WXModuleCallback)callback { if ([target isEqualToString:@&quot;native&quot;]) { // Notify all native listeners } else { // 1 . find target// WXSDKInstance *target = [Finder findtarget]; // 2 . fire a event &amp;amp; wait to callback// [self sendEventTo:target params:data callback:callback]; }}nativeå‘pluginåšé€šä¿¡è¯·æ±‚æš‚æ—¶æ˜¯é€šè¿‡fireGlobalEventæ–¹æ³•å®ç°çš„ï¼ŒåŸå› æ˜¯ä½¿ç”¨fireEventä¼šä¸ç•Œé¢ç»‘å®šï¼ŒæŸäº›åœºåˆæˆ‘ä»¬å¹¶ä¸éœ€è¦ä¸ç•Œé¢ç»‘å®šã€‚- (void)sendEventTo:(WXSDKInstance *)wx params:(NSDictionary *)params callback:(WXModuleCallback)callback { NSMutableDictionary *paramsAddCallback = [NSMutableDictionary dictionaryWithDictionary:params]; [paramsAddCallback setObject:callback forKey:@&quot;callback&quot;]; [wx fireGlobalEvent:@&quot;nativetransport&quot; params:paramsAddCallback];}æ‹¥æœ‰å“åº”native eventçš„pluginå¿…é¡»åœ¨onCreateé‡Œå®ç°è¿™ä¸ªeventçš„ç›‘å¬ï¼šcreated: function () { var globalEvent = require(&#39;@weex-module/globalEvent&#39;) globalEvent.addEventListener(&quot;nativetransport&quot;, (e) =&amp;gt; { console.log(e) }) },ç”±æ­¤å°±å®ç°äº†pluginä¸nativeä¹‹é—´çš„åŒå‘ä¼ è¾“ã€‚Plugins ä¹‹é—´çš„ä¼ è¾“// TODO: - " }, { "title": "Nginx Deployment on Mac OS", "url": "/posts/Nginx-depoloyment-on-Mac-OS/", "categories": "Tech, Server", "tags": "", "date": "2017-03-22 18:02:09 +0800", "snippet": "Mac OSä¸‹å®‰è£…åŠé…ç½®nginxå®‰è£…åŒ… ä¸‹è½½ Nginx æºç åŒ… ä¸‹è½½é¡µ: http://nginx.org/en/download.html å½“å‰ç¨³å®šç‰ˆæœ¬: http://nginx.org/download/nginx-1.8.1.tar.gz zlib ä¸‹è½½é¡µ: http://zlib.net/ å½“å‰ç¨³å®šç‰ˆæœ¬: http://zlib.net/zlib-1.2.8.tar.gz æ³¨: Nginx å‚è€ƒæ–‡æ¡£ä¸­æåˆ°éœ€è¦ 1.1.3 ä»¥ä¸Šç‰ˆæœ¬çš„ zlib pcre ä¸‹è½½é¡µ: http://www.pcre.org/ å½“å‰ç¨³å®šç‰ˆæœ¬: ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.38.tar.gz æ³¨: Nginx å‚è€ƒæ–‡æ¡£ä¸­æåˆ°éœ€è¦ 4.4 ä»¥ä¸Šç‰ˆæœ¬çš„ pcre é…ç½®åŠå®‰è£… First, è¿›å…¥åˆ°åŒ…æ‰€åœ¨çš„æ–‡ä»¶å¤¹å†… tar zxvf zlib-1.2.8.tar.gz # å¾—åˆ° zlib-1.2.8 ç›®å½•tar zxvf pcre-8.36.tar.gz # å¾—åˆ° pcre-8.36 ç›®å½• ç¼–è¯‘å®‰è£… Nginx è¿™é‡Œä¼šå°†å„ä¾èµ–çš„æºç ç¼–è¯‘è¿› Nginx, æ‰€ä»¥ â€“with-zlib å’Œ â€“with-pcre åä¸ºå¯¹åº”çš„ä¾èµ–æºç ç›®å½•è·¯å¾„ã€‚æ­¤å¤–, ç¼–è¯‘é€‰é¡¹ä¸­è¿˜å¼€å¯äº† HTTPS çš„åè®®æ”¯æŒâ€“with-http_ssl_module, è‹¥ä¸éœ€è¦ HTTPS, å¯å–æ¶ˆè¯¥é€‰é¡¹ã€‚ tar zxvf nginx-1.8.0.tar.gz cd nginx-1.8.0 ./configure --prefix=/usr/local/nginx --with-zlib=../zlib-1.2.8 --with-pcre=../pcre-8.36 make sudo make install å…¶ä»–å®‰è£…æŒ‡ä»¤ï¼ˆå¯åšäº†è§£ï¼‰ nginxå¤§éƒ¨åˆ†å¸¸ç”¨æ¨¡å—ï¼Œç¼–è¯‘æ—¶./configure --helpä»¥--withoutå¼€å¤´çš„éƒ½é»˜è®¤å®‰è£…ã€‚ --prefix=PATH ï¼š æŒ‡å®šnginxçš„å®‰è£…ç›®å½•ã€‚é»˜è®¤ /usr/local/nginx --conf-path=PATH ï¼š è®¾ç½®nginx.confé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚nginxå…è®¸ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œé€šè¿‡å‘½ä»¤è¡Œä¸­çš„-cé€‰é¡¹ã€‚é»˜è®¤ä¸ºprefix/conf/nginx.conf --user=nameï¼š è®¾ç½®nginxå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·ã€‚å®‰è£…å®Œæˆåï¼Œå¯ä»¥éšæ—¶åœ¨nginx.confé…ç½®æ–‡ä»¶æ›´æ”¹useræŒ‡ä»¤ã€‚é»˜è®¤çš„ç”¨æˆ·åæ˜¯nobodyã€‚--group=nameç±»ä¼¼ --with-pcre ï¼š è®¾ç½®PCREåº“çš„æºç è·¯å¾„ï¼Œå¦‚æœå·²é€šè¿‡yumæ–¹å¼å®‰è£…ï¼Œä½¿ç”¨--with-pcreè‡ªåŠ¨æ‰¾åˆ°åº“æ–‡ä»¶ã€‚ä½¿ç”¨--with-pcre=PATHæ—¶ï¼Œéœ€è¦ä»PCREç½‘ç«™ä¸‹è½½pcreåº“çš„æºç ï¼ˆç‰ˆæœ¬4.4 - 8.30ï¼‰å¹¶è§£å‹ï¼Œå‰©ä¸‹çš„å°±äº¤ç»™Nginxçš„./configureå’Œmakeæ¥å®Œæˆã€‚perlæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨åœ¨locationæŒ‡ä»¤å’Œ ngx_http_rewrite_moduleæ¨¡å—ä¸­ã€‚ --with-zlib=PATH ï¼š æŒ‡å®š zlibï¼ˆç‰ˆæœ¬1.1.3 - 1.2.5ï¼‰çš„æºç è§£å‹ç›®å½•ã€‚åœ¨é»˜è®¤å°±å¯ç”¨çš„ç½‘ç»œä¼ è¾“å‹ç¼©æ¨¡å—ngx_http_gzip_moduleæ—¶éœ€è¦ä½¿ç”¨zlib ã€‚ --with-http_ssl_module ï¼š ä½¿ç”¨httpsåè®®æ¨¡å—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ¨¡å—æ²¡æœ‰è¢«æ„å»ºã€‚å‰ææ˜¯opensslä¸openssl-develå·²å®‰è£… --with-http_stub_status_module ï¼š ç”¨æ¥ç›‘æ§ Nginx çš„å½“å‰çŠ¶æ€ --with-http_realip_module ï¼š é€šè¿‡è¿™ä¸ªæ¨¡å—å…è®¸æˆ‘ä»¬æ”¹å˜å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­å®¢æˆ·ç«¯IPåœ°å€å€¼(ä¾‹å¦‚X-Real-IP æˆ– X-Forwarded-For)ï¼Œæ„ä¹‰åœ¨äºèƒ½å¤Ÿä½¿å¾—åå°æœåŠ¡å™¨è®°å½•åŸå§‹å®¢æˆ·ç«¯çš„IPåœ°å€ --add-module=PATH ï¼š æ·»åŠ ç¬¬ä¸‰æ–¹å¤–éƒ¨æ¨¡å—ï¼Œå¦‚nginx-sticky-module-ngæˆ–ç¼“å­˜æ¨¡å—ã€‚æ¯æ¬¡æ·»åŠ æ–°çš„æ¨¡å—éƒ½è¦é‡æ–°ç¼–è¯‘ï¼ˆTengineå¯ä»¥åœ¨æ–°åŠ å…¥moduleæ—¶æ— éœ€é‡æ–°ç¼–è¯‘ï¼‰ æ¯”å¦‚ï¼š ./configure \\ &amp;gt; --prefix=/usr \\ &amp;gt; --sbin-path=/usr/sbin/nginx \\ &amp;gt; --conf-path=/etc/nginx/nginx.conf \\ &amp;gt; --error-log-path=/var/log/nginx/error.log \\ &amp;gt; --http-log-path=/var/log/nginx/access.log \\ &amp;gt; --pid-path=/var/run/nginx/nginx.pid \\ &amp;gt; --lock-path=/var/lock/nginx.lock \\ &amp;gt; --user=nginx \\ &amp;gt; --group=nginx \\ &amp;gt; --with-http_ssl_module \\ &amp;gt; --with-http_stub_status_module \\ &amp;gt; --with-http_gzip_static_module \\ &amp;gt; --http-client-body-temp-path=/var/tmp/nginx/client/ \\ &amp;gt; --http-proxy-temp-path=/var/tmp/nginx/proxy/ \\ &amp;gt; --http-fastcgi-temp-path=/var/tmp/nginx/fcgi/ \\ &amp;gt; --http-uwsgi-temp-path=/var/tmp/nginx/uwsgi \\ &amp;gt; --with-pcre=../pcre-7.8 &amp;gt; --with-zlib=../zlib-1.2.3 è®¾ç½®ç›‘å¬è¿›å…¥é…ç½®æ–‡ä»¶/usr/local/nginx/conf/nginx.conf ï¼Œä¿®æ”¹listenä¸‹å‚æ•°ï¼šserver { listen 85; #ç›‘å¬ç«¯å£ server_name localhost; #ç›‘å¬æœåŠ¡å™¨ #charset koi8-r; #access_log logs/host.access.log main; location / { root html; index index.html index.htm; } #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } }å¯åŠ¨nginxcd /usr/local/nginx#å¯åŠ¨sudo sbin/nginx #æµè§ˆå™¨è®¿é—® 127.0.0.1 æµ‹è¯•æ˜¯å¦æˆåŠŸå¯åŠ¨#é‡å¯sudo sbin/nginx -s reload#åœæ­¢sudo sbin/nginx -s stopä¿®æ”¹è¿”å›å€¼ä»¥bandwidthè¯·æ±‚ï¼šhttp://127.0.0.1:8001/v2/bandwidthæŒ‰ç…§è¯·æ±‚çš„æ ¼å¼åˆ›å»ºç›®å½•ä¸ºï¼š/usr/local/nginx/html/v2/ ï¼ˆ/usr/local/nginx/html/ä¸ºé»˜è®¤ç›®å½•,/v2/ä¸ºæ ¹æ®è¯·æ±‚æ ¼å¼æ–°å»ºçš„ç›®å½•ï¼‰æ–°å»ºbandwidthæ–‡ä»¶ï¼Œåˆ™æ–‡ä»¶è·¯å¾„ä¸º/usr/local/nginx/html/v2/bandwidthï¼Œå†™å…¥è¿”å›å€¼ï¼Œåˆ™æ„é€ æŒ‡å®šè¿”å›æŠ¥æ–‡æˆåŠŸï¼Œå¯æŒ‰ç…§è‡ªå·±éœ€æ±‚è¿›è¡Œç¼–è¾‘ï¼›ç„¶ååœ¨æµè§ˆå™¨ä¸­è¯·æ±‚è¿™ä¸ªæ¥å£ï¼Œè¿”å›è‡ªå®šä¹‰çš„å†…å®¹åˆ™é…ç½®æˆåŠŸã€‚" }, { "title": "Welcome to Jekyll!", "url": "/posts/welcome-to-jekyll/", "categories": "Blogging, Tutorial", "tags": "", "date": "2017-03-22 17:02:09 +0800", "snippet": "Youâ€™ll find this post in your _posts directory. Go ahead and edit it and re-build the site to see your changes. You can rebuild the site in many different ways, but the most common way is to run jekyll serve, which launches a web server and auto-regenerates your site when a file is updated.To add new posts, simply add a file in the _posts directory that follows the convention YYYY-MM-DD-name-of-post.ext and includes the necessary front matter. Take a look at the source for this post to get an idea about how it works.Jekyll also offers powerful support for code snippets:def print_hi(name) puts &quot;Hi, #{name}&quot;endprint_hi(&#39;Tom&#39;)#=&amp;gt; prints &#39;Hi, Tom&#39; to STDOUT.Check out the Jekyll docs for more info on how to get the most out of Jekyll. File all bugs/feature requests at Jekyllâ€™s GitHub repo. If you have questions, you can ask them on Jekyll Talk." } ]
