<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Learning ReactiveSwift - Part 1" /><meta property="og:locale" content="en" /><meta name="description" content="RAC 4.0发布以后发现，RAC进行了大量的更新，其中最主要的是使用了ReactiveSwift作为基础库，替换掉了以前OC版的库，RAC则是对于RAS和Cocoa框架的封装。" /><meta property="og:description" content="RAC 4.0发布以后发现，RAC进行了大量的更新，其中最主要的是使用了ReactiveSwift作为基础库，替换掉了以前OC版的库，RAC则是对于RAS和Cocoa框架的封装。" /><link rel="canonical" href="https://mioke.github.io/posts/Learning-ReactiveSwift-Part-1/" /><meta property="og:url" content="https://mioke.github.io/posts/Learning-ReactiveSwift-Part-1/" /><meta property="og:site_name" content="Klein Mioke" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-04-24T19:18:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Learning ReactiveSwift - Part 1" /><meta name="twitter:site" content="@Klein_Mioke" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-11-19T12:28:22+08:00","datePublished":"2017-04-24T19:18:00+08:00","description":"RAC 4.0发布以后发现，RAC进行了大量的更新，其中最主要的是使用了ReactiveSwift作为基础库，替换掉了以前OC版的库，RAC则是对于RAS和Cocoa框架的封装。","headline":"Learning ReactiveSwift - Part 1","mainEntityOfPage":{"@type":"WebPage","@id":"https://mioke.github.io/posts/Learning-ReactiveSwift-Part-1/"},"url":"https://mioke.github.io/posts/Learning-ReactiveSwift-Part-1/"}</script><title>Learning ReactiveSwift - Part 1 | Klein Mioke</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Klein Mioke"><meta name="application-name" content="Klein Mioke"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://github.com/Mioke/mioke.github.io/raw/master/assets/img/avatar/avatar.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Klein Mioke</a></div><div class="site-subtitle font-italic">Klein's Memory Castle</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Mioke" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/Klein_Mioke" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mioke0428','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } get isResolvedDarkMode() { if (this.isLightMode) { return false; } return this.isSysDarkPrefer; } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } updateCommentStyle() { var theme = "github-light"; if (this.isResolvedDarkMode) { theme = "photon-dark"; } let comment = document.querySelector("iframe.utterances-frame"); if (comment == null) { return; } comment.contentWindow.postMessage( { type: "set-theme", theme: theme }, "https://utteranc.es/" ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); this.updateCommentStyle(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Learning ReactiveSwift - Part 1</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Learning ReactiveSwift - Part 1</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Klein </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Apr 24, 2017, 7:18 PM +0800" >Apr 24, 2017<i class="unloaded">2017-04-24T19:18:00+08:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Nov 19, 2021, 12:28 PM +0800" >Nov 19, 2021<i class="unloaded">2021-11-19T12:28:22+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1925 words">10 min read</span></div></div><div class="post-content"><blockquote><p>RAC 4.0发布以后发现，RAC进行了大量的更新，其中最主要的是使用了ReactiveSwift作为基础库，替换掉了以前OC版的库，RAC则是对于RAS和Cocoa框架的封装。</p></blockquote><h2 id="入门">入门</h2><p>对于以前的RAC教程，理论部分大部分还是通用的，但是ReactiveSwift在某些方面进行了重构和修改，而且现有教程缺乏更新，不得已我们重头来梳理遍ReactiveSwift的入门教程。</p><p>ReactiveSwift的<a href="http://reactivecocoa.io/reactiveswift/docs/latest/">文档</a>是一篇不错的入门介绍，本文部分直接翻译自原文。</p><h2 id="什么是reactiveswift">什么是ReactiveSwift</h2><p>ReactiveSwift提供了可组合的、宣言式的、灵活的基元，用来构建<strong>数据流（streams of values）</strong>，这种形式是Reative Programming的重要表现之一。ReactiveSwift使用的是Functional Reactive Programming(FRP)，FRP是两种概念的结合，Reactive Programming和Functional Programming。</p><p>Reactive Programming是专注于监听异步数据流，并且可以作出相应反馈的一种编程方式。可以查看<a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754">这篇文章</a>的详细介绍。</p><p>Functional Programming强调使用数学模型的函数来计算，特点是不可变、而又表达明确清晰，最小化使用变量和状态。</p><h2 id="理解">理解</h2><p>先来看看ReactiveSwift的几个重要基元：Signal, SignalProducer, Event, Observer, Action. 当一个对象持有一个Signal，可以看做，一家电视台有在某个频道的电视节目，Signal就是这个频道（通道）。Event，可以看做是这个频道上的数据。Observer则是电视观众，他们订阅（subscribe或observe）了这个频道（signal)，则可以从频道中获取内容（events）。Action则是一种动作，对Signal产生影响，却不对Signal的持有者产生影响，就像：换台（sendInterrupt）。</p><p>而Signal和SignalProducer则是RAC更新中的一个变动，他俩的定义就像“冷、热信号”。在<strong>Rx</strong>和<strong>RAC 2.x</strong>以前他们是统一一起的。之所以分开，官方文档的解释是：</p><blockquote><p>… it is impossible to tell whether subscribing to (observing) that IObservable will involve side effects. If it does involve side effects, it’s also impossible to tell whether each subscription has a side effect, or if only the first one does.</p></blockquote><blockquote><p>This example is contrived, but it demonstrates a real, pervasive problem that makes it extremely hard to understand Rx code (and pre-3.0 ReactiveCocoa code) at a glance.</p></blockquote><blockquote><p>ReactiveSwift addresses this by distinguishing side effects with the separate Signal and SignalProducer types. Although this means there’s another type to learn about, it improves code clarity and helps communicate intent much better.</p></blockquote><blockquote><p>In other words, ReactiveSwift’s changes here are simple, not easy.</p></blockquote><p>简单来说，监听或订阅一个信号，可能会产生副作用，为了区分是否产生副作用，ReactiveSwift区分了两个类型。</p><h2 id="signal-vs-signalproducer">Signal vs. SignalProducer</h2><p>为了理解<code class="language-plaintext highlighter-rouge">Signal</code>和<code class="language-plaintext highlighter-rouge">SignalProducer</code>之间的区别，我门可以举一个传统电视节目和视频网站的例子。<code class="language-plaintext highlighter-rouge">Signal</code>的表现就像是电视节目一样，是一个连续的视频流和音频流。在一个固定的时间点，每个观众看到的电视节目内容都是一样的。观众既不能向电视节目内容内插入事件（副作用），也不能命令电视节目开始和结束。观众只能开始或停止接受电视节目内容。</p><p>另一方面，<code class="language-plaintext highlighter-rouge">SignalProducer</code>像是一个视频网站的视频流，就像 YouTube 一样。观众可以收到视频和音频的数据流，但是每个不一样的观众在同一时间点收到的内容是不一样的。同时观众可以主动开启和关闭他观看的视频。</p><p>因此，<code class="language-plaintext highlighter-rouge">Signal</code>s 通常是用来表示一个<code class="language-plaintext highlighter-rouge">正在进行中</code>的事件流，像是广播、用户输入等。另一方面，<code class="language-plaintext highlighter-rouge">SignalProducer</code>s 通常表示一个需要被主动开启的操作或者任务。例如网络请求，每一次调用<code class="language-plaintext highlighter-rouge">start</code>都会开启一个新的操作，。这个例子中如果使用了 <code class="language-plaintext highlighter-rouge">Signal</code>，结果是所有在网络请求响应回来之前，开始监听当前<code class="language-plaintext highlighter-rouge">Signal</code>的观察者，都会收到网络请求回调。</p><p>来源：</p><blockquote><p>To understand the difference between Signal and SignalProducer, let’s take the analogy of TV and on-demand streaming service. Signal behaves like a TV feed which is a continuous stream of video and audio. At a given point of time, every observer of the TV feed sees the same sequence of the frame. The observer neither can inject any side effect to TV feed, nor it can start or stop the feed. The observer can only start and stop receiving the feed. On the other hand, SignalProducer is like an on demand streaming service like YouTube. Here, the observer can receive a stream of video and audio, but the sequence of the stream is different for a different observer. Here the observer can start and stop the feed.</p></blockquote><blockquote><p>Therefore, Signals are generally used to represent event streams that are already “in progress,” such as notifications, user input, etc. SignalProducers, on the other hand, are used to represent operations or tasks which need to be started. For example, like network requests, where each invocation of start will create a new underlying operation. In the case of a Signal, the results might be sent before any observers are attached. In the case of a SignalProducer, the results are not sent unless it is started.</p></blockquote><h2 id="简单使用reactiveswift">简单使用ReactiveSwift</h2><blockquote><p>了解基础用法，其实可以下载ReactiveCocoa源码工程，在单元测试中可以找到API的各种用法。下面源码大部分取自单元测试代码。</p></blockquote><h3 id="signal">Signal</h3><figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// 使用一段代码（运行）</span>
<span class="k">let</span> <span class="nv">disposable</span> <span class="o">=</span> <span class="kt">SimpleDisposable</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">signal</span><span class="p">:</span> <span class="kt">Signal</span><span class="o">&lt;</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">NoError</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kt">Signal</span> <span class="p">{</span> <span class="n">observer</span> <span class="k">in</span>
    <span class="c1">// do something</span>
    <span class="k">return</span> <span class="n">disposable</span>
<span class="p">}</span>
<span class="n">signal</span><span class="o">.</span><span class="n">observe</span> <span class="p">{</span> <span class="n">event</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">event</span> <span class="p">{</span>
        <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">value</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
            <span class="c1">// do something</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">completed</span><span class="p">:</span>
            <span class="c1">// do completion</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 使用pipe()</span>
<span class="k">let</span> <span class="p">(</span><span class="nv">signal</span><span class="p">,</span> <span class="nv">observer</span><span class="p">)</span> <span class="o">=</span> <span class="kt">Signal</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">TestError</span><span class="o">&gt;.</span><span class="nf">pipe</span><span class="p">()</span>
<span class="c1">// 同样可使用observe</span>
<span class="n">signal</span><span class="o">.</span><span class="n">observe</span> <span class="p">{</span> <span class="n">event</span> <span class="k">in</span> 
    <span class="c1">// blabla</span>
<span class="p">}</span>
<span class="c1">// observer可以send events</span>
<span class="n">observer</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="s">"a string"</span><span class="p">)</span>
<span class="n">observer</span><span class="o">.</span><span class="nf">sendCompleted</span><span class="p">()</span></code></pre></figure><h3 id="signalproducer">SignalProducer</h3><p>SignalProducer是触发式的</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span text-data=" Swift "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">disposable</span><span class="p">:</span> <span class="kt">Disposable</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">producer</span> <span class="o">=</span> <span class="kt">SignalProducer</span><span class="o">&lt;</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">NoError</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">observer</span><span class="p">,</span> <span class="n">innerDisposable</span> <span class="k">in</span>
    <span class="n">disposable</span> <span class="o">=</span> <span class="n">innerDisposable</span>
    <span class="n">innerDisposable</span> <span class="o">+=</span> <span class="p">{</span>
        <span class="n">observer</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">observer</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">producer</span><span class="o">.</span><span class="n">startWithSignal</span> <span class="p">{</span> <span class="n">signal</span><span class="p">,</span> <span class="n">disposable</span> <span class="k">in</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">observeValues</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
<span class="n">disposable</span><span class="o">.</span><span class="nf">dispose</span><span class="p">()</span>

<span class="c1">// print:</span>
<span class="c1">// 0</span>
<span class="c1">// 1</span>
</pre></table></code></div></div><h3 id="disposable">Disposable</h3><p>看到上面SignalProducer和Signal的例子，用到<code class="language-plaintext highlighter-rouge">Disposable</code>的场景。Disposable是由协议<code class="language-plaintext highlighter-rouge">Disposable</code>描述的，拥有内存管理和取消机制一种对象。</p><p>当启动一个<code class="language-plaintext highlighter-rouge">Signal producer</code>，会返回一个disposable对象，这个对象可被用作取消被启动的工作，清理所有临时资源，然后发送一个<code class="language-plaintext highlighter-rouge">interrupted</code>事件（Event）给被创建的<code class="language-plaintext highlighter-rouge">Signal</code>。</p><p>监听（Observer）一个<code class="language-plaintext highlighter-rouge">Signal</code>也会返回一个disposable对象，用来使监听者停止从<code class="language-plaintext highlighter-rouge">Signal</code>接收<code class="language-plaintext highlighter-rouge">events</code>，但是不会对<code class="language-plaintext highlighter-rouge">Signal</code>产生影响。</p><h3 id="events">Events</h3><p>事件，描述一个发生的事情。在ReactiveSwift中，事件是通讯的核心部分。一些事件生成器可以通过<code class="language-plaintext highlighter-rouge">Signal</code>发送事件给注册的观察者们。</p><h3 id="unidirectional-binding">Unidirectional Binding</h3><p>单向绑定，通过一个数据源（BindingSource）绑定到一个目标（BindingTargetProvider）上。</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span text-data=" Swift "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">func</span> <span class="o">&lt;~&lt;</span><span class="kt">Provider</span><span class="p">,</span> <span class="kt">Source</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">provider</span><span class="p">:</span> <span class="kt">Provider</span><span class="p">,</span> <span class="nv">source</span><span class="p">:</span> <span class="kt">Source</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Disposable</span><span class="p">?</span> 
    <span class="k">where</span> <span class="kt">Provider</span> <span class="p">:</span> <span class="kt">BindingTargetProvider</span><span class="p">,</span> <span class="kt">Source</span> <span class="p">:</span> <span class="kt">BindingSource</span><span class="p">,</span> 
        <span class="kt">Source</span><span class="o">.</span><span class="kt">Error</span> <span class="o">==</span> <span class="kt">Result</span><span class="o">.</span><span class="kt">NoError</span><span class="p">,</span> 
        <span class="kt">Source</span><span class="o">.</span><span class="kt">Value</span> <span class="o">==</span> <span class="kt">Provider</span><span class="o">.</span><span class="kt">Value</span>
</pre></table></code></div></div><p>有定义可见，只要Source和Provider的Value是同一类型，就可以进行绑定。举个例子：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span text-data=" Swift "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
        
<span class="k">let</span> <span class="p">(</span><span class="nv">lifetime</span><span class="p">,</span> <span class="nv">_</span><span class="p">)</span> <span class="o">=</span> <span class="kt">Lifetime</span><span class="o">.</span><span class="nf">make</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">target</span> <span class="o">=</span> <span class="kt">BindingTarget</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">lifetime</span><span class="p">:</span> <span class="n">lifetime</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span> <span class="o">=</span> <span class="nv">$0</span> <span class="p">}</span>
<span class="k">let</span> <span class="nv">property</span> <span class="o">=</span> <span class="kt">MutableProperty</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
<span class="n">target</span> <span class="o">&lt;~</span> <span class="n">property</span>
<span class="c1">// value = 1</span>
<span class="n">property</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1">// value = 2</span>
</pre></table></code></div></div><blockquote><p>这例子是单元测试的例子，但是我自己试的时候value一直是nil…不知道那出了问题。</p></blockquote><h3 id="lifetime">Lifetime</h3><p>生命周期的监控，比如：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span text-data=" Swift "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">object</span> <span class="o">=</span> <span class="kt">MutableReference</span><span class="p">(</span><span class="kt">TestObject</span><span class="p">())</span>

<span class="k">var</span> <span class="nv">isEnded</span> <span class="o">=</span> <span class="kc">false</span>
<span class="k">var</span> <span class="nv">isCompleted</span> <span class="o">=</span> <span class="kc">false</span>

<span class="n">object</span><span class="o">.</span><span class="n">value</span><span class="o">!.</span><span class="n">ended</span><span class="o">.</span><span class="n">observeCompleted</span> <span class="p">{</span> <span class="n">isCompleted</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">}</span>
<span class="n">object</span><span class="o">.</span><span class="n">value</span><span class="o">!.</span><span class="n">lifetime</span><span class="o">.</span><span class="n">observeEnded</span> <span class="p">{</span> <span class="n">isEnded</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">}</span>
<span class="nf">expect</span><span class="p">(</span><span class="n">isCompleted</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span>
<span class="nf">expect</span><span class="p">(</span><span class="n">isEnded</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span>

<span class="n">object</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="nf">expect</span><span class="p">(</span><span class="n">isCompleted</span><span class="p">)</span> <span class="o">==</span> <span class="kc">true</span>
<span class="nf">expect</span><span class="p">(</span><span class="n">isEnded</span><span class="p">)</span> <span class="o">==</span> <span class="kc">true</span>
</pre></table></code></div></div><h2 id="take-a-break">Take a break</h2><p>这篇主要是讲一些ReactiveSwift的基础用法，下篇主要讲他的函数式部分，比如map、filter等。</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tech/'>Tech</a>, <a href='/categories/frp/'>FRP</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/swift/" class="post-tag no-text-decoration" >Swift</a> <a href="/tags/frp/" class="post-tag no-text-decoration" >FRP</a> <a href="/tags/reactiveswift/" class="post-tag no-text-decoration" >ReactiveSwift</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Learning ReactiveSwift - Part 1 - Klein Mioke&url=https://mioke.github.io/posts/Learning-ReactiveSwift-Part-1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Learning ReactiveSwift - Part 1 - Klein Mioke&u=https://mioke.github.io/posts/Learning-ReactiveSwift-Part-1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Learning ReactiveSwift - Part 1 - Klein Mioke&url=https://mioke.github.io/posts/Learning-ReactiveSwift-Part-1/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/How-to-make-macro-available-from-CocoaPods/">How to make Swift Macro available using CocoaPods</a><li><a href="/posts/Swift-Tips-(3)/">Swift Tips (3) - Protocol</a><li><a href="/posts/Talk-abould-the-politics/">When we talk about politics</a><li><a href="/posts/Why-we-struggled-using-navite-code-to-build-apps/">Why we struggled using native code to build apps</a><li><a href="/posts/Swift-Tips-(2)/">Swift Tips (2) - Standards</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/swift/">Swift</a> <a class="post-tag" href="/tags/frp/">FRP</a> <a class="post-tag" href="/tags/reactiveswift/">ReactiveSwift</a> <a class="post-tag" href="/tags/rxswift/">RxSwift</a> <a class="post-tag" href="/tags/view-points/">View Points</a> <a class="post-tag" href="/tags/codable/">Codable</a> <a class="post-tag" href="/tags/functional/">Functional</a> <a class="post-tag" href="/tags/pop/">POP</a> <a class="post-tag" href="/tags/rust/">Rust</a> <a class="post-tag" href="/tags/tech/">Tech</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Compare-between-RxSwift-and-ReactiveSwift/"><div class="card-body"> <span class="timeago small" >Nov 10, 2021<i class="unloaded">2021-11-10T18:32:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Compare between RxSwift and ReactiveSwift</h3><div class="text-muted small"><p> If you asking me which framework should we prefer to use now, my answer is RxSwift🙈. RxSwift 社区更为活跃，并且 RxSwift 实现的是 Rx 通用接口（加上一点点🤏语言特性功能），所以更容易找到文档或查找到相关讨论（包括目前 RxSwift 已经开始开发 concurrency 相关的 f...</p></div></div></a></div><div class="card"> <a href="/posts/Learning-ReactiveSwift-Part-2/"><div class="card-body"> <span class="timeago small" >Jul 4, 2017<i class="unloaded">2017-07-04T20:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Learning ReactiveSwift - Part 2</h3><div class="text-muted small"><p> 数据流 FRP之前一篇已经介绍过，是一种抽象的数据流型的编程思想。对于数据流，开始一个数据流后，会产生很多事件。在ReactiveSwift中，定义的事件有Event、Error。对应Observer则会有observe value、failed、complete、interrupted。 对于冷信号： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 1...</p></div></div></a></div><div class="card"> <a href="/posts/RxSwift%E5%9C%A8%E5%B7%A5%E7%A8%8B%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"><div class="card-body"> <span class="timeago small" >Jun 7, 2018<i class="unloaded">2018-06-07T15:08:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>RxSwift 在工程中的应用</h3><div class="text-muted small"><p> RxSwift在工程中的规范化应用 在工程中使用 RxSwif 和 RxCocoa 之后，遇到了不少问题，从这些问题中总结出了一些优化点和需要注意的地方，作为讨论和以后编码时的指导。 简化 Observable 功能 Observable 用来描述一个操作的流程，简单可以描述为：输入-&gt;执行-&gt;输出 * n-&gt;结束。对于一个 Observable 来说，他的执行部分代...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/POP-%E6%B3%9B%E5%9E%8B%E5%92%8C%E5%87%BD%E6%95%B0%E5%BC%8F%E6%80%9D%E6%83%B3%E5%9C%A8iOS%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/" class="btn btn-outline-primary" prompt="Older"><p>POP, 泛型和函数式思想在iOS中的应用</p></a> <a href="/posts/Learning-ReactiveSwift-Part-2/" class="btn btn-outline-primary" prompt="Newer"><p>Learning ReactiveSwift - Part 2</p></a></div><div class="utterances-container"> <script src="https://utteranc.es/client.js" repo="Mioke/mioke.github.io.comments" issue-term="pathname" theme="photon-dark" crossorigin="anonymous" async> </script></div><script type="text/javascript"> $(function() { window.onmessage = evt => { if (evt.origin === 'https://utteranc.es') { toggle.updateCommentStyle(); window.onmessage = null; } } }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/Mioke">Klein</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/swift/">Swift</a> <a class="post-tag" href="/tags/frp/">FRP</a> <a class="post-tag" href="/tags/reactiveswift/">ReactiveSwift</a> <a class="post-tag" href="/tags/rxswift/">RxSwift</a> <a class="post-tag" href="/tags/view-points/">View Points</a> <a class="post-tag" href="/tags/codable/">Codable</a> <a class="post-tag" href="/tags/functional/">Functional</a> <a class="post-tag" href="/tags/pop/">POP</a> <a class="post-tag" href="/tags/rust/">Rust</a> <a class="post-tag" href="/tags/tech/">Tech</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
