I"Ù<h2 id="mac-osä¸‹å®‰è£…åŠé…ç½®nginx">Mac OSä¸‹å®‰è£…åŠé…ç½®nginx</h2>

<h3 id="å®‰è£…åŒ…">å®‰è£…åŒ…</h3>
<ul>
  <li>
    <p>ä¸‹è½½ Nginx æºç åŒ…</p>

    <p>ä¸‹è½½é¡µ: http://nginx.org/en/download.html</p>

    <p>å½“å‰ç¨³å®šç‰ˆæœ¬: http://nginx.org/download/nginx-1.8.1.tar.gz</p>
  </li>
  <li>
    <p>zlib</p>

    <p>ä¸‹è½½é¡µ: http://zlib.net/</p>

    <p>å½“å‰ç¨³å®šç‰ˆæœ¬: http://zlib.net/zlib-1.2.8.tar.gz</p>

    <p>æ³¨: Nginx å‚è€ƒæ–‡æ¡£ä¸­æåˆ°éœ€è¦ 1.1.3 ä»¥ä¸Šç‰ˆæœ¬çš„ zlib</p>
  </li>
  <li>
    <p>pcre</p>

    <p>ä¸‹è½½é¡µ: http://www.pcre.org/</p>

    <p>å½“å‰ç¨³å®šç‰ˆæœ¬: ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.38.tar.gz</p>

    <p>æ³¨: Nginx å‚è€ƒæ–‡æ¡£ä¸­æåˆ°éœ€è¦ 4.4 ä»¥ä¸Šç‰ˆæœ¬çš„ pcre</p>
  </li>
</ul>

<h3 id="é…ç½®åŠå®‰è£…">é…ç½®åŠå®‰è£…</h3>

<ul>
  <li><strong>First, è¿›å…¥åˆ°åŒ…æ‰€åœ¨çš„æ–‡ä»¶å¤¹å†…</strong>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td> --><td class="rouge-code"><pre>tar zxvf zlib-1.2.8.tar.gz  # å¾—åˆ° zlib-1.2.8 ç›®å½•
tar zxvf pcre-8.36.tar.gz  # å¾—åˆ° pcre-8.36 ç›®å½•
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>ç¼–è¯‘å®‰è£… Nginx</p>

    <p>è¿™é‡Œä¼šå°†å„ä¾èµ–çš„æºç ç¼–è¯‘è¿› Nginx, æ‰€ä»¥ â€“with-zlib å’Œ â€“with-pcre åä¸ºå¯¹åº”çš„ä¾èµ–æºç ç›®å½•è·¯å¾„ã€‚æ­¤å¤–, ç¼–è¯‘é€‰é¡¹ä¸­è¿˜å¼€å¯äº† HTTPS çš„åè®®æ”¯æŒâ€“with-http_ssl_module, è‹¥ä¸éœ€è¦ HTTPS, å¯å–æ¶ˆè¯¥é€‰é¡¹ã€‚</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> --><td class="rouge-code"><pre>  tar zxvf nginx-1.8.0.tar.gz
  cd nginx-1.8.0
  ./configure --prefix=/usr/local/nginx --with-zlib=../zlib-1.2.8 --with-pcre=../pcre-8.36
  make
  sudo make install
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>å…¶ä»–å®‰è£…æŒ‡ä»¤ï¼ˆå¯åšäº†è§£ï¼‰
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td> --><td class="rouge-code"><pre>  nginxå¤§éƒ¨åˆ†å¸¸ç”¨æ¨¡å—ï¼Œç¼–è¯‘æ—¶./configure --helpä»¥--withoutå¼€å¤´çš„éƒ½é»˜è®¤å®‰è£…ã€‚
    
  --prefix=PATH ï¼š æŒ‡å®šnginxçš„å®‰è£…ç›®å½•ã€‚é»˜è®¤ /usr/local/nginx
  --conf-path=PATH ï¼š è®¾ç½®nginx.confé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚nginxå…è®¸ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œé€šè¿‡å‘½ä»¤è¡Œä¸­çš„-cé€‰é¡¹ã€‚é»˜è®¤ä¸ºprefix/conf/nginx.conf
  --user=nameï¼š è®¾ç½®nginxå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·ã€‚å®‰è£…å®Œæˆåï¼Œå¯ä»¥éšæ—¶åœ¨nginx.confé…ç½®æ–‡ä»¶æ›´æ”¹useræŒ‡ä»¤ã€‚é»˜è®¤çš„ç”¨æˆ·åæ˜¯nobodyã€‚--group=nameç±»ä¼¼
  --with-pcre ï¼š è®¾ç½®PCREåº“çš„æºç è·¯å¾„ï¼Œå¦‚æœå·²é€šè¿‡yumæ–¹å¼å®‰è£…ï¼Œä½¿ç”¨--with-pcreè‡ªåŠ¨æ‰¾åˆ°åº“æ–‡ä»¶ã€‚ä½¿ç”¨--with-pcre=PATHæ—¶ï¼Œéœ€è¦ä»PCREç½‘ç«™ä¸‹è½½pcreåº“çš„æºç ï¼ˆç‰ˆæœ¬4.4 - 8.30ï¼‰å¹¶è§£å‹ï¼Œå‰©ä¸‹çš„å°±äº¤ç»™Nginxçš„./configureå’Œmakeæ¥å®Œæˆã€‚perlæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨åœ¨locationæŒ‡ä»¤å’Œ ngx_http_rewrite_moduleæ¨¡å—ä¸­ã€‚
  --with-zlib=PATH ï¼š æŒ‡å®š zlibï¼ˆç‰ˆæœ¬1.1.3 - 1.2.5ï¼‰çš„æºç è§£å‹ç›®å½•ã€‚åœ¨é»˜è®¤å°±å¯ç”¨çš„ç½‘ç»œä¼ è¾“å‹ç¼©æ¨¡å—ngx_http_gzip_moduleæ—¶éœ€è¦ä½¿ç”¨zlib ã€‚
  --with-http_ssl_module ï¼š ä½¿ç”¨httpsåè®®æ¨¡å—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ¨¡å—æ²¡æœ‰è¢«æ„å»ºã€‚å‰ææ˜¯opensslä¸openssl-develå·²å®‰è£…
  --with-http_stub_status_module ï¼š ç”¨æ¥ç›‘æ§ Nginx çš„å½“å‰çŠ¶æ€
  --with-http_realip_module ï¼š é€šè¿‡è¿™ä¸ªæ¨¡å—å…è®¸æˆ‘ä»¬æ”¹å˜å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­å®¢æˆ·ç«¯IPåœ°å€å€¼(ä¾‹å¦‚X-Real-IP æˆ– X-Forwarded-For)ï¼Œæ„ä¹‰åœ¨äºèƒ½å¤Ÿä½¿å¾—åå°æœåŠ¡å™¨è®°å½•åŸå§‹å®¢æˆ·ç«¯çš„IPåœ°å€
  --add-module=PATH ï¼š æ·»åŠ ç¬¬ä¸‰æ–¹å¤–éƒ¨æ¨¡å—ï¼Œå¦‚nginx-sticky-module-ngæˆ–ç¼“å­˜æ¨¡å—ã€‚æ¯æ¬¡æ·»åŠ æ–°çš„æ¨¡å—éƒ½è¦é‡æ–°ç¼–è¯‘ï¼ˆTengineå¯ä»¥åœ¨æ–°åŠ å…¥moduleæ—¶æ— éœ€é‡æ–°ç¼–è¯‘ï¼‰
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <p>æ¯”å¦‚ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td> --><td class="rouge-code"><pre>  ./configure \
  &gt; --prefix=/usr \
  &gt; --sbin-path=/usr/sbin/nginx \
  &gt; --conf-path=/etc/nginx/nginx.conf \
  &gt; --error-log-path=/var/log/nginx/error.log \
  &gt; --http-log-path=/var/log/nginx/access.log \
  &gt; --pid-path=/var/run/nginx/nginx.pid  \
     &gt; --lock-path=/var/lock/nginx.lock \   
  &gt; --user=nginx \
  &gt; --group=nginx \
  &gt; --with-http_ssl_module \
  &gt; --with-http_stub_status_module \
  &gt; --with-http_gzip_static_module \
  &gt; --http-client-body-temp-path=/var/tmp/nginx/client/ \
  &gt; --http-proxy-temp-path=/var/tmp/nginx/proxy/ \
  &gt; --http-fastcgi-temp-path=/var/tmp/nginx/fcgi/ \
  &gt; --http-uwsgi-temp-path=/var/tmp/nginx/uwsgi \
  &gt; --with-pcre=../pcre-7.8
  &gt; --with-zlib=../zlib-1.2.3
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ul>

<h3 id="è®¾ç½®ç›‘å¬">è®¾ç½®ç›‘å¬</h3>

<p>è¿›å…¥é…ç½®æ–‡ä»¶/usr/local/nginx/conf/nginx.conf ï¼Œä¿®æ”¹listenä¸‹å‚æ•°ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td> --><td class="rouge-code"><pre>server {
        listen       85;            #ç›‘å¬ç«¯å£
        server_name  localhost;     #ç›‘å¬æœåŠ¡å™¨

        #charset koi8-r;
        #access_log  logs/host.access.log  main;
        location / {
            root   html;
            index  index.html index.htm;
        }

        #error_page  404              /404.html;
        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="å¯åŠ¨nginx">å¯åŠ¨nginx</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td> --><td class="rouge-code"><pre>cd /usr/local/nginx

#å¯åŠ¨
sudo sbin/nginx     #æµè§ˆå™¨è®¿é—® 127.0.0.1 æµ‹è¯•æ˜¯å¦æˆåŠŸå¯åŠ¨

#é‡å¯
sudo sbin/nginx -s reload

#åœæ­¢
sudo sbin/nginx -s stop
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="ä¿®æ”¹è¿”å›å€¼">ä¿®æ”¹è¿”å›å€¼</h3>

<p>ä»¥bandwidthè¯·æ±‚ï¼š</p>

<p>http://127.0.0.1:8001/v2/bandwidth</p>

<p>æŒ‰ç…§è¯·æ±‚çš„æ ¼å¼åˆ›å»ºç›®å½•ä¸ºï¼š/usr/local/nginx/html/v2/ <br />
ï¼ˆ/usr/local/nginx/html/ä¸ºé»˜è®¤ç›®å½•,/v2/ä¸ºæ ¹æ®è¯·æ±‚æ ¼å¼æ–°å»ºçš„ç›®å½•ï¼‰</p>

<p>æ–°å»ºbandwidthæ–‡ä»¶ï¼Œåˆ™æ–‡ä»¶è·¯å¾„ä¸º/usr/local/nginx/html/v2/bandwidthï¼Œå†™å…¥è¿”å›å€¼ï¼Œåˆ™æ„é€ æŒ‡å®šè¿”å›æŠ¥æ–‡æˆåŠŸï¼Œå¯æŒ‰ç…§è‡ªå·±éœ€æ±‚è¿›è¡Œç¼–è¾‘ï¼›</p>

<p>ç„¶ååœ¨æµè§ˆå™¨ä¸­è¯·æ±‚è¿™ä¸ªæ¥å£ï¼Œè¿”å›è‡ªå®šä¹‰çš„å†…å®¹åˆ™é…ç½®æˆåŠŸã€‚</p>
:ET