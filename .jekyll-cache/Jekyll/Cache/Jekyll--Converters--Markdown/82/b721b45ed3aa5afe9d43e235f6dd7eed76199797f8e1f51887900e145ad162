I"¤G<h3 id="å‡½æ•°çš„æŸ¯é‡ŒåŒ–">å‡½æ•°çš„æŸ¯é‡ŒåŒ–</h3>

<p>Swift é‡Œå¯ä»¥å°†æ–¹æ³•è¿›è¡ŒæŸ¯é‡ŒåŒ– (Currying)ï¼Œè¿™æ˜¯ä¹Ÿå°±æ˜¯æŠŠæ¥å—å¤šä¸ªå‚æ•°çš„æ–¹æ³•è¿›è¡Œä¸€äº›å˜å½¢ï¼Œä½¿å…¶æ›´åŠ çµæ´»çš„æ–¹æ³•ã€‚</p>

<p>åœ¨éå‡½æ•°å¼çš„ä»£ç æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·å†™ä¸€ä¸ªæ–¹æ³•ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">isNumber</span><span class="p">(</span><span class="n">_</span> <span class="nv">base</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="n">greaterThan</span> <span class="nv">target</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">base</span> <span class="o">&gt;</span> <span class="n">target</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>åŒæ ·çš„åŠŸèƒ½å¦‚æœä½¿ç”¨æŸ¯é‡ŒåŒ–çš„å‡½æ•°ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">greaterThan</span><span class="p">(</span><span class="nv">comparer</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">&gt;</span> <span class="n">comparer</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">greaterThan10</span> <span class="o">=</span> <span class="nf">greaterThan</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="nf">greaterThan10</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>    <span class="c1">// =&gt; true</span>
<span class="nf">greaterThan10</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>     <span class="c1">// =&gt; false</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§é‡äº§ç›¸ä¼¼æ–¹æ³•çš„å¥½åŠæ³•ã€‚</p>

<h3 id="ä½¿ç”¨å‡½æ•°å½“åšå¯¹è±¡">ä½¿ç”¨å‡½æ•°å½“åšå¯¹è±¡</h3>

<p>æˆ‘ä»¬å¯ä»¥ç»“åˆå‡½æ•°å®ç°è¯¸å¤šç®€ä¾¿çš„åŠŸèƒ½ï¼Œåœ¨ Swift ä¸­ï¼Œå‡½æ•°ä¹Ÿæ˜¯<code class="language-plaintext highlighter-rouge">ä¸€ç­‰å…¬æ°‘</code>ï¼Œåˆ©ç”¨å‡½æ•°æœ¬èº«çš„ç‰¹ç‚¹ï¼Œå¯ä»¥æ›´é«˜æ•ˆçš„ç»„åˆå‡ºæƒ³è¦çš„åŠŸèƒ½ã€‚</p>

<p>ä¸¾ä¾‹ï¼šæˆ‘ä»¬å¯ä»¥ç»™<code class="language-plaintext highlighter-rouge">Array&lt;Element&gt;</code>æ·»åŠ æ–¹æ³•ï¼Œè·å–ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">contains</code>çš„<code class="language-plaintext highlighter-rouge">(Element) -&gt; Bool</code>çš„ç±»å‹çš„å‡½æ•°è¾“å‡ºã€‚</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="kd">extension</span> <span class="kt">Array</span> <span class="k">where</span> <span class="kt">Element</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">func</span> <span class="n">contains</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">Equatable</span><span class="o">&gt;</span><span class="p">(</span><span class="k">in</span> <span class="nv">array</span><span class="p">:</span> <span class="p">[</span><span class="kt">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span> <span class="n">obj</span> <span class="k">in</span>
            <span class="nf">return</span> <span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">==</span> <span class="n">obj</span> <span class="p">})</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">func</span> <span class="n">notContains</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">Equatable</span><span class="o">&gt;</span><span class="p">(</span><span class="k">in</span> <span class="nv">array</span><span class="p">:</span> <span class="p">[</span><span class="kt">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span> <span class="n">obj</span> <span class="k">in</span>
            <span class="k">return</span> <span class="o">!</span><span class="nf">contains</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">array</span><span class="p">)(</span><span class="n">obj</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">intersection</span><span class="p">(</span><span class="n">with</span> <span class="nv">other</span><span class="p">:</span> <span class="p">[</span><span class="kt">Element</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">Element</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Array</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">other</span><span class="p">))</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">union</span><span class="p">(</span><span class="n">with</span> <span class="nv">other</span><span class="p">:</span> <span class="p">[</span><span class="kt">Element</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">Element</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="nf">minus</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">minus</span><span class="p">(</span><span class="n">with</span> <span class="nv">other</span><span class="p">:</span> <span class="p">[</span><span class="kt">Element</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">Element</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="kt">Array</span><span class="o">.</span><span class="nf">notContains</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">other</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">contains</span> <span class="o">=</span> <span class="kt">Array</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="nf">contains</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="o">==&gt;</span>  <span class="kc">true</span>
<span class="nf">contains</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="o">==&gt;</span>  <span class="kc">false</span>

<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="nf">intersection</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>  <span class="o">==&gt;</span>  <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="nf">minus</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>  <span class="o">==&gt;</span>  <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="nf">union</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  <span class="o">==&gt;</span>  <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>å¯¹äºä»»ä½•å®ç°äº†<code class="language-plaintext highlighter-rouge">Equatable</code>çš„å¯¹è±¡é›†åˆï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•åšè¿ç®—ã€‚</p>

<h3 id="tuple-å…ƒç»„">Tuple å…ƒç»„</h3>

<p>Tuple æ˜¯ Swift å¸¦ç»™æˆ‘ä»¬çš„æ–°åŠŸèƒ½ï¼Œåœ¨æ™®é€šåœºæ™¯ä¸‹ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸»è¦æœ‰ä¸¤ç‚¹åŠŸèƒ½ï¼š</p>

<ul>
  <li>æ ‡æ˜å«ä¹‰ï¼šè‡ªå·±æˆ–å…¶ä»–å°ä¼™ä¼´åœ¨æ¥æ”¶åˆ°è¿™ä¸ªå‚æ•°æ—¶ï¼Œå¾ˆå®¹æ˜“æ ¹æ®å‚æ•°æ ‡è¯†æ¥åˆ†è¾¨å…ƒç»„å†…çš„å±æ€§å«ä¹‰ã€‚</li>
</ul>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">switch</span> <span class="kd">some</span> <span class="p">{</span>
	<span class="k">case</span> <span class="k">let</span> <span class="nv">x</span><span class="p">:</span>
		<span class="n">x</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="o">...</span>
		<span class="n">x</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="o">...</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>å‡½æ•°çš„å¤šç»“æœè¾“å‡ºï¼šå½“ä¸€ä¸ªå‡½æ•°æƒ³è¾“å‡ºå¤šä¸ªæ•°æ®ï¼Œè€Œæ•°æ®ä¹‹é—´æ¯«æ— å…³è”ï¼Œä¸èƒ½ç»“åˆæˆä¸€ä¸ªå¯¹è±¡ï¼›æˆ–ä¿¡æ¯å¤ªå°‘ä¸è‡³äºç”¨å¯¹è±¡ä»£æ›¿æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šå…ƒç»„å½“åšå‡½æ•°çš„è¾“å‡ºã€‚è¿™ç‚¹è·ŸGoè¯­è¨€çš„å‡½æ•°å¤šè¿”å›å€¼æ€æƒ³å¾ˆåƒã€‚</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>func requestCargoInfo(from url: URL) -&gt; (name: String, destination: String) { ... }
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="autoclosure">@autoclosure</h3>

<p>@autoclosure å¯ä»¥è¯´æ˜¯ Apple çš„ä¸€ä¸ªéå¸¸ç¥å¥‡çš„åˆ›é€ ï¼Œå› ä¸ºè¿™æ›´å¤šåœ°æ˜¯åƒåœ¨ â€œhackâ€ è¿™é—¨è¯­è¨€ã€‚ç®€å•è¯´ï¼Œ@autoclosure åšçš„äº‹æƒ…å°±æ˜¯æŠŠä¸€å¥è¡¨è¾¾å¼è‡ªåŠ¨åœ°å°è£…æˆä¸€ä¸ªé—­åŒ… (closure)ã€‚è¿™æ ·æœ‰æ—¶å€™åœ¨è¯­æ³•ä¸Šçœ‹èµ·æ¥å°±ä¼šéå¸¸æ¼‚äº®ã€‚</p>

<p>æ¯”å¦‚ç³»ç»Ÿçš„ precondition å‡½æ•°ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ªç›¸ä¼¼åŠŸèƒ½çš„ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">precondition</span><span class="p">(</span><span class="n">_</span> <span class="nv">condition</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Bool</span><span class="p">,</span> <span class="n">_</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span> <span class="o">...</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="nf">precondition</span><span class="p">({</span> <span class="k">return</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">},</span> <span class="s">"true"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ä½†æ˜¯ä½¿ç”¨<code class="language-plaintext highlighter-rouge">@autoclosure</code>ä¹‹åï¼Œå¦‚ç³»ç»Ÿçš„ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">func</span> <span class="nf">precondition</span><span class="p">(</span><span class="n">_</span> <span class="nv">condition</span><span class="p">:</span> <span class="kd">@autoclosure</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Bool</span><span class="p">,</span> <span class="n">_</span> <span class="nv">message</span><span class="p">:</span> <span class="kd">@autoclosure</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="o">=</span> <span class="k">default</span><span class="p">,</span> 
	<span class="nv">file</span><span class="p">:</span> <span class="kt">StaticString</span> <span class="o">=</span> <span class="kd">#file</span><span class="p">,</span> <span class="nv">line</span><span class="p">:</span> <span class="kt">UInt</span> <span class="o">=</span> <span class="kd">#line</span><span class="p">)</span>

<span class="c1">// æˆ‘ä»¬å°±å¯ä»¥æ›´ç®€æ´çš„ä½¿ç”¨ï¼š</span>
<span class="nf">precondition</span><span class="p">(</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"true"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å¦ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œåœ¨ Vapor æºç ä¸­ï¼Œä¸ºäº†é¿å…è¿‡åº¦ä½¿ç”¨èµ„æºã€è€—è´¹æ€§èƒ½ï¼Œé€šå¸¸æ˜¯ç¡®å®šæŸä¸ªæ¡ä»¶ä¹‹åå†ä½¿ç”¨æŸä¸ªå±æ€§ã€‚æ¯”å¦‚è¿™æ®µä»£ç ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">func</span> <span class="nf">unwrap</span><span class="p">(</span><span class="n">or</span> <span class="nv">error</span><span class="p">:</span> <span class="kd">@autoclosure</span> <span class="kd">@escaping</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">Expectation</span><span class="o">.</span><span class="kt">WrappedType</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">map</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">Expectation</span><span class="o">.</span><span class="kt">WrappedType</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="kd">optional</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">wrapped</span> <span class="o">=</span> <span class="kd">optional</span><span class="o">.</span><span class="n">wrapped</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nf">error</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">wrapped</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿™é‡Œ Error æ˜¯åœ¨ optional ç¡®å®šä¸ä¸º nil ä¹‹åå†ç”Ÿæˆçš„ã€‚æœ€åè¦æä¸€å¥çš„æ˜¯ï¼Œ@autoclosure å¹¶ä¸æ”¯æŒå¸¦æœ‰è¾“å…¥å‚æ•°çš„å†™æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰å½¢å¦‚ () -&gt; T çš„å‚æ•°æ‰èƒ½ä½¿ç”¨è¿™ä¸ªç‰¹æ€§è¿›è¡Œç®€åŒ–ã€‚</p>

<hr />

:ET