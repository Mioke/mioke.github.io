I"Ô7<blockquote>
  <p>RAC 4.0å‘å¸ƒä»¥åå‘ç°ï¼ŒRACè¿›è¡Œäº†å¤§é‡çš„æ›´æ–°ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„æ˜¯ä½¿ç”¨äº†ReactiveSwiftä½œä¸ºåŸºç¡€åº“ï¼Œæ›¿æ¢æ‰äº†ä»¥å‰OCç‰ˆçš„åº“ï¼ŒRACåˆ™æ˜¯å¯¹äºRASå’ŒCocoaæ¡†æ¶çš„å°è£…ã€‚</p>
</blockquote>

<h2 id="å…¥é—¨">å…¥é—¨</h2>
<p>å¯¹äºä»¥å‰çš„RACæ•™ç¨‹ï¼Œç†è®ºéƒ¨åˆ†å¤§éƒ¨åˆ†è¿˜æ˜¯é€šç”¨çš„ï¼Œä½†æ˜¯ReactiveSwiftåœ¨æŸäº›æ–¹é¢è¿›è¡Œäº†é‡æ„å’Œä¿®æ”¹ï¼Œè€Œä¸”ç°æœ‰æ•™ç¨‹ç¼ºä¹æ›´æ–°ï¼Œä¸å¾—å·²æˆ‘ä»¬é‡å¤´æ¥æ¢³ç†éReactiveSwiftçš„å…¥é—¨æ•™ç¨‹ã€‚</p>

<p>ReactiveSwiftçš„<a href="http://reactivecocoa.io/reactiveswift/docs/latest/">æ–‡æ¡£</a>æ˜¯ä¸€ç¯‡ä¸é”™çš„å…¥é—¨ä»‹ç»ï¼Œæœ¬æ–‡éƒ¨åˆ†ç›´æ¥ç¿»è¯‘è‡ªåŸæ–‡ã€‚</p>

<h2 id="ä»€ä¹ˆæ˜¯reactiveswift">ä»€ä¹ˆæ˜¯ReactiveSwift</h2>
<p>ReactiveSwiftæä¾›äº†å¯ç»„åˆçš„ã€å®£è¨€å¼çš„ã€çµæ´»çš„åŸºå…ƒï¼Œç”¨æ¥æ„å»º<strong>æ•°æ®æµï¼ˆstreams of valuesï¼‰</strong>ï¼Œè¿™ç§å½¢å¼æ˜¯Reative Programmingçš„é‡è¦è¡¨ç°ä¹‹ä¸€ã€‚ReactiveSwiftä½¿ç”¨çš„æ˜¯Functional Reactive Programming(FRP)ï¼ŒFRPæ˜¯ä¸¤ç§æ¦‚å¿µçš„ç»“åˆï¼ŒReactive Programmingå’ŒFunctional Programmingã€‚</p>

<p>Reactive Programmingæ˜¯ä¸“æ³¨äºç›‘å¬å¼‚æ­¥æ•°æ®æµï¼Œå¹¶ä¸”å¯ä»¥ä½œå‡ºç›¸åº”åé¦ˆçš„ä¸€ç§ç¼–ç¨‹æ–¹å¼ã€‚å¯ä»¥æŸ¥çœ‹<a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754">è¿™ç¯‡æ–‡ç« </a>çš„è¯¦ç»†ä»‹ç»ã€‚</p>

<p>Functional Programmingå¼ºè°ƒä½¿ç”¨æ•°å­¦æ¨¡å‹çš„å‡½æ•°æ¥è®¡ç®—ï¼Œç‰¹ç‚¹æ˜¯ä¸å¯å˜ã€è€Œåˆè¡¨è¾¾æ˜ç¡®æ¸…æ™°ï¼Œæœ€å°åŒ–ä½¿ç”¨å˜é‡å’ŒçŠ¶æ€ã€‚</p>

<h2 id="ç†è§£">ç†è§£</h2>
<p>å…ˆæ¥çœ‹çœ‹ReactiveSwiftçš„å‡ ä¸ªé‡è¦åŸºå…ƒï¼šSignal, SignalProducer, Event, Observer, Action.
å½“ä¸€ä¸ªå¯¹è±¡æŒæœ‰ä¸€ä¸ªSignalï¼Œå¯ä»¥çœ‹åšï¼Œä¸€å®¶ç”µè§†å°æœ‰åœ¨æŸä¸ªé¢‘é“çš„ç”µè§†èŠ‚ç›®ï¼ŒSignalå°±æ˜¯è¿™ä¸ªé¢‘é“ï¼ˆé€šé“ï¼‰ã€‚Eventï¼Œå¯ä»¥çœ‹åšæ˜¯è¿™ä¸ªé¢‘é“ä¸Šçš„æ•°æ®ã€‚Observeråˆ™æ˜¯ç”µè§†è§‚ä¼—ï¼Œä»–ä»¬è®¢é˜…ï¼ˆsubscribeæˆ–observeï¼‰äº†è¿™ä¸ªé¢‘é“ï¼ˆsignal)ï¼Œåˆ™å¯ä»¥ä»é¢‘é“ä¸­è·å–å†…å®¹ï¼ˆeventsï¼‰ã€‚Actionåˆ™æ˜¯ä¸€ç§åŠ¨ä½œï¼Œå¯¹Signaläº§ç”Ÿå½±å“ï¼Œå´ä¸å¯¹Signalçš„æŒæœ‰è€…äº§ç”Ÿå½±å“ï¼Œå°±åƒï¼šæ¢å°ï¼ˆsendInterruptï¼‰ã€‚</p>

<p>è€ŒSignalå’ŒSignalProduceråˆ™æ˜¯RACæ›´æ–°ä¸­çš„ä¸€ä¸ªå˜åŠ¨ï¼Œä»–ä¿©çš„å®šä¹‰å°±åƒâ€œå†·ã€çƒ­ä¿¡å·â€ã€‚åœ¨<strong>Rx</strong>å’Œ<strong>RAC 2.x</strong>ä»¥å‰ä»–ä»¬æ˜¯ç»Ÿä¸€ä¸€èµ·çš„ã€‚ä¹‹æ‰€ä»¥åˆ†å¼€ï¼Œå®˜æ–¹æ–‡æ¡£çš„è§£é‡Šæ˜¯ï¼š</p>
<blockquote>
  <p>â€¦ it is impossible to tell whether subscribing to (observing) that IObservable will involve side effects. If it does involve side effects, itâ€™s also impossible to tell whether each subscription has a side effect, or if only the first one does.</p>
</blockquote>

<blockquote>
  <p>This example is contrived, but it demonstrates a real, pervasive problem that makes it extremely hard to understand Rx code (and pre-3.0 ReactiveCocoa code) at a glance.</p>
</blockquote>

<blockquote>
  <p>ReactiveSwift addresses this by distinguishing side effects with the separate Signal and SignalProducer types. Although this means thereâ€™s another type to learn about, it improves code clarity and helps communicate intent much better.</p>
</blockquote>

<blockquote>
  <p>In other words, ReactiveSwiftâ€™s changes here are simple, not easy.</p>
</blockquote>

<p>ç®€å•æ¥è¯´ï¼Œç›‘å¬æˆ–è®¢é˜…ä¸€ä¸ªä¿¡å·ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œä¸ºäº†åŒºåˆ†æ˜¯å¦äº§ç”Ÿå‰¯ä½œç”¨ï¼ŒReactiveSwiftåŒºåˆ†äº†ä¸¤ä¸ªç±»å‹ã€‚</p>

<h2 id="ç®€å•ä½¿ç”¨reactiveswift">ç®€å•ä½¿ç”¨ReactiveSwift</h2>

<blockquote>
  <p>äº†è§£åŸºç¡€ç”¨æ³•ï¼Œå…¶å®å¯ä»¥ä¸‹è½½ReactiveCocoaæºç å·¥ç¨‹ï¼Œåœ¨å•å…ƒæµ‹è¯•ä¸­å¯ä»¥æ‰¾åˆ°APIçš„å„ç§ç”¨æ³•ã€‚ä¸‹é¢æºç å¤§éƒ¨åˆ†å–è‡ªå•å…ƒæµ‹è¯•ä»£ç ã€‚</p>
</blockquote>

<h3 id="signal">Signal</h3>

<p>{% highlight swift %}
// ä½¿ç”¨ä¸€æ®µä»£ç ï¼ˆè¿è¡Œï¼‰
let disposable = SimpleDisposable()
let signal: Signal&lt;Int, NoError&gt; = Signal { observer in
    // do something
    return disposable
}
signal.observe { event in
    switch event {
        case let .value(number):
            // do something
        case .completed:
            // do completion
        default:
            break
    }
}</p>

<p>// ä½¿ç”¨pipe()
let (signal, observer) = Signal&lt;String, TestError&gt;.pipe()
// åŒæ ·å¯ä½¿ç”¨observe
signal.observe { event in 
    // blabla
}
// observerå¯ä»¥send events
observer.send(value: â€œa stringâ€)
observer.sendCompleted()
{% endhighlight %}</p>

<h3 id="signalproducer">SignalProducer</h3>
<p>SignalProduceræ˜¯è§¦å‘å¼çš„</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">disposable</span><span class="p">:</span> <span class="kt">Disposable</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">producer</span> <span class="o">=</span> <span class="kt">SignalProducer</span><span class="o">&lt;</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">NoError</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">observer</span><span class="p">,</span> <span class="n">innerDisposable</span> <span class="k">in</span>
    <span class="n">disposable</span> <span class="o">=</span> <span class="n">innerDisposable</span>
    <span class="n">innerDisposable</span> <span class="o">+=</span> <span class="p">{</span>
        <span class="n">observer</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">observer</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">producer</span><span class="o">.</span><span class="n">startWithSignal</span> <span class="p">{</span> <span class="n">signal</span><span class="p">,</span> <span class="n">disposable</span> <span class="k">in</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">observeValues</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
<span class="n">disposable</span><span class="o">.</span><span class="nf">dispose</span><span class="p">()</span>

<span class="c1">// print:</span>
<span class="c1">// 0</span>
<span class="c1">// 1</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="disposable">Disposable</h3>
<p>çœ‹åˆ°ä¸Šé¢SignalProducerå’ŒSignalçš„ä¾‹å­ï¼Œç”¨åˆ°<code class="language-plaintext highlighter-rouge">Disposable</code>çš„åœºæ™¯ã€‚Disposableæ˜¯ç”±åè®®<code class="language-plaintext highlighter-rouge">Disposable</code>æè¿°çš„ï¼Œæ‹¥æœ‰å†…å­˜ç®¡ç†å’Œå–æ¶ˆæœºåˆ¶ä¸€ç§å¯¹è±¡ã€‚</p>

<p>å½“å¯åŠ¨ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">Signal producer</code>ï¼Œä¼šè¿”å›ä¸€ä¸ªdisposableå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯è¢«ç”¨ä½œå–æ¶ˆè¢«å¯åŠ¨çš„å·¥ä½œï¼Œæ¸…ç†æ‰€æœ‰ä¸´æ—¶èµ„æºï¼Œç„¶åå‘é€ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">interrupted</code>äº‹ä»¶ï¼ˆEventï¼‰ç»™è¢«åˆ›å»ºçš„<code class="language-plaintext highlighter-rouge">Signal</code>ã€‚</p>

<p>ç›‘å¬ï¼ˆObserverï¼‰ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">Signal</code>ä¹Ÿä¼šè¿”å›ä¸€ä¸ªdisposableå¯¹è±¡ï¼Œç”¨æ¥ä½¿ç›‘å¬è€…åœæ­¢ä»<code class="language-plaintext highlighter-rouge">Signal</code>æ¥æ”¶<code class="language-plaintext highlighter-rouge">events</code>ï¼Œä½†æ˜¯ä¸ä¼šå¯¹<code class="language-plaintext highlighter-rouge">Signal</code>äº§ç”Ÿå½±å“ã€‚</p>

<h3 id="events">Events</h3>
<p>äº‹ä»¶ï¼Œæè¿°ä¸€ä¸ªå‘ç”Ÿçš„äº‹æƒ…ã€‚åœ¨ReactiveSwiftä¸­ï¼Œäº‹ä»¶æ˜¯é€šè®¯çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ä¸€äº›äº‹ä»¶ç”Ÿæˆå™¨å¯ä»¥é€šè¿‡<code class="language-plaintext highlighter-rouge">Signal</code>å‘é€äº‹ä»¶ç»™æ³¨å†Œçš„è§‚å¯Ÿè€…ä»¬ã€‚</p>

<h3 id="unidirectional-binding">Unidirectional Binding</h3>
<p>å•å‘ç»‘å®šï¼Œé€šè¿‡ä¸€ä¸ªæ•°æ®æºï¼ˆBindingSourceï¼‰ç»‘å®šåˆ°ä¸€ä¸ªç›®æ ‡ï¼ˆBindingTargetProviderï¼‰ä¸Šã€‚</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">func</span> <span class="o">&lt;~&lt;</span><span class="kt">Provider</span><span class="p">,</span> <span class="kt">Source</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">provider</span><span class="p">:</span> <span class="kt">Provider</span><span class="p">,</span> <span class="nv">source</span><span class="p">:</span> <span class="kt">Source</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Disposable</span><span class="p">?</span> 
    <span class="k">where</span> <span class="kt">Provider</span> <span class="p">:</span> <span class="kt">BindingTargetProvider</span><span class="p">,</span> <span class="kt">Source</span> <span class="p">:</span> <span class="kt">BindingSource</span><span class="p">,</span> 
        <span class="kt">Source</span><span class="o">.</span><span class="kt">Error</span> <span class="o">==</span> <span class="kt">Result</span><span class="o">.</span><span class="kt">NoError</span><span class="p">,</span> 
        <span class="kt">Source</span><span class="o">.</span><span class="kt">Value</span> <span class="o">==</span> <span class="kt">Provider</span><span class="o">.</span><span class="kt">Value</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>æœ‰å®šä¹‰å¯è§ï¼Œåªè¦Sourceå’ŒProviderçš„Valueæ˜¯åŒä¸€ç±»å‹ï¼Œå°±å¯ä»¥è¿›è¡Œç»‘å®šã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">var</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
        
<span class="k">let</span> <span class="p">(</span><span class="nv">lifetime</span><span class="p">,</span> <span class="nv">_</span><span class="p">)</span> <span class="o">=</span> <span class="kt">Lifetime</span><span class="o">.</span><span class="nf">make</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">target</span> <span class="o">=</span> <span class="kt">BindingTarget</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">lifetime</span><span class="p">:</span> <span class="n">lifetime</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span> <span class="o">=</span> <span class="nv">$0</span> <span class="p">}</span>
<span class="k">let</span> <span class="nv">property</span> <span class="o">=</span> <span class="kt">MutableProperty</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
<span class="n">target</span> <span class="o">&lt;~</span> <span class="n">property</span>
<span class="c1">// value = 1</span>
<span class="n">property</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1">// value = 2</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>è¿™ä¾‹å­æ˜¯å•å…ƒæµ‹è¯•çš„ä¾‹å­ï¼Œä½†æ˜¯æˆ‘è‡ªå·±è¯•çš„æ—¶å€™valueä¸€ç›´æ˜¯nilâ€¦ä¸çŸ¥é“é‚£å‡ºäº†é—®é¢˜ã€‚</p>
</blockquote>

<h3 id="lifetime">Lifetime</h3>
<p>ç”Ÿå‘½å‘¨æœŸçš„ç›‘æ§ï¼Œæ¯”å¦‚ï¼š</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">object</span> <span class="o">=</span> <span class="kt">MutableReference</span><span class="p">(</span><span class="kt">TestObject</span><span class="p">())</span>

<span class="k">var</span> <span class="nv">isEnded</span> <span class="o">=</span> <span class="kc">false</span>
<span class="k">var</span> <span class="nv">isCompleted</span> <span class="o">=</span> <span class="kc">false</span>

<span class="n">object</span><span class="o">.</span><span class="n">value</span><span class="o">!.</span><span class="n">ended</span><span class="o">.</span><span class="n">observeCompleted</span> <span class="p">{</span> <span class="n">isCompleted</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">}</span>
<span class="n">object</span><span class="o">.</span><span class="n">value</span><span class="o">!.</span><span class="n">lifetime</span><span class="o">.</span><span class="n">observeEnded</span> <span class="p">{</span> <span class="n">isEnded</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">}</span>
<span class="nf">expect</span><span class="p">(</span><span class="n">isCompleted</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span>
<span class="nf">expect</span><span class="p">(</span><span class="n">isEnded</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span>

<span class="n">object</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="nf">expect</span><span class="p">(</span><span class="n">isCompleted</span><span class="p">)</span> <span class="o">==</span> <span class="kc">true</span>
<span class="nf">expect</span><span class="p">(</span><span class="n">isEnded</span><span class="p">)</span> <span class="o">==</span> <span class="kc">true</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="take-a-break">Take a break</h2>
<p>è¿™ç¯‡ä¸»è¦æ˜¯è®²ä¸€äº›ReactiveSwiftçš„åŸºç¡€ç”¨æ³•ï¼Œä¸‹ç¯‡ä¸»è¦è®²ä»–çš„å‡½æ•°å¼éƒ¨åˆ†ï¼Œæ¯”å¦‚mapã€filterç­‰ã€‚</p>
:ET