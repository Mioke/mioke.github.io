<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Klein No Heya by </title>

    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Klein No Heya</h1>
        <p>A private blog for recording thoughts, tech, etc.
</p>

        

        

        
      </header>
      <section>

      <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

 <!--  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Nginx Depoloyment On Mac Os</h1>
    <p class="post-meta"><time datetime="2017-03-22T00:00:00+08:00" itemprop="datePublished">Mar 22, 2017</time></p>
  </header> -->

  <div class="post-content" itemprop="articleBody">
    <h1 class="post-title">Nginx Depoloyment On Mac Os</h1>
    <p class="post-meta"><time datetime="2017-03-22T00:00:00+08:00" itemprop="datePublished">Mar 22, 2017</time></p>
    <br>

    <h2 id="mac-os下安装及配置nginx">Mac OS下安装及配置nginx</h2>

<h3 id="安装包">安装包</h3>
<ul>
  <li>
    <p>下载 Nginx 源码包</p>

    <p>下载页: http://nginx.org/en/download.html</p>

    <p>当前稳定版本: http://nginx.org/download/nginx-1.8.1.tar.gz</p>
  </li>
  <li>
    <p>zlib</p>

    <p>下载页: http://zlib.net/</p>

    <p>当前稳定版本: http://zlib.net/zlib-1.2.8.tar.gz</p>

    <p>注: Nginx 参考文档中提到需要 1.1.3 以上版本的 zlib</p>
  </li>
  <li>
    <p>pcre</p>

    <p>下载页: http://www.pcre.org/</p>

    <p>当前稳定版本: ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.38.tar.gz</p>

    <p>注: Nginx 参考文档中提到需要 4.4 以上版本的 pcre</p>
  </li>
</ul>

<h3 id="配置及安装">配置及安装</h3>

<ul>
  <li><strong>First, 进入到包所在的文件夹内</strong>
    <div class="highlighter-rouge"><pre class="highlight"><code>tar zxvf zlib-1.2.8.tar.gz  # 得到 zlib-1.2.8 目录
tar zxvf pcre-8.36.tar.gz  # 得到 pcre-8.36 目录
</code></pre>
    </div>
  </li>
  <li>
    <p>编译安装 Nginx</p>

    <p>这里会将各依赖的源码编译进 Nginx, 所以 –with-zlib 和 –with-pcre 后为对应的依赖源码目录路径。此外, 编译选项中还开启了 HTTPS 的协议支持–with-http_ssl_module, 若不需要 HTTPS, 可取消该选项。</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>  tar zxvf nginx-1.8.0.tar.gz
  cd nginx-1.8.0
  ./configure --prefix=/usr/local/nginx --with-zlib=../zlib-1.2.8 --with-pcre=../pcre-8.36
  make
  sudo make install
</code></pre>
    </div>
  </li>
  <li>其他安装指令（可做了解）
    <div class="highlighter-rouge"><pre class="highlight"><code>  nginx大部分常用模块，编译时./configure --help以--without开头的都默认安装。
    
  --prefix=PATH ： 指定nginx的安装目录。默认 /usr/local/nginx
  --conf-path=PATH ： 设置nginx.conf配置文件的路径。nginx允许使用不同的配置文件启动，通过命令行中的-c选项。默认为prefix/conf/nginx.conf
  --user=name： 设置nginx工作进程的用户。安装完成后，可以随时在nginx.conf配置文件更改user指令。默认的用户名是nobody。--group=name类似
  --with-pcre ： 设置PCRE库的源码路径，如果已通过yum方式安装，使用--with-pcre自动找到库文件。使用--with-pcre=PATH时，需要从PCRE网站下载pcre库的源码（版本4.4 - 8.30）并解压，剩下的就交给Nginx的./configure和make来完成。perl正则表达式使用在location指令和 ngx_http_rewrite_module模块中。
  --with-zlib=PATH ： 指定 zlib（版本1.1.3 - 1.2.5）的源码解压目录。在默认就启用的网络传输压缩模块ngx_http_gzip_module时需要使用zlib 。
  --with-http_ssl_module ： 使用https协议模块。默认情况下，该模块没有被构建。前提是openssl与openssl-devel已安装
  --with-http_stub_status_module ： 用来监控 Nginx 的当前状态
  --with-http_realip_module ： 通过这个模块允许我们改变客户端请求头中客户端IP地址值(例如X-Real-IP 或 X-Forwarded-For)，意义在于能够使得后台服务器记录原始客户端的IP地址
  --add-module=PATH ： 添加第三方外部模块，如nginx-sticky-module-ng或缓存模块。每次添加新的模块都要重新编译（Tengine可以在新加入module时无需重新编译）
</code></pre>
    </div>
    <p>比如：</p>
    <div class="highlighter-rouge"><pre class="highlight"><code>  ./configure \
  &gt; --prefix=/usr \
  &gt; --sbin-path=/usr/sbin/nginx \
  &gt; --conf-path=/etc/nginx/nginx.conf \
  &gt; --error-log-path=/var/log/nginx/error.log \
  &gt; --http-log-path=/var/log/nginx/access.log \
  &gt; --pid-path=/var/run/nginx/nginx.pid  \
     &gt; --lock-path=/var/lock/nginx.lock \   
  &gt; --user=nginx \
  &gt; --group=nginx \
  &gt; --with-http_ssl_module \
  &gt; --with-http_stub_status_module \
  &gt; --with-http_gzip_static_module \
  &gt; --http-client-body-temp-path=/var/tmp/nginx/client/ \
  &gt; --http-proxy-temp-path=/var/tmp/nginx/proxy/ \
  &gt; --http-fastcgi-temp-path=/var/tmp/nginx/fcgi/ \
  &gt; --http-uwsgi-temp-path=/var/tmp/nginx/uwsgi \
  &gt; --with-pcre=../pcre-7.8
  &gt; --with-zlib=../zlib-1.2.3
</code></pre>
    </div>
  </li>
</ul>

<h3 id="设置监听">设置监听</h3>

<p>进入配置文件/usr/local/nginx/conf/nginx.conf ，修改listen下参数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>server {
        listen       85;            #监听端口
        server_name  localhost;     #监听服务器

        #charset koi8-r;
        #access_log  logs/host.access.log  main;
        location / {
            root   html;
            index  index.html index.htm;
        }

        #error_page  404              /404.html;
        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
</code></pre>
</div>
<h3 id="启动nginx">启动nginx</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>cd /usr/local/nginx

#启动
sudo sbin/nginx     #浏览器访问 127.0.0.1 测试是否成功启动

#重启
sudo sbin/nginx -s reload

#停止
sudo sbin/nginx -s stop
</code></pre>
</div>

<h3 id="修改返回值">修改返回值</h3>

<p>以bandwidth请求：</p>

<p>http://127.0.0.1:8001/v2/bandwidth</p>

<p>按照请求的格式创建目录为：/usr/local/nginx/html/v2/ <br />
（/usr/local/nginx/html/为默认目录,/v2/为根据请求格式新建的目录）</p>

<p>新建bandwidth文件，则文件路径为/usr/local/nginx/html/v2/bandwidth，写入返回值，则构造指定返回报文成功，可按照自己需求进行编辑；</p>

<p>然后在浏览器中请求这个接口，返回自定义的内容则配置成功。</p>

  </div>

  
</article>

      </section>
      <footer>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/assets/js/scale.fix.js"></script>


  
  </body>
</html>